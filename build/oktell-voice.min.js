!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.JsSIP=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?localStorage.removeItem("debug"):localStorage.debug=a}catch(b){}}function h(){var a;try{a=localStorage.debug}catch(b){}return a}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":2}],2:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;d>e;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:3}],3:[function(a,b,c){function d(a){var b=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"h":return c*j;case"minutes":case"minute":case"m":return c*i;case"seconds":case"second":case"s":return c*h;case"ms":return c}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){return b>a?void 0:1.5*b>a?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b["long"]?f(a):e(a)}},{}],4:[function(a,b,c){var d=b.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)\/(\d*)(?:\s*\/(\S*))?/,names:["payload","codec","rate","encoding"],format:function(a){return a.encoding?"rtpmap:%d %s/%s/%s":"rtpmap:%d %s/%s"}},{push:"fmtp",reg:/^fmtp:(\d*) (\S*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(a){return null!=a.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(a){return null!=a.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(a){return null!=a.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(a){return null!=a.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:(\w*)/,format:"mid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/,format:"%s"},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","generation"],format:function(a){var b="candidate:%s %d %s %d %s %d typ %s";return b+=null!=a.raddr?" raddr %s rport %d":"%v%v",null!=a.generation&&(b+=" generation %d"),b}},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{name:"msidSemantic",reg:/^msid-semantic: (\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{push:"invalid",names:["value"]}]};Object.keys(d).forEach(function(a){var b=d[a];b.forEach(function(a){a.reg||(a.reg=/(.*)/),a.format||(a.format="%s")})})},{}],5:[function(a,b,c){var d=a("./parser"),e=a("./writer");c.write=e,c.parse=d.parse,c.parseFmtpConfig=d.parseFmtpConfig,c.parsePayloads=d.parsePayloads,c.parseRemoteCandidates=d.parseRemoteCandidates},{"./parser":6,"./writer":7}],6:[function(a,b,c){var d=function(a){return String(Number(a))===a?Number(a):a},e=function(a,b,c,e){if(e&&!c)b[e]=d(a[1]);else for(var f=0;f<c.length;f+=1)null!=a[f+1]&&(b[c[f]]=d(a[f+1]))},f=function(a,b,c){var d=a.name&&a.names;a.push&&!b[a.push]?b[a.push]=[]:d&&!b[a.name]&&(b[a.name]={});var f=a.push?{}:d?b[a.name]:b;e(c.match(a.reg),f,a.names,a.name),a.push&&b[a.push].push(f)},g=a("./grammar"),h=RegExp.prototype.test.bind(/^([a-z])=(.*)/);c.parse=function(a){var b={},c=[],d=b;return a.split("\r\n").filter(h).forEach(function(a){var b=a[0],e=a.slice(2);"m"===b&&(c.push({rtp:[],fmtp:[]}),d=c[c.length-1]);for(var h=0;h<(g[b]||[]).length;h+=1){var i=g[b][h];if(i.reg.test(e))return f(i,d,e)}}),b.media=c,b};var i=function(a,b){var c=b.split("=");return 2===c.length&&(a[c[0]]=d(c[1])),a};c.parseFmtpConfig=function(a){return a.split(";").reduce(i,{})},c.parsePayloads=function(a){return a.split(" ").map(Number)},c.parseRemoteCandidates=function(a){for(var b=[],c=a.split(" ").map(d),e=0;e<c.length;e+=3)b.push({component:c[e],ip:c[e+1],port:c[e+2]});return b}},{"./grammar":4}],7:[function(a,b,c){var d=a("./grammar"),e=/%[sdv%]/g,f=function(a){var b=1,c=arguments,d=c.length;return a.replace(e,function(a){if(b>=d)return a;var e=c[b];switch(b+=1,a){case"%%":return"%";case"%s":return String(e);case"%d":return Number(e);case"%v":return""}})},g=function(a,b,c){var d=b.format instanceof Function?b.format(b.push?c:c[b.name]):b.format,e=[a+"="+d];if(b.names)for(var g=0;g<b.names.length;g+=1){var h=b.names[g];b.name?e.push(c[b.name][h]):e.push(c[b.names[g]])}else e.push(c[b.name]);return f.apply(null,e)},h=["v","o","s","i","u","e","p","c","b","t","r","z","a"],i=["i","c","b","a"];b.exports=function(a,b){b=b||{},null==a.version&&(a.version=0),null==a.name&&(a.name=" "),a.media.forEach(function(a){null==a.payloads&&(a.payloads="")});var c=b.outerOrder||h,e=b.innerOrder||i,f=[];return c.forEach(function(b){d[b].forEach(function(c){c.name in a?f.push(g(b,c,a)):c.push in a&&a[c.push].forEach(function(a){f.push(g(b,c,a))})})}),a.media.forEach(function(a){f.push(g("m",d.m[0],a)),e.forEach(function(b){d[b].forEach(function(c){c.name in a?f.push(g(b,c,a)):c.push in a&&a[c.push].forEach(function(a){f.push(g(b,c,a))})})})}),f.join("\r\n")+"\r\n"}},{"./grammar":4}],8:[function(a,b,c){function d(a,b,c){var d;return d=b?new f(a,b):new f(a)}var e=function(){return this}(),f=e.WebSocket||e.MozWebSocket;b.exports=f?d:null,f&&(d.prototype=f.prototype)},{}],9:[function(a,b,c){b.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"0.6.0",homepage:"http://jssip.net",author:"José Luis Millán <jmillan@aliax.net> (https://github.com/jmillan)",contributors:["Iñaki Baz Castillo <ibc@aliax.net> (https://github.com/ibc)","Saúl Ibarra Corretgé <saghul@gmail.com> (https://github.com/saghul)"],main:"src/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{debug:"^2.1.0","sdp-transform":"~0.6.1",ws:"~0.4.32"},devDependencies:{grunt:"~0.4.5","grunt-contrib-jshint":"~0.10.0","grunt-contrib-concat":"~0.5.0","grunt-contrib-nodeunit":"~0.4.1","grunt-contrib-uglify":"~0.6.0","grunt-contrib-watch":"~0.6.1","grunt-contrib-symlink":"~0.3.0","grunt-browserify":"~3.0.1","grunt-jsdoc":"~0.5.7",pegjs:"0.7.0"},scripts:{test:"grunt test"}}},{}],10:[function(a,b,c){var d=a("../package.json"),e={USER_AGENT:d.title+" "+d.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",BYE:"Terminated",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69};b.exports=e},{"../package.json":9}],11:[function(a,b,c){function d(a,b,c,d){var h;return this.uac_pending_reply=!1,this.uas_pending_reply=!1,b.hasHeader("contact")?(d=b instanceof g.IncomingResponse?b.status_code<200?e.STATUS_EARLY:e.STATUS_CONFIRMED:d||e.STATUS_CONFIRMED,h=b.parseHeader("contact"),"UAS"===c?(this.id={call_id:b.call_id,local_tag:b.to_tag,remote_tag:b.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=d,this.remote_seqnum=b.cseq,this.local_uri=b.parseHeader("to").uri,this.remote_uri=b.parseHeader("from").uri,this.remote_target=h.uri,this.route_set=b.getHeaders("record-route")):"UAC"===c&&(this.id={call_id:b.call_id,local_tag:b.from_tag,remote_tag:b.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=d,this.local_seqnum=b.cseq,this.local_uri=b.parseHeader("from").uri,this.remote_uri=b.parseHeader("to").uri,this.remote_target=h.uri,this.route_set=b.getHeaders("record-route").reverse()),this.owner=a,a.ua.dialogs[this.id.toString()]=this,void f("new "+c+" dialog created with status "+(this.state===e.STATUS_EARLY?"EARLY":"CONFIRMED"))):{error:"unable to create a Dialog without Contact header field"}}b.exports=d;var e={STATUS_EARLY:1,STATUS_CONFIRMED:2};d.C=e;var f=a("debug")("JsSIP:Dialog"),g=a("./SIPMessage"),h=a("./Constants"),i=a("./Transactions"),j=a("./Dialog/RequestSender");d.prototype={update:function(a,b){this.state=e.STATUS_CONFIRMED,f("dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===b&&(this.route_set=a.getHeaders("record-route").reverse())},terminate:function(){f("dialog "+this.id.toString()+" deleted"),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(a,b,c){var d,e;return b=b&&b.slice()||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),d=a===h.CANCEL||a===h.ACK?this.local_seqnum:this.local_seqnum+=1,e=new g.OutgoingRequest(a,this.remote_target,this.owner.ua,{cseq:d,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},b,c),e.dialog=this,e},checkInDialogRequest:function(a){var b=this;if(this.remote_seqnum){if(a.cseq<this.remote_seqnum)return a.method!==h.ACK&&a.reply(500),!1;a.cseq>this.remote_seqnum&&(this.remote_seqnum=a.cseq)}else this.remote_seqnum=a.cseq;if(a.method===h.INVITE||a.method===h.UPDATE&&a.body){if(this.uac_pending_reply===!0)a.reply(491);else{if(this.uas_pending_reply===!0){var c=(10*Math.random()|0)+1;return a.reply(500,null,["Retry-After:"+c]),!1}this.uas_pending_reply=!0,a.server_transaction.on("stateChanged",function d(c){(c.sender.state===i.C.STATUS_ACCEPTED||c.sender.state===i.C.STATUS_COMPLETED||c.sender.state===i.C.STATUS_TERMINATED)&&(a.server_transaction.removeListener("stateChanged",d),b.uas_pending_reply=!1,b.uac_pending_reply===!1&&b.owner.onReadyToReinvite())})}a.hasHeader("contact")&&a.server_transaction.on("stateChanged",function(c){c.sender.state===i.C.STATUS_ACCEPTED&&(b.remote_target=a.parseHeader("contact").uri)})}else a.method===h.NOTIFY&&a.hasHeader("contact")&&a.server_transaction.on("stateChanged",function(c){c.sender.state===i.C.STATUS_COMPLETED&&(b.remote_target=a.parseHeader("contact").uri)});return!0},sendRequest:function(a,b,c){c=c||{};var d=c.extraHeaders&&c.extraHeaders.slice()||[],e=c.body||null,f=this.createRequest(b,d,e),g=new j(this,a,f);g.send()},receiveRequest:function(a){this.checkInDialogRequest(a)&&this.owner.receiveRequest(a)}}},{"./Constants":10,"./Dialog/RequestSender":12,"./SIPMessage":27,"./Transactions":29,debug:1}],12:[function(a,b,c){function d(a,b,c){this.dialog=a,this.applicant=b,this.request=c,this.reattempt=!1,this.reattemptTimer=null}b.exports=d;var e=a("../Constants"),f=a("../Transactions"),g=a("../RTCSession"),h=a("../RequestSender");d.prototype={send:function(){var a=this,b=new h(this,this.dialog.owner.ua);b.send(),this.request.method===e.INVITE&&b.clientTransaction.state!==f.C.STATUS_TERMINATED&&(this.dialog.uac_pending_reply=!0,b.clientTransaction.on("stateChanged",function c(d){(d.sender.state===f.C.STATUS_ACCEPTED||d.sender.state===f.C.STATUS_COMPLETED||d.sender.state===f.C.STATUS_TERMINATED)&&(b.clientTransaction.removeListener("stateChanged",c),a.dialog.uac_pending_reply=!1,a.dialog.uas_pending_reply===!1&&a.dialog.owner.onReadyToReinvite())}))},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(a){var b=this;408===a.status_code||481===a.status_code?this.applicant.onDialogError(a):a.method===e.INVITE&&491===a.status_code?this.reattempt?this.applicant.receiveResponse(a):(this.request.cseq.value=this.dialog.local_seqnum+=1,this.reattemptTimer=setTimeout(function(){b.applicant.owner.status!==g.C.STATUS_TERMINATED&&(b.reattempt=!0,b.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(a)}}},{"../Constants":10,"../RTCSession":21,"../RequestSender":26,"../Transactions":29}],13:[function(a,b,c){function d(a){this.username=a.configuration.authorization_user,this.password=a.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null}b.exports=d;var e=a("debug")("JsSIP:DigestAuthentication"),f=a("./Utils");d.prototype.authenticate=function(a,b){if(this.algorithm=b.algorithm,this.realm=b.realm,this.nonce=b.nonce,this.opaque=b.opaque,this.stale=b.stale,this.algorithm){if("MD5"!==this.algorithm)return e('challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return e("challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return e("challenge without Digest nonce, authentication aborted"),!1;if(b.qop)if(b.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(b.qop.indexOf("auth-int")>-1))return e('challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=a.method,this.uri=a.ruri,this.cnonce=f.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},d.prototype.calculateResponse=function(){var a,b;a=f.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(b=f.calculateMD5(this.method+":"+this.uri),this.response=f.calculateMD5(a+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+b)):"auth-int"===this.qop?(b=f.calculateMD5(this.method+":"+this.uri+":"+f.calculateMD5(this.body?this.body:"")),this.response=f.calculateMD5(a+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+b)):null===this.qop&&(b=f.calculateMD5(this.method+":"+this.uri),this.response=f.calculateMD5(a+":"+this.nonce+":"+b))},d.prototype.toString=function(){var a=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return a.push("algorithm="+this.algorithm),a.push('username="'+this.username+'"'),a.push('realm="'+this.realm+'"'),a.push('nonce="'+this.nonce+'"'),a.push('uri="'+this.uri+'"'),a.push('response="'+this.response+'"'),this.opaque&&a.push('opaque="'+this.opaque+'"'),this.qop&&(a.push("qop="+this.qop),a.push('cnonce="'+this.cnonce+'"'),a.push("nc="+this.ncHex)),"Digest "+a.join(", ")},d.prototype.updateNcHex=function(){var a=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-a.length)+a}},{"./Utils":33,debug:1}],14:[function(a,b,c){function d(){}function e(a,b,c){this.type=a,this.sender=b,this.data=c}b.exports=d;var f=a("debug")("JsSIP:EventEmitter"),g={MAX_LISTENERS:50};d.prototype={initEvents:function(a){var b,c;for(this.maxListeners=g.MAX_LISTENERS,this.events={},this.oneTimeListeners={},c=a.length,b=0;c>b;b++)this.events[a[b]]=[],this.oneTimeListeners[a[b]]=[]},checkEvent:function(a){return!!this.events[a]},addListener:function(a,b){if(void 0!==b){if("function"!=typeof b)throw new Error("listener must be a function");if(!this.checkEvent(a))throw new Error("unable to add a listener to a nonexistent event "+a);this.events[a].length>=this.maxListeners&&f("max listeners exceeded for event "+a),this.events[a].push(b)}},on:function(a,b){this.addListener(a,b)},once:function(a,b){this.on(a,b),this.oneTimeListeners[a].push(b)},removeListener:function(a,b){var c,d,e=0;if(void 0!==b){if("function"!=typeof b)throw new Error("listener must be a function");if(!this.checkEvent(a))throw new Error("unable to remove a listener from a nonexistent event"+a);for(c=this.events[a],d=c.length;d>e;)c[e]===b?c.splice(e,1):e++}},removeAllListener:function(a){if(!this.checkEvent(a))throw new Error("unable to remove listeners from a nonexistent event"+a);this.events[a]=[],this.oneTimeListeners[a]=[]},setMaxListeners:function(a){if("number"!=typeof a||0>a)throw new Error("listeners must be a positive number");this.maxListeners=a},listeners:function(a){if(!this.checkEvent(a))throw new Error("no event "+a);return this.events[a]},emit:function(a,b,c){var d,g,h,i;if(!this.checkEvent(a))throw new Error("unable to emit a nonexistent event"+a);f("emitting event "+a),d=this.events[a],g=d.length,h=new e(a,b,c),d.map(function(a){return function(){a.call(null,h)}}).forEach(function(a){try{a()}catch(b){f(b.stack?b.stack:b)}});for(i in this.oneTimeListeners[a])this.removeListener(a,this.oneTimeListeners[a][i]);this.oneTimeListeners[a]=[]}}},{debug:1}],15:[function(a,b,c){var d={ConfigurationError:function(){var a=function(a,b){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=a,this.value=b,this.message=this.value?"Invalid value "+JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return a.prototype=new Error,a}(),InvalidStateError:function(){var a=function(a){this.code=2,this.name="INVALID_STATE_ERROR",this.status=a,this.message="Invalid status: "+a};return a.prototype=new Error,a}(),NotSupportedError:function(){var a=function(a){this.code=3,this.name="NOT_SUPPORTED_ERROR",this.message=a};return a.prototype=new Error,a}(),NotReadyError:function(){var a=function(a){this.code=4,this.name="NOT_READY_ERROR",this.message=a};return a.prototype=new Error,a}()};b.exports=d},{}],16:[function(a,b,c){b.exports=function(){function b(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var c={parse:function(c,d){function e(a){ld>jd||(jd>ld&&(ld=jd,md=[]),md.push(a))}function f(){var a;return"\r\n"===c.substr(jd,2)?(a="\r\n",jd+=2):(a=null,0===kd&&e('"\\r\\n"')),a}function g(){var a;return/^[0-9]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[0-9]")),a}function h(){var a;return/^[a-zA-Z]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[a-zA-Z]")),a}function i(){var a;return/^[0-9a-fA-F]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[0-9a-fA-F]")),a}function j(){var a;return a=m(),null===a&&(a=n()),a}function k(){var a;return/^[\0-\xFF]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[\\0-\\xFF]")),a}function l(){var a;return/^["]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e('["]')),a}function m(){var a;return 32===c.charCodeAt(jd)?(a=" ",jd++):(a=null,0===kd&&e('" "')),a}function n(){var a;return 9===c.charCodeAt(jd)?(a="	",jd++):(a=null,0===kd&&e('"\\t"')),a}function o(){var a;return/^[a-zA-Z0-9]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[a-zA-Z0-9]")),a}function p(){var a;return 59===c.charCodeAt(jd)?(a=";",jd++):(a=null,0===kd&&e('";"')),null===a&&(47===c.charCodeAt(jd)?(a="/",jd++):(a=null,0===kd&&e('"/"')),null===a&&(63===c.charCodeAt(jd)?(a="?",jd++):(a=null,0===kd&&e('"?"')),null===a&&(58===c.charCodeAt(jd)?(a=":",jd++):(a=null,0===kd&&e('":"')),null===a&&(64===c.charCodeAt(jd)?(a="@",jd++):(a=null,0===kd&&e('"@"')),null===a&&(38===c.charCodeAt(jd)?(a="&",jd++):(a=null,0===kd&&e('"&"')),null===a&&(61===c.charCodeAt(jd)?(a="=",jd++):(a=null,0===kd&&e('"="')),null===a&&(43===c.charCodeAt(jd)?(a="+",jd++):(a=null,0===kd&&e('"+"')),null===a&&(36===c.charCodeAt(jd)?(a="$",jd++):(a=null,0===kd&&e('"$"')),null===a&&(44===c.charCodeAt(jd)?(a=",",jd++):(a=null,0===kd&&e('","'))))))))))),a}function q(){var a;return a=o(),null===a&&(a=r()),a}function r(){var a;return 45===c.charCodeAt(jd)?(a="-",jd++):(a=null,0===kd&&e('"-"')),null===a&&(95===c.charCodeAt(jd)?(a="_",jd++):(a=null,0===kd&&e('"_"')),null===a&&(46===c.charCodeAt(jd)?(a=".",jd++):(a=null,0===kd&&e('"."')),null===a&&(33===c.charCodeAt(jd)?(a="!",jd++):(a=null,0===kd&&e('"!"')),null===a&&(126===c.charCodeAt(jd)?(a="~",jd++):(a=null,0===kd&&e('"~"')),null===a&&(42===c.charCodeAt(jd)?(a="*",jd++):(a=null,0===kd&&e('"*"')),null===a&&(39===c.charCodeAt(jd)?(a="'",jd++):(a=null,0===kd&&e('"\'"')),null===a&&(40===c.charCodeAt(jd)?(a="(",jd++):(a=null,0===kd&&e('"("')),null===a&&(41===c.charCodeAt(jd)?(a=")",jd++):(a=null,0===kd&&e('")"')))))))))),a}function s(){var a,b,d,f,g;return f=jd,g=jd,37===c.charCodeAt(jd)?(a="%",jd++):(a=null,0===kd&&e('"%"')),null!==a?(b=i(),null!==b?(d=i(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){return b.join("")}(f,a)),null===a&&(jd=f),a}function t(){var a,b,c,d,e,g;for(d=jd,e=jd,g=jd,a=[],b=j();null!==b;)a.push(b),b=j();if(null!==a?(b=f(),null!==b?a=[a,b]:(a=null,jd=g)):(a=null,jd=g),a=null!==a?a:"",null!==a){if(c=j(),null!==c)for(b=[];null!==c;)b.push(c),c=j();else b=null;null!==b?a=[a,b]:(a=null,jd=e)}else a=null,jd=e;return null!==a&&(a=function(a){return" "}(d)),null===a&&(jd=d),a}function u(){var a;return a=t(),a=null!==a?a:""}function v(){var a,b,d,f,g;for(f=jd,g=jd,a=[],b=m(),null===b&&(b=n());null!==b;)a.push(b),b=m(),null===b&&(b=n());return null!==a?(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){return":"}(f)),null===a&&(jd=f),a}function w(){var a,b,d,e,f,g,h;if(f=jd,g=jd,b=x(),null!==b)for(a=[];null!==b;)a.push(b),b=x();else a=null;if(null!==a){for(b=[],h=jd,d=[],e=t();null!==e;)d.push(e),e=t();for(null!==d?(e=x(),null!==e?d=[d,e]:(d=null,jd=h)):(d=null,jd=h);null!==d;){for(b.push(d),h=jd,d=[],e=t();null!==e;)d.push(e),e=t();null!==d?(e=x(),null!==e?d=[d,e]:(d=null,jd=h)):(d=null,jd=h)}null!==b?a=[a,b]:(a=null,jd=g)}else a=null,jd=g;return null!==a&&(a=function(a){return c.substring(jd,a)}(f)),null===a&&(jd=f),a}function x(){var a;return/^[!-~]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[!-~]")),null===a&&(a=y()),a}function y(){var a;return/^[\x80-\uFFFF]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[\\x80-\\uFFFF]")),a}function z(){var a;return/^[\x80-\xBF]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[\\x80-\\xBF]")),a}function A(){var a;return a=g(),null===a&&(/^[a-f]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[a-f]"))),a}function B(){var a,b,d;if(d=jd,b=o(),null===b&&(45===c.charCodeAt(jd)?(b="-",jd++):(b=null,0===kd&&e('"-"')),null===b&&(46===c.charCodeAt(jd)?(b=".",jd++):(b=null,0===kd&&e('"."')),null===b&&(33===c.charCodeAt(jd)?(b="!",jd++):(b=null,0===kd&&e('"!"')),null===b&&(37===c.charCodeAt(jd)?(b="%",jd++):(b=null,0===kd&&e('"%"')),null===b&&(42===c.charCodeAt(jd)?(b="*",jd++):(b=null,0===kd&&e('"*"')),null===b&&(95===c.charCodeAt(jd)?(b="_",jd++):(b=null,0===kd&&e('"_"')),null===b&&(43===c.charCodeAt(jd)?(b="+",jd++):(b=null,0===kd&&e('"+"')),null===b&&(96===c.charCodeAt(jd)?(b="`",jd++):(b=null,0===kd&&e('"`"')),null===b&&(39===c.charCodeAt(jd)?(b="'",jd++):(b=null,0===kd&&e('"\'"')),null===b&&(126===c.charCodeAt(jd)?(b="~",jd++):(b=null,0===kd&&e('"~"')))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(jd)?(b="-",jd++):(b=null,0===kd&&e('"-"')),null===b&&(46===c.charCodeAt(jd)?(b=".",jd++):(b=null,0===kd&&e('"."')),null===b&&(33===c.charCodeAt(jd)?(b="!",jd++):(b=null,0===kd&&e('"!"')),null===b&&(37===c.charCodeAt(jd)?(b="%",jd++):(b=null,0===kd&&e('"%"')),null===b&&(42===c.charCodeAt(jd)?(b="*",jd++):(b=null,0===kd&&e('"*"')),null===b&&(95===c.charCodeAt(jd)?(b="_",jd++):(b=null,0===kd&&e('"_"')),null===b&&(43===c.charCodeAt(jd)?(b="+",jd++):(b=null,0===kd&&e('"+"')),null===b&&(96===c.charCodeAt(jd)?(b="`",jd++):(b=null,0===kd&&e('"`"')),null===b&&(39===c.charCodeAt(jd)?(b="'",jd++):(b=null,0===kd&&e('"\'"')),null===b&&(126===c.charCodeAt(jd)?(b="~",jd++):(b=null,0===kd&&e('"~"'))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(jd,a)}(d)),null===a&&(jd=d),a}function C(){var a,b,d;if(d=jd,b=o(),null===b&&(45===c.charCodeAt(jd)?(b="-",jd++):(b=null,0===kd&&e('"-"')),null===b&&(33===c.charCodeAt(jd)?(b="!",jd++):(b=null,0===kd&&e('"!"')),null===b&&(37===c.charCodeAt(jd)?(b="%",jd++):(b=null,0===kd&&e('"%"')),null===b&&(42===c.charCodeAt(jd)?(b="*",jd++):(b=null,0===kd&&e('"*"')),null===b&&(95===c.charCodeAt(jd)?(b="_",jd++):(b=null,0===kd&&e('"_"')),null===b&&(43===c.charCodeAt(jd)?(b="+",jd++):(b=null,0===kd&&e('"+"')),null===b&&(96===c.charCodeAt(jd)?(b="`",jd++):(b=null,0===kd&&e('"`"')),null===b&&(39===c.charCodeAt(jd)?(b="'",jd++):(b=null,0===kd&&e('"\'"')),null===b&&(126===c.charCodeAt(jd)?(b="~",jd++):(b=null,0===kd&&e('"~"'))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(jd)?(b="-",jd++):(b=null,0===kd&&e('"-"')),null===b&&(33===c.charCodeAt(jd)?(b="!",jd++):(b=null,0===kd&&e('"!"')),null===b&&(37===c.charCodeAt(jd)?(b="%",jd++):(b=null,0===kd&&e('"%"')),null===b&&(42===c.charCodeAt(jd)?(b="*",jd++):(b=null,0===kd&&e('"*"')),null===b&&(95===c.charCodeAt(jd)?(b="_",jd++):(b=null,
0===kd&&e('"_"')),null===b&&(43===c.charCodeAt(jd)?(b="+",jd++):(b=null,0===kd&&e('"+"')),null===b&&(96===c.charCodeAt(jd)?(b="`",jd++):(b=null,0===kd&&e('"`"')),null===b&&(39===c.charCodeAt(jd)?(b="'",jd++):(b=null,0===kd&&e('"\'"')),null===b&&(126===c.charCodeAt(jd)?(b="~",jd++):(b=null,0===kd&&e('"~"')))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(jd,a)}(d)),null===a&&(jd=d),a}function D(){var a;return 40===c.charCodeAt(jd)?(a="(",jd++):(a=null,0===kd&&e('"("')),null===a&&(41===c.charCodeAt(jd)?(a=")",jd++):(a=null,0===kd&&e('")"')),null===a&&(60===c.charCodeAt(jd)?(a="<",jd++):(a=null,0===kd&&e('"<"')),null===a&&(62===c.charCodeAt(jd)?(a=">",jd++):(a=null,0===kd&&e('">"')),null===a&&(64===c.charCodeAt(jd)?(a="@",jd++):(a=null,0===kd&&e('"@"')),null===a&&(44===c.charCodeAt(jd)?(a=",",jd++):(a=null,0===kd&&e('","')),null===a&&(59===c.charCodeAt(jd)?(a=";",jd++):(a=null,0===kd&&e('";"')),null===a&&(58===c.charCodeAt(jd)?(a=":",jd++):(a=null,0===kd&&e('":"')),null===a&&(92===c.charCodeAt(jd)?(a="\\",jd++):(a=null,0===kd&&e('"\\\\"')),null===a&&(a=l(),null===a&&(47===c.charCodeAt(jd)?(a="/",jd++):(a=null,0===kd&&e('"/"')),null===a&&(91===c.charCodeAt(jd)?(a="[",jd++):(a=null,0===kd&&e('"["')),null===a&&(93===c.charCodeAt(jd)?(a="]",jd++):(a=null,0===kd&&e('"]"')),null===a&&(63===c.charCodeAt(jd)?(a="?",jd++):(a=null,0===kd&&e('"?"')),null===a&&(61===c.charCodeAt(jd)?(a="=",jd++):(a=null,0===kd&&e('"="')),null===a&&(123===c.charCodeAt(jd)?(a="{",jd++):(a=null,0===kd&&e('"{"')),null===a&&(125===c.charCodeAt(jd)?(a="}",jd++):(a=null,0===kd&&e('"}"')),null===a&&(a=m(),null===a&&(a=n())))))))))))))))))),a}function E(){var a,b,d;if(d=jd,b=o(),null===b&&(45===c.charCodeAt(jd)?(b="-",jd++):(b=null,0===kd&&e('"-"')),null===b&&(46===c.charCodeAt(jd)?(b=".",jd++):(b=null,0===kd&&e('"."')),null===b&&(33===c.charCodeAt(jd)?(b="!",jd++):(b=null,0===kd&&e('"!"')),null===b&&(37===c.charCodeAt(jd)?(b="%",jd++):(b=null,0===kd&&e('"%"')),null===b&&(42===c.charCodeAt(jd)?(b="*",jd++):(b=null,0===kd&&e('"*"')),null===b&&(95===c.charCodeAt(jd)?(b="_",jd++):(b=null,0===kd&&e('"_"')),null===b&&(43===c.charCodeAt(jd)?(b="+",jd++):(b=null,0===kd&&e('"+"')),null===b&&(96===c.charCodeAt(jd)?(b="`",jd++):(b=null,0===kd&&e('"`"')),null===b&&(39===c.charCodeAt(jd)?(b="'",jd++):(b=null,0===kd&&e('"\'"')),null===b&&(126===c.charCodeAt(jd)?(b="~",jd++):(b=null,0===kd&&e('"~"')),null===b&&(40===c.charCodeAt(jd)?(b="(",jd++):(b=null,0===kd&&e('"("')),null===b&&(41===c.charCodeAt(jd)?(b=")",jd++):(b=null,0===kd&&e('")"')),null===b&&(60===c.charCodeAt(jd)?(b="<",jd++):(b=null,0===kd&&e('"<"')),null===b&&(62===c.charCodeAt(jd)?(b=">",jd++):(b=null,0===kd&&e('">"')),null===b&&(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null===b&&(92===c.charCodeAt(jd)?(b="\\",jd++):(b=null,0===kd&&e('"\\\\"')),null===b&&(b=l(),null===b&&(47===c.charCodeAt(jd)?(b="/",jd++):(b=null,0===kd&&e('"/"')),null===b&&(91===c.charCodeAt(jd)?(b="[",jd++):(b=null,0===kd&&e('"["')),null===b&&(93===c.charCodeAt(jd)?(b="]",jd++):(b=null,0===kd&&e('"]"')),null===b&&(63===c.charCodeAt(jd)?(b="?",jd++):(b=null,0===kd&&e('"?"')),null===b&&(123===c.charCodeAt(jd)?(b="{",jd++):(b=null,0===kd&&e('"{"')),null===b&&(125===c.charCodeAt(jd)?(b="}",jd++):(b=null,0===kd&&e('"}"'))))))))))))))))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(jd)?(b="-",jd++):(b=null,0===kd&&e('"-"')),null===b&&(46===c.charCodeAt(jd)?(b=".",jd++):(b=null,0===kd&&e('"."')),null===b&&(33===c.charCodeAt(jd)?(b="!",jd++):(b=null,0===kd&&e('"!"')),null===b&&(37===c.charCodeAt(jd)?(b="%",jd++):(b=null,0===kd&&e('"%"')),null===b&&(42===c.charCodeAt(jd)?(b="*",jd++):(b=null,0===kd&&e('"*"')),null===b&&(95===c.charCodeAt(jd)?(b="_",jd++):(b=null,0===kd&&e('"_"')),null===b&&(43===c.charCodeAt(jd)?(b="+",jd++):(b=null,0===kd&&e('"+"')),null===b&&(96===c.charCodeAt(jd)?(b="`",jd++):(b=null,0===kd&&e('"`"')),null===b&&(39===c.charCodeAt(jd)?(b="'",jd++):(b=null,0===kd&&e('"\'"')),null===b&&(126===c.charCodeAt(jd)?(b="~",jd++):(b=null,0===kd&&e('"~"')),null===b&&(40===c.charCodeAt(jd)?(b="(",jd++):(b=null,0===kd&&e('"("')),null===b&&(41===c.charCodeAt(jd)?(b=")",jd++):(b=null,0===kd&&e('")"')),null===b&&(60===c.charCodeAt(jd)?(b="<",jd++):(b=null,0===kd&&e('"<"')),null===b&&(62===c.charCodeAt(jd)?(b=">",jd++):(b=null,0===kd&&e('">"')),null===b&&(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null===b&&(92===c.charCodeAt(jd)?(b="\\",jd++):(b=null,0===kd&&e('"\\\\"')),null===b&&(b=l(),null===b&&(47===c.charCodeAt(jd)?(b="/",jd++):(b=null,0===kd&&e('"/"')),null===b&&(91===c.charCodeAt(jd)?(b="[",jd++):(b=null,0===kd&&e('"["')),null===b&&(93===c.charCodeAt(jd)?(b="]",jd++):(b=null,0===kd&&e('"]"')),null===b&&(63===c.charCodeAt(jd)?(b="?",jd++):(b=null,0===kd&&e('"?"')),null===b&&(123===c.charCodeAt(jd)?(b="{",jd++):(b=null,0===kd&&e('"{"')),null===b&&(125===c.charCodeAt(jd)?(b="}",jd++):(b=null,0===kd&&e('"}"')))))))))))))))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(jd,a)}(d)),null===a&&(jd=d),a}function F(){var a,b,d,f,g;return f=jd,g=jd,a=u(),null!==a?(42===c.charCodeAt(jd)?(b="*",jd++):(b=null,0===kd&&e('"*"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){return"*"}(f)),null===a&&(jd=f),a}function G(){var a,b,d,f,g;return f=jd,g=jd,a=u(),null!==a?(47===c.charCodeAt(jd)?(b="/",jd++):(b=null,0===kd&&e('"/"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){return"/"}(f)),null===a&&(jd=f),a}function H(){var a,b,d,f,g;return f=jd,g=jd,a=u(),null!==a?(61===c.charCodeAt(jd)?(b="=",jd++):(b=null,0===kd&&e('"="')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){return"="}(f)),null===a&&(jd=f),a}function I(){var a,b,d,f,g;return f=jd,g=jd,a=u(),null!==a?(40===c.charCodeAt(jd)?(b="(",jd++):(b=null,0===kd&&e('"("')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){return"("}(f)),null===a&&(jd=f),a}function J(){var a,b,d,f,g;return f=jd,g=jd,a=u(),null!==a?(41===c.charCodeAt(jd)?(b=")",jd++):(b=null,0===kd&&e('")"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){return")"}(f)),null===a&&(jd=f),a}function K(){var a,b,d,f;return d=jd,f=jd,62===c.charCodeAt(jd)?(a=">",jd++):(a=null,0===kd&&e('">"')),null!==a?(b=u(),null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),null!==a&&(a=function(a){return">"}(d)),null===a&&(jd=d),a}function L(){var a,b,d,f;return d=jd,f=jd,a=u(),null!==a?(60===c.charCodeAt(jd)?(b="<",jd++):(b=null,0===kd&&e('"<"')),null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),null!==a&&(a=function(a){return"<"}(d)),null===a&&(jd=d),a}function M(){var a,b,d,f,g;return f=jd,g=jd,a=u(),null!==a?(44===c.charCodeAt(jd)?(b=",",jd++):(b=null,0===kd&&e('","')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){return","}(f)),null===a&&(jd=f),a}function N(){var a,b,d,f,g;return f=jd,g=jd,a=u(),null!==a?(59===c.charCodeAt(jd)?(b=";",jd++):(b=null,0===kd&&e('";"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){return";"}(f)),null===a&&(jd=f),a}function O(){var a,b,d,f,g;return f=jd,g=jd,a=u(),null!==a?(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){return":"}(f)),null===a&&(jd=f),a}function P(){var a,b,c,d;return c=jd,d=jd,a=u(),null!==a?(b=l(),null!==b?a=[a,b]:(a=null,jd=d)):(a=null,jd=d),null!==a&&(a=function(a){return'"'}(c)),null===a&&(jd=c),a}function Q(){var a,b,c,d;return c=jd,d=jd,a=l(),null!==a?(b=u(),null!==b?a=[a,b]:(a=null,jd=d)):(a=null,jd=d),null!==a&&(a=function(a){return'"'}(c)),null===a&&(jd=c),a}function R(){var a,b,c,d;if(d=jd,a=I(),null!==a){for(b=[],c=S(),null===c&&(c=W(),null===c&&(c=R()));null!==c;)b.push(c),c=S(),null===c&&(c=W(),null===c&&(c=R()));null!==b?(c=J(),null!==c?a=[a,b,c]:(a=null,jd=d)):(a=null,jd=d)}else a=null,jd=d;return a}function S(){var a;return/^[!-']/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[!-']")),null===a&&(/^[*-[]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[*-[]")),null===a&&(/^[\]-~]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[\\]-~]")),null===a&&(a=y(),null===a&&(a=t())))),a}function T(){var a,b,d,e,f,g;if(f=jd,g=jd,a=u(),null!==a)if(b=l(),null!==b){for(d=[],e=V(),null===e&&(e=W());null!==e;)d.push(e),e=V(),null===e&&(e=W());null!==d?(e=l(),null!==e?a=[a,b,d,e]:(a=null,jd=g)):(a=null,jd=g)}else a=null,jd=g;else a=null,jd=g;return null!==a&&(a=function(a){return c.substring(jd,a)}(f)),null===a&&(jd=f),a}function U(){var a,b,d,e,f,g;if(f=jd,g=jd,a=u(),null!==a)if(b=l(),null!==b){for(d=[],e=V(),null===e&&(e=W());null!==e;)d.push(e),e=V(),null===e&&(e=W());null!==d?(e=l(),null!==e?a=[a,b,d,e]:(a=null,jd=g)):(a=null,jd=g)}else a=null,jd=g;else a=null,jd=g;return null!==a&&(a=function(a){return c.substring(jd-1,a+1)}(f)),null===a&&(jd=f),a}function V(){var a;return a=t(),null===a&&(33===c.charCodeAt(jd)?(a="!",jd++):(a=null,0===kd&&e('"!"')),null===a&&(/^[#-[]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[#-[]")),null===a&&(/^[\]-~]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[\\]-~]")),null===a&&(a=y())))),a}function W(){var a,b,d;return d=jd,92===c.charCodeAt(jd)?(a="\\",jd++):(a=null,0===kd&&e('"\\\\"')),null!==a?(/^[\0-\t]/.test(c.charAt(jd))?(b=c.charAt(jd),jd++):(b=null,0===kd&&e("[\\0-\\t]")),null===b&&(/^[\x0B-\f]/.test(c.charAt(jd))?(b=c.charAt(jd),jd++):(b=null,0===kd&&e("[\\x0B-\\f]")),null===b&&(/^[\x0E-]/.test(c.charAt(jd))?(b=c.charAt(jd),jd++):(b=null,0===kd&&e("[\\x0E-]")))),null!==b?a=[a,b]:(a=null,jd=d)):(a=null,jd=d),a}function X(){var a,b,d,f,g,h;return g=jd,h=jd,a=Z(),null!==a?(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=$(),d=null!==d?d:"",null!==d?(f=ca(),null!==f?a=[a,b,d,f]:(a=null,jd=h)):(a=null,jd=h)):(a=null,jd=h)):(a=null,jd=h),null!==a&&(a=function(a){try{pd.uri=new nd(pd.scheme,pd.user,pd.host,pd.port),delete pd.scheme,delete pd.user,delete pd.host,delete pd.host_type,delete pd.port}catch(b){pd=-1}}(g)),null===a&&(jd=g),a}function Y(){var a,b,f,g,h,i,j,k;return j=jd,k=jd,a=Z(),null!==a?(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(f=$(),f=null!==f?f:"",null!==f?(g=ca(),null!==g?(h=oa(),null!==h?(i=Ba(),i=null!==i?i:"",null!==i?a=[a,b,f,g,h,i]:(a=null,jd=k)):(a=null,jd=k)):(a=null,jd=k)):(a=null,jd=k)):(a=null,jd=k)):(a=null,jd=k),null!==a&&(a=function(a){try{pd.uri=new nd(pd.scheme,pd.user,pd.host,pd.port,pd.uri_params,pd.uri_headers),delete pd.scheme,delete pd.user,delete pd.host,delete pd.host_type,delete pd.port,delete pd.uri_params,"SIP_URI"===d&&(pd=pd.uri)}catch(b){pd=-1}}(j)),null===a&&(jd=j),a}function Z(){var a,b;return"sip"===c.substr(jd,3).toLowerCase()?(a=c.substr(jd,3),jd+=3):(a=null,0===kd&&e('"sip"')),null===a&&(b=jd,"sips"===c.substr(jd,4).toLowerCase()?(a=c.substr(jd,4),jd+=4):(a=null,0===kd&&e('"sips"')),null!==a&&(a=function(a){pd.scheme=uri_scheme.toLowerCase()}(b)),null===a&&(jd=b)),a}function $(){var a,b,d,f,g,h;return f=jd,g=jd,a=_(),null!==a?(h=jd,58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=ba(),null!==d?b=[b,d]:(b=null,jd=h)):(b=null,jd=h),b=null!==b?b:"",null!==b?(64===c.charCodeAt(jd)?(d="@",jd++):(d=null,0===kd&&e('"@"')),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){pd.user=decodeURIComponent(c.substring(jd-1,a))}(f)),null===a&&(jd=f),a}function _(){var a,b;if(b=q(),null===b&&(b=s(),null===b&&(b=aa())),null!==b)for(a=[];null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(b=aa()));else a=null;return a}function aa(){var a;return 38===c.charCodeAt(jd)?(a="&",jd++):(a=null,0===kd&&e('"&"')),null===a&&(61===c.charCodeAt(jd)?(a="=",jd++):(a=null,0===kd&&e('"="')),null===a&&(43===c.charCodeAt(jd)?(a="+",jd++):(a=null,0===kd&&e('"+"')),null===a&&(36===c.charCodeAt(jd)?(a="$",jd++):(a=null,0===kd&&e('"$"')),null===a&&(44===c.charCodeAt(jd)?(a=",",jd++):(a=null,0===kd&&e('","')),null===a&&(59===c.charCodeAt(jd)?(a=";",jd++):(a=null,0===kd&&e('";"')),null===a&&(63===c.charCodeAt(jd)?(a="?",jd++):(a=null,0===kd&&e('"?"')),null===a&&(47===c.charCodeAt(jd)?(a="/",jd++):(a=null,0===kd&&e('"/"'))))))))),a}function ba(){var a,b,d;for(d=jd,a=[],b=q(),null===b&&(b=s(),null===b&&(38===c.charCodeAt(jd)?(b="&",jd++):(b=null,0===kd&&e('"&"')),null===b&&(61===c.charCodeAt(jd)?(b="=",jd++):(b=null,0===kd&&e('"="')),null===b&&(43===c.charCodeAt(jd)?(b="+",jd++):(b=null,0===kd&&e('"+"')),null===b&&(36===c.charCodeAt(jd)?(b="$",jd++):(b=null,0===kd&&e('"$"')),null===b&&(44===c.charCodeAt(jd)?(b=",",jd++):(b=null,0===kd&&e('","'))))))));null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(38===c.charCodeAt(jd)?(b="&",jd++):(b=null,0===kd&&e('"&"')),null===b&&(61===c.charCodeAt(jd)?(b="=",jd++):(b=null,0===kd&&e('"="')),null===b&&(43===c.charCodeAt(jd)?(b="+",jd++):(b=null,0===kd&&e('"+"')),null===b&&(36===c.charCodeAt(jd)?(b="$",jd++):(b=null,0===kd&&e('"$"')),null===b&&(44===c.charCodeAt(jd)?(b=",",jd++):(b=null,0===kd&&e('","'))))))));return null!==a&&(a=function(a){pd.password=c.substring(jd,a)}(d)),null===a&&(jd=d),a}function ca(){var a,b,d,f,g;return f=jd,a=da(),null!==a?(g=jd,58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=na(),null!==d?b=[b,d]:(b=null,jd=g)):(b=null,jd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),a}function da(){var a,b;return b=jd,a=la(),null===a&&(a=ha(),null===a&&(a=ea())),null!==a&&(a=function(a){return pd.host=c.substring(jd,a).toLowerCase(),pd.host}(b)),null===a&&(jd=b),a}function ea(){var a,b,d,f,g,h;for(f=jd,g=jd,a=[],h=jd,b=fa(),null!==b?(46===c.charCodeAt(jd)?(d=".",jd++):(d=null,0===kd&&e('"."')),null!==d?b=[b,d]:(b=null,jd=h)):(b=null,jd=h);null!==b;)a.push(b),h=jd,b=fa(),null!==b?(46===c.charCodeAt(jd)?(d=".",jd++):(d=null,0===kd&&e('"."')),null!==d?b=[b,d]:(b=null,jd=h)):(b=null,jd=h);return null!==a?(b=ga(),null!==b?(46===c.charCodeAt(jd)?(d=".",jd++):(d=null,0===kd&&e('"."')),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){return pd.host_type="domain",c.substring(jd,a)}(f)),null===a&&(jd=f),a}function fa(){var a,b;if(/^[a-zA-Z0-9_\-]/.test(c.charAt(jd))?(b=c.charAt(jd),jd++):(b=null,0===kd&&e("[a-zA-Z0-9_\\-]")),null!==b)for(a=[];null!==b;)a.push(b),/^[a-zA-Z0-9_\-]/.test(c.charAt(jd))?(b=c.charAt(jd),jd++):(b=null,0===kd&&e("[a-zA-Z0-9_\\-]"));else a=null;return a}function ga(){var a,b;if(/^[a-zA-Z0-9_\-]/.test(c.charAt(jd))?(b=c.charAt(jd),jd++):(b=null,0===kd&&e("[a-zA-Z0-9_\\-]")),null!==b)for(a=[];null!==b;)a.push(b),/^[a-zA-Z0-9_\-]/.test(c.charAt(jd))?(b=c.charAt(jd),jd++):(b=null,0===kd&&e("[a-zA-Z0-9_\\-]"));else a=null;return a}function ha(){var a,b,d,f,g;return f=jd,g=jd,91===c.charCodeAt(jd)?(a="[",jd++):(a=null,0===kd&&e('"["')),null!==a?(b=ia(),null!==b?(93===c.charCodeAt(jd)?(d="]",jd++):(d=null,0===kd&&e('"]"')),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){return pd.host_type="IPv6",c.substring(jd,a)}(f)),null===a&&(jd=f),a}function ia(){var a,b,d,f,g,h,i,j,k,l,m,n,o,p,q,r;return p=jd,q=jd,a=ja(),null!==a?(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=ja(),null!==d?(58===c.charCodeAt(jd)?(f=":",jd++):(f=null,0===kd&&e('":"')),null!==f?(g=ja(),null!==g?(58===c.charCodeAt(jd)?(h=":",jd++):(h=null,0===kd&&e('":"')),null!==h?(i=ja(),null!==i?(58===c.charCodeAt(jd)?(j=":",jd++):(j=null,0===kd&&e('":"')),null!==j?(k=ja(),null!==k?(58===c.charCodeAt(jd)?(l=":",jd++):(l=null,0===kd&&e('":"')),null!==l?(m=ja(),null!==m?(58===c.charCodeAt(jd)?(n=":",jd++):(n=null,0===kd&&e('":"')),null!==n?(o=ka(),null!==o?a=[a,b,d,f,g,h,i,j,k,l,m,n,o]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,"::"===c.substr(jd,2)?(a="::",jd+=2):(a=null,0===kd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(jd)?(d=":",jd++):(d=null,0===kd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(jd)?(g=":",jd++):(g=null,0===kd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(jd)?(i=":",jd++):(i=null,0===kd&&e('":"')),null!==i?(j=ja(),null!==j?(58===c.charCodeAt(jd)?(k=":",jd++):(k=null,0===kd&&e('":"')),null!==k?(l=ja(),null!==l?(58===c.charCodeAt(jd)?(m=":",jd++):(m=null,0===kd&&e('":"')),null!==m?(n=ka(),null!==n?a=[a,b,d,f,g,h,i,j,k,l,m,n]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,"::"===c.substr(jd,2)?(a="::",jd+=2):(a=null,0===kd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(jd)?(d=":",jd++):(d=null,0===kd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(jd)?(g=":",jd++):(g=null,0===kd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(jd)?(i=":",jd++):(i=null,0===kd&&e('":"')),null!==i?(j=ja(),null!==j?(58===c.charCodeAt(jd)?(k=":",jd++):(k=null,0===kd&&e('":"')),null!==k?(l=ka(),null!==l?a=[a,b,d,f,g,h,i,j,k,l]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,"::"===c.substr(jd,2)?(a="::",jd+=2):(a=null,0===kd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(jd)?(d=":",jd++):(d=null,0===kd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(jd)?(g=":",jd++):(g=null,0===kd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(jd)?(i=":",jd++):(i=null,0===kd&&e('":"')),null!==i?(j=ka(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,"::"===c.substr(jd,2)?(a="::",jd+=2):(a=null,0===kd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(jd)?(d=":",jd++):(d=null,0===kd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(jd)?(g=":",jd++):(g=null,0===kd&&e('":"')),null!==g?(h=ka(),null!==h?a=[a,b,d,f,g,h]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,"::"===c.substr(jd,2)?(a="::",jd+=2):(a=null,0===kd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(jd)?(d=":",jd++):(d=null,0===kd&&e('":"')),null!==d?(f=ka(),null!==f?a=[a,b,d,f]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,"::"===c.substr(jd,2)?(a="::",jd+=2):(a=null,0===kd&&e('"::"')),null!==a?(b=ka(),null!==b?a=[a,b]:(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,"::"===c.substr(jd,2)?(a="::",jd+=2):(a=null,0===kd&&e('"::"')),null!==a?(b=ja(),null!==b?a=[a,b]:(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,a=ja(),null!==a?("::"===c.substr(jd,2)?(b="::",jd+=2):(b=null,0===kd&&e('"::"')),null!==b?(d=ja(),null!==d?(58===c.charCodeAt(jd)?(f=":",jd++):(f=null,0===kd&&e('":"')),null!==f?(g=ja(),null!==g?(58===c.charCodeAt(jd)?(h=":",jd++):(h=null,0===kd&&e('":"')),null!==h?(i=ja(),null!==i?(58===c.charCodeAt(jd)?(j=":",jd++):(j=null,0===kd&&e('":"')),null!==j?(k=ja(),null!==k?(58===c.charCodeAt(jd)?(l=":",jd++):(l=null,0===kd&&e('":"')),null!==l?(m=ka(),null!==m?a=[a,b,d,f,g,h,i,j,k,l,m]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,a=ja(),null!==a?(r=jd,58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,jd=r)):(b=null,jd=r),b=null!==b?b:"",null!==b?("::"===c.substr(jd,2)?(d="::",jd+=2):(d=null,0===kd&&e('"::"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(jd)?(g=":",jd++):(g=null,0===kd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(jd)?(i=":",jd++):(i=null,0===kd&&e('":"')),null!==i?(j=ja(),null!==j?(58===c.charCodeAt(jd)?(k=":",jd++):(k=null,0===kd&&e('":"')),null!==k?(l=ka(),null!==l?a=[a,b,d,f,g,h,i,j,k,l]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,a=ja(),null!==a?(r=jd,58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,jd=r)):(b=null,jd=r),b=null!==b?b:"",null!==b?(r=jd,58===c.charCodeAt(jd)?(d=":",jd++):(d=null,0===kd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,jd=r)):(d=null,jd=r),d=null!==d?d:"",null!==d?("::"===c.substr(jd,2)?(f="::",jd+=2):(f=null,0===kd&&e('"::"')),null!==f?(g=ja(),null!==g?(58===c.charCodeAt(jd)?(h=":",jd++):(h=null,0===kd&&e('":"')),null!==h?(i=ja(),null!==i?(58===c.charCodeAt(jd)?(j=":",jd++):(j=null,0===kd&&e('":"')),null!==j?(k=ka(),null!==k?a=[a,b,d,f,g,h,i,j,k]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,a=ja(),null!==a?(r=jd,58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,jd=r)):(b=null,jd=r),b=null!==b?b:"",null!==b?(r=jd,58===c.charCodeAt(jd)?(d=":",jd++):(d=null,0===kd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,jd=r)):(d=null,jd=r),d=null!==d?d:"",null!==d?(r=jd,58===c.charCodeAt(jd)?(f=":",jd++):(f=null,0===kd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,jd=r)):(f=null,jd=r),f=null!==f?f:"",null!==f?("::"===c.substr(jd,2)?(g="::",jd+=2):(g=null,0===kd&&e('"::"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(jd)?(i=":",jd++):(i=null,0===kd&&e('":"')),null!==i?(j=ka(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,a=ja(),null!==a?(r=jd,58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,jd=r)):(b=null,jd=r),b=null!==b?b:"",null!==b?(r=jd,58===c.charCodeAt(jd)?(d=":",jd++):(d=null,0===kd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,jd=r)):(d=null,jd=r),d=null!==d?d:"",null!==d?(r=jd,58===c.charCodeAt(jd)?(f=":",jd++):(f=null,0===kd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,jd=r)):(f=null,jd=r),f=null!==f?f:"",null!==f?(r=jd,58===c.charCodeAt(jd)?(g=":",jd++):(g=null,0===kd&&e('":"')),null!==g?(h=ja(),null!==h?g=[g,h]:(g=null,jd=r)):(g=null,jd=r),g=null!==g?g:"",null!==g?("::"===c.substr(jd,2)?(h="::",jd+=2):(h=null,0===kd&&e('"::"')),null!==h?(i=ka(),null!==i?a=[a,b,d,f,g,h,i]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,a=ja(),null!==a?(r=jd,58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,jd=r)):(b=null,jd=r),b=null!==b?b:"",null!==b?(r=jd,58===c.charCodeAt(jd)?(d=":",jd++):(d=null,0===kd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,jd=r)):(d=null,jd=r),d=null!==d?d:"",null!==d?(r=jd,58===c.charCodeAt(jd)?(f=":",jd++):(f=null,0===kd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,jd=r)):(f=null,jd=r),f=null!==f?f:"",null!==f?(r=jd,58===c.charCodeAt(jd)?(g=":",jd++):(g=null,0===kd&&e('":"')),null!==g?(h=ja(),null!==h?g=[g,h]:(g=null,jd=r)):(g=null,jd=r),g=null!==g?g:"",null!==g?(r=jd,58===c.charCodeAt(jd)?(h=":",jd++):(h=null,0===kd&&e('":"')),null!==h?(i=ja(),null!==i?h=[h,i]:(h=null,jd=r)):(h=null,jd=r),h=null!==h?h:"",null!==h?("::"===c.substr(jd,2)?(i="::",jd+=2):(i=null,0===kd&&e('"::"')),null!==i?(j=ja(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q),null===a&&(q=jd,a=ja(),null!==a?(r=jd,58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,jd=r)):(b=null,jd=r),b=null!==b?b:"",null!==b?(r=jd,58===c.charCodeAt(jd)?(d=":",jd++):(d=null,0===kd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,jd=r)):(d=null,jd=r),d=null!==d?d:"",null!==d?(r=jd,58===c.charCodeAt(jd)?(f=":",jd++):(f=null,0===kd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,jd=r)):(f=null,jd=r),f=null!==f?f:"",null!==f?(r=jd,58===c.charCodeAt(jd)?(g=":",jd++):(g=null,0===kd&&e('":"')),null!==g?(h=ja(),null!==h?g=[g,h]:(g=null,jd=r)):(g=null,jd=r),g=null!==g?g:"",null!==g?(r=jd,58===c.charCodeAt(jd)?(h=":",jd++):(h=null,0===kd&&e('":"')),null!==h?(i=ja(),null!==i?h=[h,i]:(h=null,jd=r)):(h=null,jd=r),h=null!==h?h:"",null!==h?(r=jd,58===c.charCodeAt(jd)?(i=":",jd++):(i=null,0===kd&&e('":"')),null!==i?(j=ja(),null!==j?i=[i,j]:(i=null,jd=r)):(i=null,jd=r),i=null!==i?i:"",null!==i?("::"===c.substr(jd,2)?(j="::",jd+=2):(j=null,0===kd&&e('"::"')),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q)):(a=null,jd=q))))))))))))))),null!==a&&(a=function(a){return pd.host_type="IPv6",c.substring(jd,a)}(p)),null===a&&(jd=p),a}function ja(){var a,b,c,d,e;return e=jd,a=i(),null!==a?(b=i(),b=null!==b?b:"",null!==b?(c=i(),c=null!==c?c:"",null!==c?(d=i(),d=null!==d?d:"",null!==d?a=[a,b,c,d]:(a=null,jd=e)):(a=null,jd=e)):(a=null,jd=e)):(a=null,jd=e),a}function ka(){var a,b,d,f;return f=jd,a=ja(),null!==a?(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=ja(),null!==d?a=[a,b,d]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),null===a&&(a=la()),a}function la(){var a,b,d,f,g,h,i,j,k;return j=jd,k=jd,a=ma(),null!==a?(46===c.charCodeAt(jd)?(b=".",jd++):(b=null,0===kd&&e('"."')),null!==b?(d=ma(),null!==d?(46===c.charCodeAt(jd)?(f=".",jd++):(f=null,0===kd&&e('"."')),null!==f?(g=ma(),null!==g?(46===c.charCodeAt(jd)?(h=".",jd++):(h=null,0===kd&&e('"."')),null!==h?(i=ma(),null!==i?a=[a,b,d,f,g,h,i]:(a=null,jd=k)):(a=null,jd=k)):(a=null,jd=k)):(a=null,jd=k)):(a=null,jd=k)):(a=null,jd=k)):(a=null,jd=k),null!==a&&(a=function(a){return pd.host_type="IPv4",c.substring(jd,a)}(j)),null===a&&(jd=j),a}function ma(){var a,b,d,f;return f=jd,"25"===c.substr(jd,2)?(a="25",jd+=2):(a=null,0===kd&&e('"25"')),null!==a?(/^[0-5]/.test(c.charAt(jd))?(b=c.charAt(jd),jd++):(b=null,0===kd&&e("[0-5]")),null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),null===a&&(f=jd,50===c.charCodeAt(jd)?(a="2",jd++):(a=null,0===kd&&e('"2"')),null!==a?(/^[0-4]/.test(c.charAt(jd))?(b=c.charAt(jd),jd++):(b=null,0===kd&&e("[0-4]")),null!==b?(d=g(),null!==d?a=[a,b,d]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),null===a&&(f=jd,49===c.charCodeAt(jd)?(a="1",jd++):(a=null,0===kd&&e('"1"')),null!==a?(b=g(),null!==b?(d=g(),null!==d?a=[a,b,d]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),null===a&&(f=jd,/^[1-9]/.test(c.charAt(jd))?(a=c.charAt(jd),jd++):(a=null,0===kd&&e("[1-9]")),null!==a?(b=g(),null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),null===a&&(a=g())))),a}function na(){var a,b,c,d,e,f,h;return f=jd,h=jd,a=g(),a=null!==a?a:"",null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?(d=g(),d=null!==d?d:"",null!==d?(e=g(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,jd=h)):(a=null,jd=h)):(a=null,jd=h)):(a=null,jd=h)):(a=null,jd=h),null!==a&&(a=function(a,b){return b=parseInt(b.join("")),pd.port=b,b}(f,a)),null===a&&(jd=f),a}function oa(){var a,b,d,f;for(a=[],f=jd,59===c.charCodeAt(jd)?(b=";",jd++):(b=null,0===kd&&e('";"')),null!==b?(d=pa(),null!==d?b=[b,d]:(b=null,jd=f)):(b=null,jd=f);null!==b;)a.push(b),f=jd,59===c.charCodeAt(jd)?(b=";",jd++):(b=null,0===kd&&e('";"')),null!==b?(d=pa(),null!==d?b=[b,d]:(b=null,jd=f)):(b=null,jd=f);return a}function pa(){var a;return a=qa(),null===a&&(a=ra(),null===a&&(a=sa(),null===a&&(a=ta(),null===a&&(a=ua(),null===a&&(a=va(),null===a&&(a=wa())))))),a}function qa(){var a,b,d,f;return d=jd,f=jd,"transport="===c.substr(jd,10).toLowerCase()?(a=c.substr(jd,10),jd+=10):(a=null,0===kd&&e('"transport="')),null!==a?("udp"===c.substr(jd,3).toLowerCase()?(b=c.substr(jd,3),jd+=3):(b=null,0===kd&&e('"udp"')),null===b&&("tcp"===c.substr(jd,3).toLowerCase()?(b=c.substr(jd,3),jd+=3):(b=null,0===kd&&e('"tcp"')),null===b&&("sctp"===c.substr(jd,4).toLowerCase()?(b=c.substr(jd,4),jd+=4):(b=null,0===kd&&e('"sctp"')),null===b&&("tls"===c.substr(jd,3).toLowerCase()?(b=c.substr(jd,3),jd+=3):(b=null,0===kd&&e('"tls"')),null===b&&(b=B())))),null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),null!==a&&(a=function(a,b){pd.uri_params||(pd.uri_params={}),pd.uri_params.transport=b.toLowerCase()}(d,a[1])),null===a&&(jd=d),a}function ra(){var a,b,d,f;return d=jd,f=jd,"user="===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"user="')),null!==a?("phone"===c.substr(jd,5).toLowerCase()?(b=c.substr(jd,5),jd+=5):(b=null,0===kd&&e('"phone"')),null===b&&("ip"===c.substr(jd,2).toLowerCase()?(b=c.substr(jd,2),jd+=2):(b=null,0===kd&&e('"ip"')),null===b&&(b=B())),null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),null!==a&&(a=function(a,b){pd.uri_params||(pd.uri_params={}),pd.uri_params.user=b.toLowerCase()}(d,a[1])),null===a&&(jd=d),a}function sa(){var a,b,d,f;return d=jd,f=jd,"method="===c.substr(jd,7).toLowerCase()?(a=c.substr(jd,7),jd+=7):(a=null,0===kd&&e('"method="')),null!==a?(b=gb(),null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),null!==a&&(a=function(a,b){pd.uri_params||(pd.uri_params={}),pd.uri_params.method=b}(d,a[1])),null===a&&(jd=d),a}function ta(){var a,b,d,f;return d=jd,f=jd,"ttl="===c.substr(jd,4).toLowerCase()?(a=c.substr(jd,4),jd+=4):(a=null,0===kd&&e('"ttl="')),null!==a?(b=Pc(),null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),null!==a&&(a=function(a,b){pd.params||(pd.params={}),pd.params.ttl=b}(d,a[1])),null===a&&(jd=d),a}function ua(){var a,b,d,f;return d=jd,f=jd,"maddr="===c.substr(jd,6).toLowerCase()?(a=c.substr(jd,6),jd+=6):(a=null,0===kd&&e('"maddr="')),null!==a?(b=da(),null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),null!==a&&(a=function(a,b){pd.uri_params||(pd.uri_params={}),pd.uri_params.maddr=b}(d,a[1])),null===a&&(jd=d),a}function va(){var a,b,d,f,g,h;return f=jd,g=jd,"lr"===c.substr(jd,2).toLowerCase()?(a=c.substr(jd,2),jd+=2):(a=null,0===kd&&e('"lr"')),null!==a?(h=jd,61===c.charCodeAt(jd)?(b="=",jd++):(b=null,0===kd&&e('"="')),null!==b?(d=B(),null!==d?b=[b,d]:(b=null,jd=h)):(b=null,jd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){pd.uri_params||(pd.uri_params={}),pd.uri_params.lr=void 0}(f)),null===a&&(jd=f),a}function wa(){var a,b,d,f,g,h;return f=jd,g=jd,a=xa(),null!==a?(h=jd,61===c.charCodeAt(jd)?(b="=",jd++):(b=null,0===kd&&e('"="')),null!==b?(d=ya(),null!==d?b=[b,d]:(b=null,jd=h)):(b=null,jd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b,c){pd.uri_params||(pd.uri_params={}),c="undefined"==typeof c?void 0:c[1],pd.uri_params[b.toLowerCase()]=c&&c.toLowerCase()}(f,a[0],a[1])),null===a&&(jd=f),a}function xa(){var a,b,c;if(c=jd,b=za(),null!==b)for(a=[];null!==b;)a.push(b),b=za();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(c,a)),null===a&&(jd=c),a}function ya(){var a,b,c;if(c=jd,b=za(),null!==b)for(a=[];null!==b;)a.push(b),b=za();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(c,a)),null===a&&(jd=c),a}function za(){var a;return a=Aa(),null===a&&(a=q(),null===a&&(a=s())),a}function Aa(){var a;return 91===c.charCodeAt(jd)?(a="[",jd++):(a=null,0===kd&&e('"["')),null===a&&(93===c.charCodeAt(jd)?(a="]",jd++):(a=null,0===kd&&e('"]"')),null===a&&(47===c.charCodeAt(jd)?(a="/",jd++):(a=null,0===kd&&e('"/"')),null===a&&(58===c.charCodeAt(jd)?(a=":",jd++):(a=null,0===kd&&e('":"')),null===a&&(38===c.charCodeAt(jd)?(a="&",jd++):(a=null,0===kd&&e('"&"')),null===a&&(43===c.charCodeAt(jd)?(a="+",jd++):(a=null,0===kd&&e('"+"')),null===a&&(36===c.charCodeAt(jd)?(a="$",jd++):(a=null,0===kd&&e('"$"')))))))),a}function Ba(){var a,b,d,f,g,h,i;if(h=jd,63===c.charCodeAt(jd)?(a="?",jd++):(a=null,
0===kd&&e('"?"')),null!==a)if(b=Ca(),null!==b){for(d=[],i=jd,38===c.charCodeAt(jd)?(f="&",jd++):(f=null,0===kd&&e('"&"')),null!==f?(g=Ca(),null!==g?f=[f,g]:(f=null,jd=i)):(f=null,jd=i);null!==f;)d.push(f),i=jd,38===c.charCodeAt(jd)?(f="&",jd++):(f=null,0===kd&&e('"&"')),null!==f?(g=Ca(),null!==g?f=[f,g]:(f=null,jd=i)):(f=null,jd=i);null!==d?a=[a,b,d]:(a=null,jd=h)}else a=null,jd=h;else a=null,jd=h;return a}function Ca(){var a,b,d,f,g;return f=jd,g=jd,a=Da(),null!==a?(61===c.charCodeAt(jd)?(b="=",jd++):(b=null,0===kd&&e('"="')),null!==b?(d=Ea(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b,c){b=b.join("").toLowerCase(),c=c.join(""),pd.uri_headers||(pd.uri_headers={}),pd.uri_headers[b]?pd.uri_headers[b].push(c):pd.uri_headers[b]=[c]}(f,a[0],a[2])),null===a&&(jd=f),a}function Da(){var a,b;if(b=Fa(),null===b&&(b=q(),null===b&&(b=s())),null!==b)for(a=[];null!==b;)a.push(b),b=Fa(),null===b&&(b=q(),null===b&&(b=s()));else a=null;return a}function Ea(){var a,b;for(a=[],b=Fa(),null===b&&(b=q(),null===b&&(b=s()));null!==b;)a.push(b),b=Fa(),null===b&&(b=q(),null===b&&(b=s()));return a}function Fa(){var a;return 91===c.charCodeAt(jd)?(a="[",jd++):(a=null,0===kd&&e('"["')),null===a&&(93===c.charCodeAt(jd)?(a="]",jd++):(a=null,0===kd&&e('"]"')),null===a&&(47===c.charCodeAt(jd)?(a="/",jd++):(a=null,0===kd&&e('"/"')),null===a&&(63===c.charCodeAt(jd)?(a="?",jd++):(a=null,0===kd&&e('"?"')),null===a&&(58===c.charCodeAt(jd)?(a=":",jd++):(a=null,0===kd&&e('":"')),null===a&&(43===c.charCodeAt(jd)?(a="+",jd++):(a=null,0===kd&&e('"+"')),null===a&&(36===c.charCodeAt(jd)?(a="$",jd++):(a=null,0===kd&&e('"$"')))))))),a}function Ga(){var a;return a=hb(),null===a&&(a=Ha()),a}function Ha(){var a,b,c,d,e,f;return f=jd,a=gb(),null!==a?(b=m(),null!==b?(c=Ia(),null!==c?(d=m(),null!==d?(e=Za(),null!==e?a=[a,b,c,d,e]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),a}function Ia(){var a;return a=Y(),null===a&&(a=Ja()),a}function Ja(){var a,b,d,f;return f=jd,a=Ua(),null!==a?(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=Ka(),null===d&&(d=Na()),null!==d?a=[a,b,d]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),a}function Ka(){var a,b,d,f,g;return f=jd,a=La(),null===a&&(a=Ma()),null!==a?(g=jd,63===c.charCodeAt(jd)?(b="?",jd++):(b=null,0===kd&&e('"?"')),null!==b?(d=Ya(),null!==d?b=[b,d]:(b=null,jd=g)):(b=null,jd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),a}function La(){var a,b,d,f;return f=jd,"//"===c.substr(jd,2)?(a="//",jd+=2):(a=null,0===kd&&e('"//"')),null!==a?(b=Va(),null!==b?(d=Ma(),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),a}function Ma(){var a,b,d;return d=jd,47===c.charCodeAt(jd)?(a="/",jd++):(a=null,0===kd&&e('"/"')),null!==a?(b=Qa(),null!==b?a=[a,b]:(a=null,jd=d)):(a=null,jd=d),a}function Na(){var a,b,c,d;if(d=jd,a=Pa(),null!==a){for(b=[],c=Oa();null!==c;)b.push(c),c=Oa();null!==b?a=[a,b]:(a=null,jd=d)}else a=null,jd=d;return a}function Oa(){var a;return a=p(),null===a&&(a=q(),null===a&&(a=s())),a}function Pa(){var a;return a=q(),null===a&&(a=s(),null===a&&(59===c.charCodeAt(jd)?(a=";",jd++):(a=null,0===kd&&e('";"')),null===a&&(63===c.charCodeAt(jd)?(a="?",jd++):(a=null,0===kd&&e('"?"')),null===a&&(58===c.charCodeAt(jd)?(a=":",jd++):(a=null,0===kd&&e('":"')),null===a&&(64===c.charCodeAt(jd)?(a="@",jd++):(a=null,0===kd&&e('"@"')),null===a&&(38===c.charCodeAt(jd)?(a="&",jd++):(a=null,0===kd&&e('"&"')),null===a&&(61===c.charCodeAt(jd)?(a="=",jd++):(a=null,0===kd&&e('"="')),null===a&&(43===c.charCodeAt(jd)?(a="+",jd++):(a=null,0===kd&&e('"+"')),null===a&&(36===c.charCodeAt(jd)?(a="$",jd++):(a=null,0===kd&&e('"$"')),null===a&&(44===c.charCodeAt(jd)?(a=",",jd++):(a=null,0===kd&&e('","')))))))))))),a}function Qa(){var a,b,d,f,g,h;if(g=jd,a=Ra(),null!==a){for(b=[],h=jd,47===c.charCodeAt(jd)?(d="/",jd++):(d=null,0===kd&&e('"/"')),null!==d?(f=Ra(),null!==f?d=[d,f]:(d=null,jd=h)):(d=null,jd=h);null!==d;)b.push(d),h=jd,47===c.charCodeAt(jd)?(d="/",jd++):(d=null,0===kd&&e('"/"')),null!==d?(f=Ra(),null!==f?d=[d,f]:(d=null,jd=h)):(d=null,jd=h);null!==b?a=[a,b]:(a=null,jd=g)}else a=null,jd=g;return a}function Ra(){var a,b,d,f,g,h;for(g=jd,a=[],b=Ta();null!==b;)a.push(b),b=Ta();if(null!==a){for(b=[],h=jd,59===c.charCodeAt(jd)?(d=";",jd++):(d=null,0===kd&&e('";"')),null!==d?(f=Sa(),null!==f?d=[d,f]:(d=null,jd=h)):(d=null,jd=h);null!==d;)b.push(d),h=jd,59===c.charCodeAt(jd)?(d=";",jd++):(d=null,0===kd&&e('";"')),null!==d?(f=Sa(),null!==f?d=[d,f]:(d=null,jd=h)):(d=null,jd=h);null!==b?a=[a,b]:(a=null,jd=g)}else a=null,jd=g;return a}function Sa(){var a,b;for(a=[],b=Ta();null!==b;)a.push(b),b=Ta();return a}function Ta(){var a;return a=q(),null===a&&(a=s(),null===a&&(58===c.charCodeAt(jd)?(a=":",jd++):(a=null,0===kd&&e('":"')),null===a&&(64===c.charCodeAt(jd)?(a="@",jd++):(a=null,0===kd&&e('"@"')),null===a&&(38===c.charCodeAt(jd)?(a="&",jd++):(a=null,0===kd&&e('"&"')),null===a&&(61===c.charCodeAt(jd)?(a="=",jd++):(a=null,0===kd&&e('"="')),null===a&&(43===c.charCodeAt(jd)?(a="+",jd++):(a=null,0===kd&&e('"+"')),null===a&&(36===c.charCodeAt(jd)?(a="$",jd++):(a=null,0===kd&&e('"$"')),null===a&&(44===c.charCodeAt(jd)?(a=",",jd++):(a=null,0===kd&&e('","')))))))))),a}function Ua(){var a,b,d,f,i;if(f=jd,i=jd,a=h(),null!==a){for(b=[],d=h(),null===d&&(d=g(),null===d&&(43===c.charCodeAt(jd)?(d="+",jd++):(d=null,0===kd&&e('"+"')),null===d&&(45===c.charCodeAt(jd)?(d="-",jd++):(d=null,0===kd&&e('"-"')),null===d&&(46===c.charCodeAt(jd)?(d=".",jd++):(d=null,0===kd&&e('"."'))))));null!==d;)b.push(d),d=h(),null===d&&(d=g(),null===d&&(43===c.charCodeAt(jd)?(d="+",jd++):(d=null,0===kd&&e('"+"')),null===d&&(45===c.charCodeAt(jd)?(d="-",jd++):(d=null,0===kd&&e('"-"')),null===d&&(46===c.charCodeAt(jd)?(d=".",jd++):(d=null,0===kd&&e('"."'))))));null!==b?a=[a,b]:(a=null,jd=i)}else a=null,jd=i;return null!==a&&(a=function(a){pd.scheme=c.substring(jd,a)}(f)),null===a&&(jd=f),a}function Va(){var a;return a=Wa(),null===a&&(a=Xa()),a}function Wa(){var a,b,d,f;return d=jd,f=jd,a=$(),null!==a?(64===c.charCodeAt(jd)?(b="@",jd++):(b=null,0===kd&&e('"@"')),null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),a=null!==a?a:"",null!==a?(b=ca(),null!==b?a=[a,b]:(a=null,jd=d)):(a=null,jd=d),a=null!==a?a:""}function Xa(){var a,b;if(b=q(),null===b&&(b=s(),null===b&&(36===c.charCodeAt(jd)?(b="$",jd++):(b=null,0===kd&&e('"$"')),null===b&&(44===c.charCodeAt(jd)?(b=",",jd++):(b=null,0===kd&&e('","')),null===b&&(59===c.charCodeAt(jd)?(b=";",jd++):(b=null,0===kd&&e('";"')),null===b&&(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null===b&&(64===c.charCodeAt(jd)?(b="@",jd++):(b=null,0===kd&&e('"@"')),null===b&&(38===c.charCodeAt(jd)?(b="&",jd++):(b=null,0===kd&&e('"&"')),null===b&&(61===c.charCodeAt(jd)?(b="=",jd++):(b=null,0===kd&&e('"="')),null===b&&(43===c.charCodeAt(jd)?(b="+",jd++):(b=null,0===kd&&e('"+"'))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(36===c.charCodeAt(jd)?(b="$",jd++):(b=null,0===kd&&e('"$"')),null===b&&(44===c.charCodeAt(jd)?(b=",",jd++):(b=null,0===kd&&e('","')),null===b&&(59===c.charCodeAt(jd)?(b=";",jd++):(b=null,0===kd&&e('";"')),null===b&&(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null===b&&(64===c.charCodeAt(jd)?(b="@",jd++):(b=null,0===kd&&e('"@"')),null===b&&(38===c.charCodeAt(jd)?(b="&",jd++):(b=null,0===kd&&e('"&"')),null===b&&(61===c.charCodeAt(jd)?(b="=",jd++):(b=null,0===kd&&e('"="')),null===b&&(43===c.charCodeAt(jd)?(b="+",jd++):(b=null,0===kd&&e('"+"')))))))))));else a=null;return a}function Ya(){var a,b;for(a=[],b=Oa();null!==b;)a.push(b),b=Oa();return a}function Za(){var a,b,d,f,h,i,j,k;if(j=jd,k=jd,"sip"===c.substr(jd,3).toLowerCase()?(a=c.substr(jd,3),jd+=3):(a=null,0===kd&&e('"SIP"')),null!==a)if(47===c.charCodeAt(jd)?(b="/",jd++):(b=null,0===kd&&e('"/"')),null!==b){if(f=g(),null!==f)for(d=[];null!==f;)d.push(f),f=g();else d=null;if(null!==d)if(46===c.charCodeAt(jd)?(f=".",jd++):(f=null,0===kd&&e('"."')),null!==f){if(i=g(),null!==i)for(h=[];null!==i;)h.push(i),i=g();else h=null;null!==h?a=[a,b,d,f,h]:(a=null,jd=k)}else a=null,jd=k;else a=null,jd=k}else a=null,jd=k;else a=null,jd=k;return null!==a&&(a=function(a){pd.sip_version=c.substring(jd,a)}(j)),null===a&&(jd=j),a}function $a(){var a;return"INVITE"===c.substr(jd,6)?(a="INVITE",jd+=6):(a=null,0===kd&&e('"INVITE"')),a}function _a(){var a;return"ACK"===c.substr(jd,3)?(a="ACK",jd+=3):(a=null,0===kd&&e('"ACK"')),a}function ab(){var a;return"OPTIONS"===c.substr(jd,7)?(a="OPTIONS",jd+=7):(a=null,0===kd&&e('"OPTIONS"')),a}function bb(){var a;return"BYE"===c.substr(jd,3)?(a="BYE",jd+=3):(a=null,0===kd&&e('"BYE"')),a}function cb(){var a;return"CANCEL"===c.substr(jd,6)?(a="CANCEL",jd+=6):(a=null,0===kd&&e('"CANCEL"')),a}function db(){var a;return"REGISTER"===c.substr(jd,8)?(a="REGISTER",jd+=8):(a=null,0===kd&&e('"REGISTER"')),a}function eb(){var a;return"SUBSCRIBE"===c.substr(jd,9)?(a="SUBSCRIBE",jd+=9):(a=null,0===kd&&e('"SUBSCRIBE"')),a}function fb(){var a;return"NOTIFY"===c.substr(jd,6)?(a="NOTIFY",jd+=6):(a=null,0===kd&&e('"NOTIFY"')),a}function gb(){var a,b;return b=jd,a=$a(),null===a&&(a=_a(),null===a&&(a=ab(),null===a&&(a=bb(),null===a&&(a=cb(),null===a&&(a=db(),null===a&&(a=eb(),null===a&&(a=fb(),null===a&&(a=B())))))))),null!==a&&(a=function(a){return pd.method=c.substring(jd,a),pd.method}(b)),null===a&&(jd=b),a}function hb(){var a,b,c,d,e,f;return f=jd,a=Za(),null!==a?(b=m(),null!==b?(c=ib(),null!==c?(d=m(),null!==d?(e=kb(),null!==e?a=[a,b,c,d,e]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),a}function ib(){var a,b;return b=jd,a=jb(),null!==a&&(a=function(a,b){pd.status_code=parseInt(b.join(""))}(b,a)),null===a&&(jd=b),a}function jb(){var a,b,c,d;return d=jd,a=g(),null!==a?(b=g(),null!==b?(c=g(),null!==c?a=[a,b,c]:(a=null,jd=d)):(a=null,jd=d)):(a=null,jd=d),a}function kb(){var a,b,d;for(d=jd,a=[],b=p(),null===b&&(b=q(),null===b&&(b=s(),null===b&&(b=y(),null===b&&(b=z(),null===b&&(b=m(),null===b&&(b=n()))))));null!==b;)a.push(b),b=p(),null===b&&(b=q(),null===b&&(b=s(),null===b&&(b=y(),null===b&&(b=z(),null===b&&(b=m(),null===b&&(b=n()))))));return null!==a&&(a=function(a){pd.reason_phrase=c.substring(jd,a)}(d)),null===a&&(jd=d),a}function lb(){var a,b,c,d,e,f;if(e=jd,a=Sb(),null!==a){for(b=[],f=jd,c=M(),null!==c?(d=Sb(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==c;)b.push(c),f=jd,c=M(),null!==c?(d=Sb(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==b?a=[a,b]:(a=null,jd=e)}else a=null,jd=e;return a}function mb(){var a,b,d,f,g,h;return f=jd,g=jd,a=E(),null!==a?(h=jd,64===c.charCodeAt(jd)?(b="@",jd++):(b=null,0===kd&&e('"@"')),null!==b?(d=E(),null!==d?b=[b,d]:(b=null,jd=h)):(b=null,jd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a){pd=c.substring(jd,a)}(f)),null===a&&(jd=f),a}function nb(){var a,b,c,d,e,f,g;if(e=jd,a=F(),null===a)if(f=jd,a=ob(),null!==a){for(b=[],g=jd,c=M(),null!==c?(d=ob(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==c;)b.push(c),g=jd,c=M(),null!==c?(d=ob(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==b?a=[a,b]:(a=null,jd=f)}else a=null,jd=f;return null!==a&&(a=function(a){var b,c;for(c=pd.multi_header.length,b=0;c>b;b++)if(null===pd.multi_header[b].parsed){pd=null;break}pd=null!==pd?pd.multi_header:-1}(e)),null===a&&(jd=e),a}function ob(){var a,b,c,d,e,f,g;if(e=jd,f=jd,a=X(),null===a&&(a=pb()),null!==a){for(b=[],g=jd,c=N(),null!==c?(d=rb(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==c;)b.push(c),g=jd,c=N(),null!==c?(d=rb(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==b?a=[a,b]:(a=null,jd=f)}else a=null,jd=f;return null!==a&&(a=function(a){var b;pd.multi_header||(pd.multi_header=[]);try{b=new od(pd.uri,pd.display_name,pd.params),delete pd.uri,delete pd.display_name,delete pd.params}catch(c){b=null}pd.multi_header.push({possition:jd,offset:a,parsed:b})}(e)),null===a&&(jd=e),a}function pb(){var a,b,c,d,e;return e=jd,a=qb(),a=null!==a?a:"",null!==a?(b=L(),null!==b?(c=Y(),null!==c?(d=K(),null!==d?a=[a,b,c,d]:(a=null,jd=e)):(a=null,jd=e)):(a=null,jd=e)):(a=null,jd=e),a}function qb(){var a,b,d,e,f,g,h;if(f=jd,g=jd,a=B(),null!==a){for(b=[],h=jd,d=t(),null!==d?(e=B(),null!==e?d=[d,e]:(d=null,jd=h)):(d=null,jd=h);null!==d;)b.push(d),h=jd,d=t(),null!==d?(e=B(),null!==e?d=[d,e]:(d=null,jd=h)):(d=null,jd=h);null!==b?a=[a,b]:(a=null,jd=g)}else a=null,jd=g;return null===a&&(a=T()),null!==a&&(a=function(a,b){b=c.substring(jd,a).trim(),'"'===b[0]&&(b=b.substring(1,b.length-1)),pd.display_name=b}(f,a)),null===a&&(jd=f),a}function rb(){var a;return a=sb(),null===a&&(a=tb(),null===a&&(a=wb())),a}function sb(){var a,b,d,f,g;return f=jd,g=jd,"q"===c.substr(jd,1).toLowerCase()?(a=c.substr(jd,1),jd++):(a=null,0===kd&&e('"q"')),null!==a?(b=H(),null!==b?(d=vb(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){pd.params||(pd.params={}),pd.params.q=b}(f,a[2])),null===a&&(jd=f),a}function tb(){var a,b,d,f,g;return f=jd,g=jd,"expires"===c.substr(jd,7).toLowerCase()?(a=c.substr(jd,7),jd+=7):(a=null,0===kd&&e('"expires"')),null!==a?(b=H(),null!==b?(d=ub(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){pd.params||(pd.params={}),pd.params.expires=b}(f,a[2])),null===a&&(jd=f),a}function ub(){var a,b,c;if(c=jd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){return parseInt(b.join(""))}(c,a)),null===a&&(jd=c),a}function vb(){var a,b,d,f,h,i,j,k;return i=jd,j=jd,48===c.charCodeAt(jd)?(a="0",jd++):(a=null,0===kd&&e('"0"')),null!==a?(k=jd,46===c.charCodeAt(jd)?(b=".",jd++):(b=null,0===kd&&e('"."')),null!==b?(d=g(),d=null!==d?d:"",null!==d?(f=g(),f=null!==f?f:"",null!==f?(h=g(),h=null!==h?h:"",null!==h?b=[b,d,f,h]:(b=null,jd=k)):(b=null,jd=k)):(b=null,jd=k)):(b=null,jd=k),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,jd=j)):(a=null,jd=j),null!==a&&(a=function(a){return parseFloat(c.substring(jd,a))}(i)),null===a&&(jd=i),a}function wb(){var a,b,c,d,e,f;return d=jd,e=jd,a=B(),null!==a?(f=jd,b=H(),null!==b?(c=xb(),null!==c?b=[b,c]:(b=null,jd=f)):(b=null,jd=f),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,jd=e)):(a=null,jd=e),null!==a&&(a=function(a,b,c){pd.params||(pd.params={}),c="undefined"==typeof c?void 0:c[1],pd.params[b.toLowerCase()]=c}(d,a[0],a[1])),null===a&&(jd=d),a}function xb(){var a;return a=B(),null===a&&(a=da(),null===a&&(a=T())),a}function yb(){var a,b,c,d,e,f;if(e=jd,a=zb(),null!==a){for(b=[],f=jd,c=N(),null!==c?(d=Ab(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==c;)b.push(c),f=jd,c=N(),null!==c?(d=Ab(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==b?a=[a,b]:(a=null,jd=e)}else a=null,jd=e;return a}function zb(){var a;return"render"===c.substr(jd,6).toLowerCase()?(a=c.substr(jd,6),jd+=6):(a=null,0===kd&&e('"render"')),null===a&&("session"===c.substr(jd,7).toLowerCase()?(a=c.substr(jd,7),jd+=7):(a=null,0===kd&&e('"session"')),null===a&&("icon"===c.substr(jd,4).toLowerCase()?(a=c.substr(jd,4),jd+=4):(a=null,0===kd&&e('"icon"')),null===a&&("alert"===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"alert"')),null===a&&(a=B())))),a}function Ab(){var a;return a=Bb(),null===a&&(a=wb()),a}function Bb(){var a,b,d,f;return f=jd,"handling"===c.substr(jd,8).toLowerCase()?(a=c.substr(jd,8),jd+=8):(a=null,0===kd&&e('"handling"')),null!==a?(b=H(),null!==b?("optional"===c.substr(jd,8).toLowerCase()?(d=c.substr(jd,8),jd+=8):(d=null,0===kd&&e('"optional"')),null===d&&("required"===c.substr(jd,8).toLowerCase()?(d=c.substr(jd,8),jd+=8):(d=null,0===kd&&e('"required"')),null===d&&(d=B())),null!==d?a=[a,b,d]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),a}function Cb(){var a,b,c,d,e,f;if(e=jd,a=B(),null!==a){for(b=[],f=jd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==c;)b.push(c),f=jd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==b?a=[a,b]:(a=null,jd=e)}else a=null,jd=e;return a}function Db(){var a,b,c;if(c=jd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){pd=parseInt(b.join(""))}(c,a)),null===a&&(jd=c),a}function Eb(){var a,b;return b=jd,a=Fb(),null!==a&&(a=function(a){pd=c.substring(jd,a)}(b)),null===a&&(jd=b),a}function Fb(){var a,b,c,d,e,f,g,h;if(g=jd,a=Gb(),null!==a)if(b=G(),null!==b)if(c=Lb(),null!==c){for(d=[],h=jd,e=N(),null!==e?(f=Mb(),null!==f?e=[e,f]:(e=null,jd=h)):(e=null,jd=h);null!==e;)d.push(e),h=jd,e=N(),null!==e?(f=Mb(),null!==f?e=[e,f]:(e=null,jd=h)):(e=null,jd=h);null!==d?a=[a,b,c,d]:(a=null,jd=g)}else a=null,jd=g;else a=null,jd=g;else a=null,jd=g;return a}function Gb(){var a;return a=Hb(),null===a&&(a=Ib()),a}function Hb(){var a;return"text"===c.substr(jd,4).toLowerCase()?(a=c.substr(jd,4),jd+=4):(a=null,0===kd&&e('"text"')),null===a&&("image"===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"image"')),null===a&&("audio"===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"audio"')),null===a&&("video"===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"video"')),null===a&&("application"===c.substr(jd,11).toLowerCase()?(a=c.substr(jd,11),jd+=11):(a=null,0===kd&&e('"application"')),null===a&&(a=Jb()))))),a}function Ib(){var a;return"message"===c.substr(jd,7).toLowerCase()?(a=c.substr(jd,7),jd+=7):(a=null,0===kd&&e('"message"')),null===a&&("multipart"===c.substr(jd,9).toLowerCase()?(a=c.substr(jd,9),jd+=9):(a=null,0===kd&&e('"multipart"')),null===a&&(a=Jb())),a}function Jb(){var a;return a=B(),null===a&&(a=Kb()),a}function Kb(){var a,b,d;return d=jd,"x-"===c.substr(jd,2).toLowerCase()?(a=c.substr(jd,2),jd+=2):(a=null,0===kd&&e('"x-"')),null!==a?(b=B(),null!==b?a=[a,b]:(a=null,jd=d)):(a=null,jd=d),a}function Lb(){var a;return a=Jb(),null===a&&(a=B()),a}function Mb(){var a,b,c,d;return d=jd,a=B(),null!==a?(b=H(),null!==b?(c=Nb(),null!==c?a=[a,b,c]:(a=null,jd=d)):(a=null,jd=d)):(a=null,jd=d),a}function Nb(){var a;return a=B(),null===a&&(a=T()),a}function Ob(){var a,b,c,d;return d=jd,a=Pb(),null!==a?(b=t(),null!==b?(c=gb(),null!==c?a=[a,b,c]:(a=null,jd=d)):(a=null,jd=d)):(a=null,jd=d),a}function Pb(){var a,b,c;if(c=jd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){pd.value=parseInt(b.join(""))}(c,a)),null===a&&(jd=c),a}function Qb(){var a,b;return b=jd,a=ub(),null!==a&&(a=function(a,b){pd=b}(b,a)),null===a&&(jd=b),a}function Rb(){var a,b,c,d,e,f,g;if(e=jd,f=jd,a=Sb(),null!==a){for(b=[],g=jd,c=N(),null!==c?(d=wb(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==c;)b.push(c),g=jd,c=N(),null!==c?(d=wb(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==b?a=[a,b]:(a=null,jd=f)}else a=null,jd=f;return null!==a&&(a=function(a,b){pd.event=b.join("").toLowerCase()}(e,a[0])),null===a&&(jd=e),a}function Sb(){var a,b,d,f,g,h;if(g=jd,a=C(),null!==a){for(b=[],h=jd,46===c.charCodeAt(jd)?(d=".",jd++):(d=null,0===kd&&e('"."')),null!==d?(f=C(),null!==f?d=[d,f]:(d=null,jd=h)):(d=null,jd=h);null!==d;)b.push(d),h=jd,46===c.charCodeAt(jd)?(d=".",jd++):(d=null,0===kd&&e('"."')),null!==d?(f=C(),null!==f?d=[d,f]:(d=null,jd=h)):(d=null,jd=h);null!==b?a=[a,b]:(a=null,jd=g)}else a=null,jd=g;return a}function Tb(){var a,b,c,d,e,f,g;if(e=jd,f=jd,a=X(),null===a&&(a=pb()),null!==a){for(b=[],g=jd,c=N(),null!==c?(d=Ub(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==c;)b.push(c),g=jd,c=N(),null!==c?(d=Ub(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==b?a=[a,b]:(a=null,jd=f)}else a=null,jd=f;return null!==a&&(a=function(a){var b=pd.tag;try{pd=new od(pd.uri,pd.display_name,pd.params),b&&pd.setParam("tag",b)}catch(c){pd=-1}}(e)),null===a&&(jd=e),a}function Ub(){var a;return a=Vb(),null===a&&(a=wb()),a}function Vb(){var a,b,d,f,g;return f=jd,g=jd,"tag"===c.substr(jd,3).toLowerCase()?(a=c.substr(jd,3),jd+=3):(a=null,0===kd&&e('"tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){pd.tag=b}(f,a[2])),null===a&&(jd=f),a}function Wb(){var a,b,c;if(c=jd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){pd=parseInt(b.join(""))}(c,a)),null===a&&(jd=c),a}function Xb(){var a,b;return b=jd,a=ub(),null!==a&&(a=function(a,b){pd=b}(b,a)),null===a&&(jd=b),a}function Yb(){var a,b,c,d,e,f,g,h,i,j;for(h=jd,i=jd,a=[],b=qb();null!==b;)a.push(b),b=qb();if(null!==a)if(b=L(),null!==b)if(c=Y(),null!==c)if(d=K(),null!==d){for(e=[],j=jd,f=N(),null!==f?(g=wb(),null!==g?f=[f,g]:(f=null,jd=j)):(f=null,jd=j);null!==f;)e.push(f),j=jd,f=N(),null!==f?(g=wb(),null!==g?f=[f,g]:(f=null,jd=j)):(f=null,jd=j);null!==e?a=[a,b,c,d,e]:(a=null,jd=i)}else a=null,jd=i;else a=null,jd=i;else a=null,jd=i;else a=null,jd=i;return null!==a&&(a=function(a){try{pd=new od(pd.uri,pd.display_name,pd.params)}catch(b){pd=-1}}(h)),null===a&&(jd=h),a}function Zb(){var a;return a=$b()}function $b(){var a,b,d,f,g,h,i,j;if(i=jd,"digest"===c.substr(jd,6).toLowerCase()?(a=c.substr(jd,6),jd+=6):(a=null,0===kd&&e('"Digest"')),null!==a)if(b=t(),null!==b)if(d=bc(),null!==d){for(f=[],j=jd,g=M(),null!==g?(h=bc(),null!==h?g=[g,h]:(g=null,jd=j)):(g=null,jd=j);null!==g;)f.push(g),j=jd,g=M(),null!==g?(h=bc(),null!==h?g=[g,h]:(g=null,jd=j)):(g=null,jd=j);null!==f?a=[a,b,d,f]:(a=null,jd=i)}else a=null,jd=i;else a=null,jd=i;else a=null,jd=i;return null===a&&(a=_b()),a}function _b(){var a,b,c,d,e,f,g,h;if(g=jd,a=B(),null!==a)if(b=t(),null!==b)if(c=ac(),null!==c){for(d=[],h=jd,e=M(),null!==e?(f=ac(),null!==f?e=[e,f]:(e=null,jd=h)):(e=null,jd=h);null!==e;)d.push(e),h=jd,e=M(),null!==e?(f=ac(),null!==f?e=[e,f]:(e=null,jd=h)):(e=null,jd=h);null!==d?a=[a,b,c,d]:(a=null,jd=g)}else a=null,jd=g;else a=null,jd=g;else a=null,jd=g;return a}function ac(){var a,b,c,d;return d=jd,a=B(),null!==a?(b=H(),null!==b?(c=B(),null===c&&(c=T()),null!==c?a=[a,b,c]:(a=null,jd=d)):(a=null,jd=d)):(a=null,jd=d),a}function bc(){var a;return a=cc(),null===a&&(a=ec(),null===a&&(a=gc(),null===a&&(a=ic(),null===a&&(a=jc(),null===a&&(a=kc(),null===a&&(a=lc(),null===a&&(a=ac()))))))),a}function cc(){var a,b,d,f;return f=jd,"realm"===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"realm"')),null!==a?(b=H(),null!==b?(d=dc(),null!==d?a=[a,b,d]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),a}function dc(){var a,b;return b=jd,a=U(),null!==a&&(a=function(a,b){pd.realm=b}(b,a)),null===a&&(jd=b),a}function ec(){var a,b,d,f,g,h,i,j,k;if(j=jd,"domain"===c.substr(jd,6).toLowerCase()?(a=c.substr(jd,6),jd+=6):(a=null,0===kd&&e('"domain"')),null!==a)if(b=H(),null!==b)if(d=P(),null!==d)if(f=fc(),null!==f){if(g=[],k=jd,i=m(),null!==i)for(h=[];null!==i;)h.push(i),i=m();else h=null;for(null!==h?(i=fc(),null!==i?h=[h,i]:(h=null,jd=k)):(h=null,jd=k);null!==h;){if(g.push(h),k=jd,i=m(),null!==i)for(h=[];null!==i;)h.push(i),i=m();else h=null;null!==h?(i=fc(),null!==i?h=[h,i]:(h=null,jd=k)):(h=null,jd=k)}null!==g?(h=Q(),null!==h?a=[a,b,d,f,g,h]:(a=null,jd=j)):(a=null,jd=j)}else a=null,jd=j;else a=null,jd=j;else a=null,jd=j;else a=null,jd=j;return a}function fc(){var a;return a=Ja(),null===a&&(a=Ma()),a}function gc(){var a,b,d,f;return f=jd,"nonce"===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"nonce"')),null!==a?(b=H(),null!==b?(d=hc(),null!==d?a=[a,b,d]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),a}function hc(){var a,b;return b=jd,a=U(),null!==a&&(a=function(a,b){pd.nonce=b}(b,a)),null===a&&(jd=b),a}function ic(){var a,b,d,f,g;return f=jd,g=jd,"opaque"===c.substr(jd,6).toLowerCase()?(a=c.substr(jd,6),jd+=6):(a=null,0===kd&&e('"opaque"')),null!==a?(b=H(),null!==b?(d=U(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){pd.opaque=b}(f,a[2])),null===a&&(jd=f),a}function jc(){var a,b,d,f,g;return f=jd,"stale"===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"stale"')),null!==a?(b=H(),null!==b?(g=jd,"true"===c.substr(jd,4).toLowerCase()?(d=c.substr(jd,4),jd+=4):(d=null,0===kd&&e('"true"')),null!==d&&(d=function(a){pd.stale=!0}(g)),null===d&&(jd=g),null===d&&(g=jd,"false"===c.substr(jd,5).toLowerCase()?(d=c.substr(jd,5),jd+=5):(d=null,0===kd&&e('"false"')),null!==d&&(d=function(a){pd.stale=!1}(g)),null===d&&(jd=g)),null!==d?a=[a,b,d]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),a}function kc(){var a,b,d,f,g;return f=jd,g=jd,"algorithm"===c.substr(jd,9).toLowerCase()?(a=c.substr(jd,9),jd+=9):(a=null,0===kd&&e('"algorithm"')),null!==a?(b=H(),null!==b?("md5"===c.substr(jd,3).toLowerCase()?(d=c.substr(jd,3),jd+=3):(d=null,0===kd&&e('"MD5"')),null===d&&("md5-sess"===c.substr(jd,8).toLowerCase()?(d=c.substr(jd,8),jd+=8):(d=null,0===kd&&e('"MD5-sess"')),null===d&&(d=B())),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){pd.algorithm=b.toUpperCase()}(f,a[2])),null===a&&(jd=f),a}function lc(){var a,b,d,f,g,h,i,j,k,l;if(j=jd,"qop"===c.substr(jd,3).toLowerCase()?(a=c.substr(jd,3),jd+=3):(a=null,0===kd&&e('"qop"')),null!==a)if(b=H(),null!==b)if(d=P(),null!==d){if(k=jd,f=mc(),null!==f){for(g=[],l=jd,44===c.charCodeAt(jd)?(h=",",jd++):(h=null,0===kd&&e('","')),null!==h?(i=mc(),null!==i?h=[h,i]:(h=null,jd=l)):(h=null,jd=l);null!==h;)g.push(h),l=jd,44===c.charCodeAt(jd)?(h=",",jd++):(h=null,0===kd&&e('","')),null!==h?(i=mc(),null!==i?h=[h,i]:(h=null,jd=l)):(h=null,jd=l);null!==g?f=[f,g]:(f=null,jd=k)}else f=null,jd=k;null!==f?(g=Q(),null!==g?a=[a,b,d,f,g]:(a=null,jd=j)):(a=null,jd=j)}else a=null,jd=j;else a=null,jd=j;else a=null,jd=j;return a}function mc(){var a,b;return b=jd,"auth-int"===c.substr(jd,8).toLowerCase()?(a=c.substr(jd,8),jd+=8):(a=null,0===kd&&e('"auth-int"')),null===a&&("auth"===c.substr(jd,4).toLowerCase()?(a=c.substr(jd,4),jd+=4):(a=null,0===kd&&e('"auth"')),null===a&&(a=B())),null!==a&&(a=function(a,b){pd.qop||(pd.qop=[]),pd.qop.push(b.toLowerCase())}(b,a)),null===a&&(jd=b),a}function nc(){var a,b,c,d,e,f;if(e=jd,a=B(),null!==a){for(b=[],f=jd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==c;)b.push(c),f=jd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==b?a=[a,b]:(a=null,jd=e)}else a=null,jd=e;return a}function oc(){var a,b,c,d,e,f,g;if(e=jd,f=jd,a=pc(),null!==a){for(b=[],g=jd,c=M(),null!==c?(d=pc(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==c;)b.push(c),g=jd,c=M(),null!==c?(d=pc(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==b?a=[a,b]:(a=null,jd=f)}else a=null,jd=f;return null!==a&&(a=function(a){var b,c;for(c=pd.multi_header.length,b=0;c>b;b++)if(null===pd.multi_header[b].parsed){pd=null;break}pd=null!==pd?pd.multi_header:-1}(e)),null===a&&(jd=e),a}function pc(){var a,b,c,d,e,f,g;if(e=jd,f=jd,a=pb(),null!==a){for(b=[],g=jd,c=N(),null!==c?(d=wb(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==c;)b.push(c),g=jd,c=N(),null!==c?(d=wb(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==b?a=[a,b]:(a=null,jd=f)}else a=null,jd=f;return null!==a&&(a=function(a){var b;pd.multi_header||(pd.multi_header=[]);try{b=new od(pd.uri,pd.display_name,pd.params),delete pd.uri,delete pd.display_name,delete pd.params}catch(c){b=null}pd.multi_header.push({possition:jd,offset:a,parsed:b})}(e)),null===a&&(jd=e),a}function qc(){var a,b,c,d,e,f;if(e=jd,a=B(),null!==a){for(b=[],f=jd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==c;)b.push(c),f=jd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==b?a=[a,b]:(a=null,jd=e)}else a=null,jd=e;return a}function rc(){var a,b,c,d,e,f;if(e=jd,a=sc(),null!==a){for(b=[],f=jd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==c;)b.push(c),f=jd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==b?a=[a,b]:(a=null,jd=e)}else a=null,jd=e;return a}function sc(){var a,b,c,d,e,f;if(e=jd,a=pb(),null!==a){for(b=[],f=jd,c=N(),null!==c?(d=wb(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==c;)b.push(c),f=jd,c=N(),null!==c?(d=wb(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==b?a=[a,b]:(a=null,jd=e)}else a=null,jd=e;return a}function tc(){var a,b,c,d,e,f;if(e=jd,a=uc(),null!==a){for(b=[],f=jd,c=N(),null!==c?(d=vc(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==c;)b.push(c),f=jd,c=N(),null!==c?(d=vc(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==b?a=[a,b]:(a=null,jd=e)}else a=null,jd=e;return a}function uc(){var a,b;return b=jd,"active"===c.substr(jd,6).toLowerCase()?(a=c.substr(jd,6),jd+=6):(a=null,0===kd&&e('"active"')),null===a&&("pending"===c.substr(jd,7).toLowerCase()?(a=c.substr(jd,7),jd+=7):(a=null,0===kd&&e('"pending"')),null===a&&("terminated"===c.substr(jd,10).toLowerCase()?(a=c.substr(jd,10),jd+=10):(a=null,0===kd&&e('"terminated"')),null===a&&(a=B()))),null!==a&&(a=function(a){pd.state=c.substring(jd,a)}(b)),null===a&&(jd=b),a}function vc(){var a,b,d,f,g;return f=jd,g=jd,"reason"===c.substr(jd,6).toLowerCase()?(a=c.substr(jd,6),jd+=6):(a=null,0===kd&&e('"reason"')),null!==a?(b=H(),null!==b?(d=wc(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(pd.reason=b)}(f,a[2])),null===a&&(jd=f),null===a&&(f=jd,g=jd,"expires"===c.substr(jd,7).toLowerCase()?(a=c.substr(jd,7),jd+=7):(a=null,0===kd&&e('"expires"')),null!==a?(b=H(),null!==b?(d=ub(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(pd.expires=b)}(f,a[2])),null===a&&(jd=f),null===a&&(f=jd,g=jd,"retry_after"===c.substr(jd,11).toLowerCase()?(a=c.substr(jd,11),jd+=11):(a=null,0===kd&&e('"retry_after"')),null!==a?(b=H(),null!==b?(d=ub(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(pd.retry_after=b)}(f,a[2])),null===a&&(jd=f),null===a&&(a=wb()))),a}function wc(){var a;return"deactivated"===c.substr(jd,11).toLowerCase()?(a=c.substr(jd,11),jd+=11):(a=null,0===kd&&e('"deactivated"')),null===a&&("probation"===c.substr(jd,9).toLowerCase()?(a=c.substr(jd,9),jd+=9):(a=null,0===kd&&e('"probation"')),null===a&&("rejected"===c.substr(jd,8).toLowerCase()?(a=c.substr(jd,8),jd+=8):(a=null,0===kd&&e('"rejected"')),null===a&&("timeout"===c.substr(jd,7).toLowerCase()?(a=c.substr(jd,7),jd+=7):(a=null,0===kd&&e('"timeout"')),null===a&&("giveup"===c.substr(jd,6).toLowerCase()?(a=c.substr(jd,6),jd+=6):(a=null,0===kd&&e('"giveup"')),null===a&&("noresource"===c.substr(jd,10).toLowerCase()?(a=c.substr(jd,10),jd+=10):(a=null,0===kd&&e('"noresource"')),null===a&&("invariant"===c.substr(jd,9).toLowerCase()?(a=c.substr(jd,9),jd+=9):(a=null,0===kd&&e('"invariant"')),null===a&&(a=B()))))))),a}function xc(){var a;return a=w(),a=null!==a?a:""}function yc(){var a,b,c,d,e,f;if(e=jd,a=B(),null!==a){for(b=[],f=jd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==c;)b.push(c),f=jd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==b?a=[a,b]:(a=null,jd=e)}else a=null,jd=e;return a=null!==a?a:""}function zc(){var a,b,c,d,e,f,g;if(e=jd,f=jd,a=X(),null===a&&(a=pb()),null!==a){for(b=[],g=jd,c=N(),null!==c?(d=Ac(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==c;)b.push(c),g=jd,c=N(),null!==c?(d=Ac(),null!==d?c=[c,d]:(c=null,jd=g)):(c=null,jd=g);null!==b?a=[a,b]:(a=null,jd=f)}else a=null,jd=f;return null!==a&&(a=function(a){var b=pd.tag;try{pd=new od(pd.uri,pd.display_name,pd.params),b&&pd.setParam("tag",b)}catch(c){pd=-1}}(e)),null===a&&(jd=e),a}function Ac(){var a;return a=Vb(),null===a&&(a=wb()),a}function Bc(){var a,b,c,d,e,f;if(e=jd,a=Cc(),null!==a){for(b=[],f=jd,c=M(),null!==c?(d=Cc(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==c;)b.push(c),f=jd,c=M(),null!==c?(d=Cc(),null!==d?c=[c,d]:(c=null,jd=f)):(c=null,jd=f);null!==b?a=[a,b]:(a=null,jd=e)}else a=null,jd=e;return a}function Cc(){var a,b,c,d,e,f,g,h;if(g=jd,a=Jc(),null!==a)if(b=t(),null!==b)if(c=Mc(),null!==c){for(d=[],h=jd,e=N(),null!==e?(f=Dc(),null!==f?e=[e,f]:(e=null,jd=h)):(e=null,jd=h);null!==e;)d.push(e),h=jd,e=N(),null!==e?(f=Dc(),
null!==f?e=[e,f]:(e=null,jd=h)):(e=null,jd=h);null!==d?a=[a,b,c,d]:(a=null,jd=g)}else a=null,jd=g;else a=null,jd=g;else a=null,jd=g;return a}function Dc(){var a;return a=Ec(),null===a&&(a=Fc(),null===a&&(a=Gc(),null===a&&(a=Hc(),null===a&&(a=Ic(),null===a&&(a=wb()))))),a}function Ec(){var a,b,d,f,g;return f=jd,g=jd,"ttl"===c.substr(jd,3).toLowerCase()?(a=c.substr(jd,3),jd+=3):(a=null,0===kd&&e('"ttl"')),null!==a?(b=H(),null!==b?(d=Pc(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){pd.ttl=b}(f,a[2])),null===a&&(jd=f),a}function Fc(){var a,b,d,f,g;return f=jd,g=jd,"maddr"===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"maddr"')),null!==a?(b=H(),null!==b?(d=da(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){pd.maddr=b}(f,a[2])),null===a&&(jd=f),a}function Gc(){var a,b,d,f,g;return f=jd,g=jd,"received"===c.substr(jd,8).toLowerCase()?(a=c.substr(jd,8),jd+=8):(a=null,0===kd&&e('"received"')),null!==a?(b=H(),null!==b?(d=la(),null===d&&(d=ia()),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){pd.received=b}(f,a[2])),null===a&&(jd=f),a}function Hc(){var a,b,d,f,g;return f=jd,g=jd,"branch"===c.substr(jd,6).toLowerCase()?(a=c.substr(jd,6),jd+=6):(a=null,0===kd&&e('"branch"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,jd=g)):(a=null,jd=g)):(a=null,jd=g),null!==a&&(a=function(a,b){pd.branch=b}(f,a[2])),null===a&&(jd=f),a}function Ic(){var a,b,d,f,h,i,j;if(h=jd,i=jd,"rport"===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"rport"')),null!==a){if(j=jd,b=H(),null!==b){for(d=[],f=g();null!==f;)d.push(f),f=g();null!==d?b=[b,d]:(b=null,jd=j)}else b=null,jd=j;b=null!==b?b:"",null!==b?a=[a,b]:(a=null,jd=i)}else a=null,jd=i;return null!==a&&(a=function(a){"undefined"!=typeof response_port&&(pd.rport=response_port.join(""))}(h)),null===a&&(jd=h),a}function Jc(){var a,b,c,d,e,f;return f=jd,a=Kc(),null!==a?(b=G(),null!==b?(c=B(),null!==c?(d=G(),null!==d?(e=Lc(),null!==e?a=[a,b,c,d,e]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),a}function Kc(){var a,b;return b=jd,"sip"===c.substr(jd,3).toLowerCase()?(a=c.substr(jd,3),jd+=3):(a=null,0===kd&&e('"SIP"')),null===a&&(a=B()),null!==a&&(a=function(a,b){pd.protocol=b}(b,a)),null===a&&(jd=b),a}function Lc(){var a,b;return b=jd,"udp"===c.substr(jd,3).toLowerCase()?(a=c.substr(jd,3),jd+=3):(a=null,0===kd&&e('"UDP"')),null===a&&("tcp"===c.substr(jd,3).toLowerCase()?(a=c.substr(jd,3),jd+=3):(a=null,0===kd&&e('"TCP"')),null===a&&("tls"===c.substr(jd,3).toLowerCase()?(a=c.substr(jd,3),jd+=3):(a=null,0===kd&&e('"TLS"')),null===a&&("sctp"===c.substr(jd,4).toLowerCase()?(a=c.substr(jd,4),jd+=4):(a=null,0===kd&&e('"SCTP"')),null===a&&(a=B())))),null!==a&&(a=function(a,b){pd.transport=b}(b,a)),null===a&&(jd=b),a}function Mc(){var a,b,c,d,e;return d=jd,a=Nc(),null!==a?(e=jd,b=O(),null!==b?(c=Oc(),null!==c?b=[b,c]:(b=null,jd=e)):(b=null,jd=e),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,jd=d)):(a=null,jd=d),a}function Nc(){var a,b;return b=jd,a=la(),null===a&&(a=ha(),null===a&&(a=ea())),null!==a&&(a=function(a){pd.host=c.substring(jd,a)}(b)),null===a&&(jd=b),a}function Oc(){var a,b,c,d,e,f,h;return f=jd,h=jd,a=g(),a=null!==a?a:"",null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?(d=g(),d=null!==d?d:"",null!==d?(e=g(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,jd=h)):(a=null,jd=h)):(a=null,jd=h)):(a=null,jd=h)):(a=null,jd=h),null!==a&&(a=function(a,b){pd.port=parseInt(b.join(""))}(f,a)),null===a&&(jd=f),a}function Pc(){var a,b,c,d,e;return d=jd,e=jd,a=g(),null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?a=[a,b,c]:(a=null,jd=e)):(a=null,jd=e)):(a=null,jd=e),null!==a&&(a=function(a,b){return parseInt(b.join(""))}(d,a)),null===a&&(jd=d),a}function Qc(){var a;return a=$b()}function Rc(){var a,b,c,d;return d=jd,a=B(),null!==a?(b=v(),null!==b?(c=Sc(),null!==c?a=[a,b,c]:(a=null,jd=d)):(a=null,jd=d)):(a=null,jd=d),a}function Sc(){var a,b;for(a=[],b=x(),null===b&&(b=z(),null===b&&(b=t()));null!==b;)a.push(b),b=x(),null===b&&(b=z(),null===b&&(b=t()));return a}function Tc(){var a,b;for(a=[],b=k();null!==b;)a.push(b),b=k();return a}function Uc(){var a,b,d,f;return f=jd,a=Vc(),null!==a?(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=Wc(),null!==d?a=[a,b,d]:(a=null,jd=f)):(a=null,jd=f)):(a=null,jd=f),a}function Vc(){var a,b;return b=jd,"stuns"===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"stuns"')),null===a&&("stun"===c.substr(jd,4).toLowerCase()?(a=c.substr(jd,4),jd+=4):(a=null,0===kd&&e('"stun"'))),null!==a&&(a=function(a,b){pd.scheme=b}(b,a)),null===a&&(jd=b),a}function Wc(){var a,b,d,f,g;return f=jd,a=Xc(),null!==a?(g=jd,58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=na(),null!==d?b=[b,d]:(b=null,jd=g)):(b=null,jd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,jd=f)):(a=null,jd=f),a}function Xc(){var a,b;return b=jd,a=la(),null===a&&(a=ha(),null===a&&(a=Xa())),null!==a&&(a=function(a,b){pd.host=b}(b,a)),null===a&&(jd=b),a}function Xa(){var a,b,d;for(d=jd,a=[],b=Yc(),null===b&&(b=s(),null===b&&(b=Zc()));null!==b;)a.push(b),b=Yc(),null===b&&(b=s(),null===b&&(b=Zc()));return null!==a&&(a=function(a){return c.substring(jd,a)}(d)),null===a&&(jd=d),a}function Yc(){var a;return a=h(),null===a&&(a=g(),null===a&&(45===c.charCodeAt(jd)?(a="-",jd++):(a=null,0===kd&&e('"-"')),null===a&&(46===c.charCodeAt(jd)?(a=".",jd++):(a=null,0===kd&&e('"."')),null===a&&(95===c.charCodeAt(jd)?(a="_",jd++):(a=null,0===kd&&e('"_"')),null===a&&(126===c.charCodeAt(jd)?(a="~",jd++):(a=null,0===kd&&e('"~"'))))))),a}function Zc(){var a;return 33===c.charCodeAt(jd)?(a="!",jd++):(a=null,0===kd&&e('"!"')),null===a&&(36===c.charCodeAt(jd)?(a="$",jd++):(a=null,0===kd&&e('"$"')),null===a&&(38===c.charCodeAt(jd)?(a="&",jd++):(a=null,0===kd&&e('"&"')),null===a&&(39===c.charCodeAt(jd)?(a="'",jd++):(a=null,0===kd&&e('"\'"')),null===a&&(40===c.charCodeAt(jd)?(a="(",jd++):(a=null,0===kd&&e('"("')),null===a&&(41===c.charCodeAt(jd)?(a=")",jd++):(a=null,0===kd&&e('")"')),null===a&&(42===c.charCodeAt(jd)?(a="*",jd++):(a=null,0===kd&&e('"*"')),null===a&&(43===c.charCodeAt(jd)?(a="+",jd++):(a=null,0===kd&&e('"+"')),null===a&&(44===c.charCodeAt(jd)?(a=",",jd++):(a=null,0===kd&&e('","')),null===a&&(59===c.charCodeAt(jd)?(a=";",jd++):(a=null,0===kd&&e('";"')),null===a&&(61===c.charCodeAt(jd)?(a="=",jd++):(a=null,0===kd&&e('"="')))))))))))),a}function $c(){var a,b,d,f,g,h,i;return h=jd,a=_c(),null!==a?(58===c.charCodeAt(jd)?(b=":",jd++):(b=null,0===kd&&e('":"')),null!==b?(d=Wc(),null!==d?(i=jd,"?transport="===c.substr(jd,11)?(f="?transport=",jd+=11):(f=null,0===kd&&e('"?transport="')),null!==f?(g=Lc(),null!==g?f=[f,g]:(f=null,jd=i)):(f=null,jd=i),f=null!==f?f:"",null!==f?a=[a,b,d,f]:(a=null,jd=h)):(a=null,jd=h)):(a=null,jd=h)):(a=null,jd=h),a}function _c(){var a,b;return b=jd,"turns"===c.substr(jd,5).toLowerCase()?(a=c.substr(jd,5),jd+=5):(a=null,0===kd&&e('"turns"')),null===a&&("turn"===c.substr(jd,4).toLowerCase()?(a=c.substr(jd,4),jd+=4):(a=null,0===kd&&e('"turn"'))),null!==a&&(a=function(a,b){pd.scheme=b}(b,a)),null===a&&(jd=b),a}function ad(){var a,b,d,f,g;if(f=jd,g=jd,a=Lc(),null!==a){if("udp"===c.substr(jd,3).toLowerCase()?(b=c.substr(jd,3),jd+=3):(b=null,0===kd&&e('"udp"')),null===b&&("tcp"===c.substr(jd,3).toLowerCase()?(b=c.substr(jd,3),jd+=3):(b=null,0===kd&&e('"tcp"')),null===b))for(b=[],d=q();null!==d;)b.push(d),d=q();null!==b?a=[a,b]:(a=null,jd=g)}else a=null,jd=g;return null!==a&&(a=function(a){pd.transport=transport}(f)),null===a&&(jd=f),a}function bd(){var a,b,d;return d=jd,"uuid:"===c.substr(jd,5)?(a="uuid:",jd+=5):(a=null,0===kd&&e('"uuid:"')),null!==a?(b=cd(),null!==b?a=[a,b]:(a=null,jd=d)):(a=null,jd=d),a}function cd(){var a,b,d,f,g,h,i,j,k,l,m;return l=jd,m=jd,a=ed(),null!==a?(45===c.charCodeAt(jd)?(b="-",jd++):(b=null,0===kd&&e('"-"')),null!==b?(d=dd(),null!==d?(45===c.charCodeAt(jd)?(f="-",jd++):(f=null,0===kd&&e('"-"')),null!==f?(g=dd(),null!==g?(45===c.charCodeAt(jd)?(h="-",jd++):(h=null,0===kd&&e('"-"')),null!==h?(i=dd(),null!==i?(45===c.charCodeAt(jd)?(j="-",jd++):(j=null,0===kd&&e('"-"')),null!==j?(k=fd(),null!==k?a=[a,b,d,f,g,h,i,j,k]:(a=null,jd=m)):(a=null,jd=m)):(a=null,jd=m)):(a=null,jd=m)):(a=null,jd=m)):(a=null,jd=m)):(a=null,jd=m)):(a=null,jd=m)):(a=null,jd=m),null!==a&&(a=function(a,b){pd=c.substring(jd+5,a)}(l,a[0])),null===a&&(jd=l),a}function dd(){var a,b,c,d,e;return e=jd,a=i(),null!==a?(b=i(),null!==b?(c=i(),null!==c?(d=i(),null!==d?a=[a,b,c,d]:(a=null,jd=e)):(a=null,jd=e)):(a=null,jd=e)):(a=null,jd=e),a}function ed(){var a,b,c;return c=jd,a=dd(),null!==a?(b=dd(),null!==b?a=[a,b]:(a=null,jd=c)):(a=null,jd=c),a}function fd(){var a,b,c,d;return d=jd,a=dd(),null!==a?(b=dd(),null!==b?(c=dd(),null!==c?a=[a,b,c]:(a=null,jd=d)):(a=null,jd=d)):(a=null,jd=d),a}function gd(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}function hd(){for(var a=1,b=1,d=!1,e=0;e<Math.max(jd,ld);e++){var f=c.charAt(e);"\n"===f?(d||a++,b=1,d=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a++,b=1,d=!0):(b++,d=!1)}return{line:a,column:b}}var id={CRLF:f,DIGIT:g,ALPHA:h,HEXDIG:i,WSP:j,OCTET:k,DQUOTE:l,SP:m,HTAB:n,alphanum:o,reserved:p,unreserved:q,mark:r,escaped:s,LWS:t,SWS:u,HCOLON:v,TEXT_UTF8_TRIM:w,TEXT_UTF8char:x,UTF8_NONASCII:y,UTF8_CONT:z,LHEX:A,token:B,token_nodot:C,separators:D,word:E,STAR:F,SLASH:G,EQUAL:H,LPAREN:I,RPAREN:J,RAQUOT:K,LAQUOT:L,COMMA:M,SEMI:N,COLON:O,LDQUOT:P,RDQUOT:Q,comment:R,ctext:S,quoted_string:T,quoted_string_clean:U,qdtext:V,quoted_pair:W,SIP_URI_noparams:X,SIP_URI:Y,uri_scheme:Z,userinfo:$,user:_,user_unreserved:aa,password:ba,hostport:ca,host:da,hostname:ea,domainlabel:fa,toplabel:ga,IPv6reference:ha,IPv6address:ia,h16:ja,ls32:ka,IPv4address:la,dec_octet:ma,port:na,uri_parameters:oa,uri_parameter:pa,transport_param:qa,user_param:ra,method_param:sa,ttl_param:ta,maddr_param:ua,lr_param:va,other_param:wa,pname:xa,pvalue:ya,paramchar:za,param_unreserved:Aa,headers:Ba,header:Ca,hname:Da,hvalue:Ea,hnv_unreserved:Fa,Request_Response:Ga,Request_Line:Ha,Request_URI:Ia,absoluteURI:Ja,hier_part:Ka,net_path:La,abs_path:Ma,opaque_part:Na,uric:Oa,uric_no_slash:Pa,path_segments:Qa,segment:Ra,param:Sa,pchar:Ta,scheme:Ua,authority:Va,srvr:Wa,reg_name:Xa,query:Ya,SIP_Version:Za,INVITEm:$a,ACKm:_a,OPTIONSm:ab,BYEm:bb,CANCELm:cb,REGISTERm:db,SUBSCRIBEm:eb,NOTIFYm:fb,Method:gb,Status_Line:hb,Status_Code:ib,extension_code:jb,Reason_Phrase:kb,Allow_Events:lb,Call_ID:mb,Contact:nb,contact_param:ob,name_addr:pb,display_name:qb,contact_params:rb,c_p_q:sb,c_p_expires:tb,delta_seconds:ub,qvalue:vb,generic_param:wb,gen_value:xb,Content_Disposition:yb,disp_type:zb,disp_param:Ab,handling_param:Bb,Content_Encoding:Cb,Content_Length:Db,Content_Type:Eb,media_type:Fb,m_type:Gb,discrete_type:Hb,composite_type:Ib,extension_token:Jb,x_token:Kb,m_subtype:Lb,m_parameter:Mb,m_value:Nb,CSeq:Ob,CSeq_value:Pb,Expires:Qb,Event:Rb,event_type:Sb,From:Tb,from_param:Ub,tag_param:Vb,Max_Forwards:Wb,Min_Expires:Xb,Name_Addr_Header:Yb,Proxy_Authenticate:Zb,challenge:$b,other_challenge:_b,auth_param:ac,digest_cln:bc,realm:cc,realm_value:dc,domain:ec,URI:fc,nonce:gc,nonce_value:hc,opaque:ic,stale:jc,algorithm:kc,qop_options:lc,qop_value:mc,Proxy_Require:nc,Record_Route:oc,rec_route:pc,Require:qc,Route:rc,route_param:sc,Subscription_State:tc,substate_value:uc,subexp_params:vc,event_reason_value:wc,Subject:xc,Supported:yc,To:zc,to_param:Ac,Via:Bc,via_parm:Cc,via_params:Dc,via_ttl:Ec,via_maddr:Fc,via_received:Gc,via_branch:Hc,response_port:Ic,sent_protocol:Jc,protocol_name:Kc,transport:Lc,sent_by:Mc,via_host:Nc,via_port:Oc,ttl:Pc,WWW_Authenticate:Qc,extension_header:Rc,header_value:Sc,message_body:Tc,stun_URI:Uc,stun_scheme:Vc,stun_host_port:Wc,stun_host:Xc,reg_name:Xa,stun_unreserved:Yc,sub_delims:Zc,turn_URI:$c,turn_scheme:_c,turn_transport:ad,uuid_URI:bd,uuid:cd,hex4:dd,hex8:ed,hex12:fd};if(void 0!==d){if(void 0===id[d])throw new Error("Invalid rule name: "+b(d)+".")}else d="CRLF";var jd=0,kd=0,ld=0,md=[],nd=a("./URI"),od=a("./NameAddrHeader"),pd={},qd=id[d]();if(null===qd||jd!==c.length){var rd=Math.max(jd,ld),sd=rd<c.length?c.charAt(rd):null,td=hd();return new this.SyntaxError(gd(md),sd,rd,td.line,td.column),-1}return pd},toSource:function(){return this._source}};return c.SyntaxError=function(a,c,d,e,f){function g(a,c){var d,e;switch(a.length){case 0:d="end of input";break;case 1:d=a[0];break;default:d=a.slice(0,a.length-1).join(", ")+" or "+a[a.length-1]}return e=c?b(c):"end of input","Expected "+d+" but "+e+" found."}this.name="SyntaxError",this.expected=a,this.found=c,this.message=g(a,c),this.offset=d,this.line=e,this.column=f},c.SyntaxError.prototype=Error.prototype,c}()},{"./NameAddrHeader":19,"./URI":32}],17:[function(a,b,c){var d={C:a("./Constants"),Exceptions:a("./Exceptions"),Utils:a("./Utils"),UA:a("./UA"),URI:a("./URI"),NameAddrHeader:a("./NameAddrHeader"),Grammar:a("./Grammar"),debug:a("debug")};b.exports=d;var e=a("../package.json");Object.defineProperties(d,{name:{get:function(){return e.title}},version:{get:function(){return e.version}}})},{"../package.json":9,"./Constants":10,"./Exceptions":15,"./Grammar":16,"./NameAddrHeader":19,"./UA":31,"./URI":32,"./Utils":33,debug:1}],18:[function(a,b,c){function d(a){this.ua=a,this.data={}}b.exports=d;var e=a("./Constants"),f=a("./EventEmitter"),g=a("./SIPMessage"),h=a("./Utils"),i=a("./RequestSender"),j=a("./Transactions"),k=a("./Exceptions");d.prototype=new f,d.prototype.send=function(a,b,c){var d,f,h,j,k,l=["succeeded","failed"],m=a;if(void 0===a||void 0===b)throw new TypeError("Not enough arguments");if(a=this.ua.normalizeTarget(a),!a)throw new TypeError("Invalid target: "+m);this.initEvents(l),c=c||{},k=c.extraHeaders&&c.extraHeaders.slice()||[],j=c.eventHandlers||{},h=c.contentType||"text/plain",this.content_type=h;for(f in j)this.on(f,j[f]);this.closed=!1,this.ua.applicants[this]=this,k.push("Content-Type: "+h),this.request=new g.OutgoingRequest(e.MESSAGE,a,this.ua,null,k),b?(this.request.body=b,this.content=b):this.content=null,d=new i(this,this.ua),this.newMessage("local",this.request),d.send()},d.prototype.receiveResponse=function(a){var b;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):delete this.ua.applicants[this],this.emit("succeeded",this,{originator:"remote",response:a});break;default:delete this.ua.applicants[this],b=h.sipErrorCause(a.status_code),this.emit("failed",this,{originator:"remote",response:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",this,{originator:"system",cause:e.causes.REQUEST_TIMEOUT})},d.prototype.onTransportError=function(){this.closed||this.emit("failed",this,{originator:"system",cause:e.causes.CONNECTION_ERROR})},d.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},d.prototype.init_incoming=function(a){var b;this.request=a,this.content_type=a.getHeader("Content-Type"),a.body?this.content=a.body:this.content=null,this.newMessage("remote",a),b=this.ua.transactions.nist[a.via_branch],!b||b.state!==j.C.STATUS_TRYING&&b.state!==j.C.STATUS_PROCEEDING||a.reply(200)},d.prototype.accept=function(a){a=a||{};var b=a.extraHeaders&&a.extraHeaders.slice()||[],c=a.body;if("incoming"!==this.direction)throw new k.NotSupportedError('"accept" not supported for outgoing Message');this.request.reply(200,null,b,c)},d.prototype.reject=function(a){a=a||{};var b=a.status_code||480,c=a.reason_phrase,d=a.extraHeaders&&a.extraHeaders.slice()||[],e=a.body;if("incoming"!==this.direction)throw new k.NotSupportedError('"reject" not supported for outgoing Message');if(300>b||b>=700)throw new TypeError("Invalid status_code: "+b);this.request.reply(b,c,d,e)},d.prototype.newMessage=function(a,b){var c=this,d="newMessage";"remote"===a?(c.direction="incoming",c.local_identity=b.to,c.remote_identity=b.from):"local"===a&&(c.direction="outgoing",c.local_identity=b.from,c.remote_identity=b.to),c.ua.emit(d,c.ua,{originator:a,message:c,request:b})}},{"./Constants":10,"./EventEmitter":14,"./Exceptions":15,"./RequestSender":26,"./SIPMessage":27,"./Transactions":29,"./Utils":33}],19:[function(a,b,c){function d(a,b,c){var d;if(!(a&&a instanceof e))throw new TypeError('missing or invalid "uri" parameter');this.uri=a,this.parameters={};for(d in c)this.setParam(d,c[d]);Object.defineProperties(this,{display_name:{get:function(){return b},set:function(a){b=0===a?"0":a}}})}b.exports=d;var e=a("./URI"),f=a("./Grammar");d.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]="undefined"==typeof b||null===b?null:b.toString())},getParam:function(a){return a?this.parameters[a.toLowerCase()]:void 0},hasParam:function(a){return a?this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1:void 0},deleteParam:function(a){var b;return a=a.toLowerCase(),this.parameters.hasOwnProperty(a)?(b=this.parameters[a],delete this.parameters[a],b):void 0},clearParams:function(){this.parameters={}},clone:function(){return new d(this.uri.clone(),this.display_name,JSON.parse(JSON.stringify(this.parameters)))},toString:function(){var a,b;a=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",a+="<"+this.uri.toString()+">";for(b in this.parameters)a+=";"+b,null!==this.parameters[b]&&(a+="="+this.parameters[b]);return a}},d.parse=function(a){return a=f.parse(a,"Name_Addr_Header"),-1!==a?a:void 0}},{"./Grammar":16,"./URI":32}],20:[function(a,b,c){function d(a,b){var c=b,d=0,e=0;if(a.substring(c,c+2).match(/(^\r\n)/))return-2;for(;0===d;){if(e=a.indexOf("\r\n",c),-1===e)return e;!a.substring(e+2,e+4).match(/(^\r\n)/)&&a.charAt(e+2).match(/(^\s+)/)?c=e+2:d=e}return d}function e(a,b,c,d){var e,f,g,h,k=b.indexOf(":",c),l=b.substring(c,k).trim(),m=b.substring(k+1,d).trim();switch(l.toLowerCase()){case"via":case"v":a.addHeader("via",m),1===a.getHeaders("via").length?(h=a.parseHeader("Via"),h&&(a.via=h,a.via_branch=h.branch)):h=0;break;case"from":case"f":a.setHeader("from",m),h=a.parseHeader("from"),h&&(a.from=h,a.from_tag=h.getParam("tag"));break;case"to":case"t":a.setHeader("to",m),h=a.parseHeader("to"),h&&(a.to=h,a.to_tag=h.getParam("tag"));break;case"record-route":for(h=i.parse(m,"Record_Route"),-1===h&&(h=void 0),g=h.length,f=0;g>f;f++)e=h[f],a.addHeader("record-route",m.substring(e.possition,e.offset)),a.headers["Record-Route"][a.getHeaders("record-route").length-1].parsed=e.parsed;break;case"call-id":case"i":a.setHeader("call-id",m),h=a.parseHeader("call-id"),h&&(a.call_id=m);break;case"contact":case"m":for(h=i.parse(m,"Contact"),-1===h&&(h=void 0),g=h.length,f=0;g>f;f++)e=h[f],a.addHeader("contact",m.substring(e.possition,e.offset)),a.headers.Contact[a.getHeaders("contact").length-1].parsed=e.parsed;break;case"content-length":case"l":a.setHeader("content-length",m),h=a.parseHeader("content-length");break;case"content-type":case"c":a.setHeader("content-type",m),h=a.parseHeader("content-type");break;case"cseq":a.setHeader("cseq",m),h=a.parseHeader("cseq"),h&&(a.cseq=h.value),a instanceof j.IncomingResponse&&(a.method=h.method);break;case"max-forwards":a.setHeader("max-forwards",m),h=a.parseHeader("max-forwards");break;case"www-authenticate":a.setHeader("www-authenticate",m),h=a.parseHeader("www-authenticate");break;case"proxy-authenticate":a.setHeader("proxy-authenticate",m),h=a.parseHeader("proxy-authenticate");break;default:a.setHeader(l,m),h=0}return void 0===h?{error:'error parsing header "'+l+'"'}:!0}var f={};b.exports=f;var g=a("debug")("JsSIP:Parser"),h=a("sdp-transform"),i=a("./Grammar"),j=a("./SIPMessage");f.parseMessage=function(a,b){var c,f,h,k,l,m=0,n=a.indexOf("\r\n");if(-1===n)return void g("no CRLF found, not a SIP message");if(f=a.substring(0,n),l=i.parse(f,"Request_Response"),-1===l)return void g('error parsing first line of SIP message: "'+f+'"');for(l.status_code?(c=new j.IncomingResponse,c.status_code=l.status_code,c.reason_phrase=l.reason_phrase):(c=new j.IncomingRequest(b),c.method=l.method,c.ruri=l.uri),c.data=a,m=n+2;;){if(n=d(a,m),-2===n){k=m+2;break}if(-1===n)return void l.error("malformed message");if(l=e(c,a,m,n),l!==!0)return void g(l.error);m=n+2}return c.hasHeader("content-length")?(h=c.getHeader("content-length"),c.body=a.substr(k,h)):c.body=a.substring(k),c},f.parseSDP=h.parse,f.writeSDP=h.write,f.parseFmtpConfig=h.parseFmtpConfig,f.parsePayloads=h.parsePayloads,f.parseRemoteCandidates=h.parseRemoteCandidates},{"./Grammar":16,"./SIPMessage":27,debug:1,"sdp-transform":5}],21:[function(a,b,c){function d(a){var b=["connecting","progress","failed","accepted","confirmed","ended","newDTMF","hold","unhold","muted","unmuted"];this.ua=a,this.status=e.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.rtcMediaHandler=null,this.is_confirmed=!1,this.late_sdp=!1,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.tones=null,this.audioMuted=!1,this.videoMuted=!1,this.local_hold=!1,this.remote_hold=!1,this.pending_actions={actions:[],length:function(){return this.actions.length},isPending:function(a){var b=0,c=this.actions.length;for(b;c>b;b++)if(this.actions[b].name===a)return!0;return!1},shift:function(){return this.actions.shift()},push:function(a){this.actions.push({name:a})},pop:function(a){var b=0,c=this.actions.length;for(b;c>b;b++)this.actions[b].name===a&&this.actions.splice(b,1)}},this.data={},this.initEvents(b)}b.exports=d;var e={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9};d.C=e;var f=a("debug")("JsSIP:RTCSession"),g=a("./Constants"),h=a("./EventEmitter"),i=a("./Exceptions"),j=a("./Transactions"),k=a("./Parser"),l=a("./Utils"),m=a("./Timers"),n=a("./UA"),o=a("./WebRTC"),p=a("./SIPMessage"),q=a("./Dialog"),r=a("./RequestSender"),s=a("./RTCSession/RTCMediaHandler"),t=a("./RTCSession/Request"),u=a("./RTCSession/DTMF");d.prototype=new h,d.prototype.terminate=function(a){a=a||{};var b,c,d=a.cause||g.causes.BYE,h=a.status_code,k=a.reason_phrase,l=a.extraHeaders&&a.extraHeaders.slice()||[],m=a.body,n=this;if(this.status===e.STATUS_TERMINATED)throw new i.InvalidStateError(this.status);switch(this.status){case e.STATUS_NULL:case e.STATUS_INVITE_SENT:case e.STATUS_1XX_RECEIVED:if(f("canceling sesssion"),h&&(200>h||h>=700))throw new TypeError("Invalid status_code: "+h);h&&(k=k||g.REASON_PHRASE[h]||"",b="SIP ;cause="+h+' ;text="'+k+'"'),this.status===e.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=b):this.status===e.STATUS_INVITE_SENT?(this.isCanceled=!0,this.cancelReason=b):this.status===e.STATUS_1XX_RECEIVED&&this.request.cancel(b),this.status=e.STATUS_CANCELED,this.failed("local",null,g.causes.CANCELED);break;case e.STATUS_WAITING_FOR_ANSWER:case e.STATUS_ANSWERED:if(f("rejecting session"),h=h||480,300>h||h>=700)throw new TypeError("Invalid status_code: "+h);this.request.reply(h,k,l,m),this.failed("local",null,g.causes.REJECTED);break;case e.STATUS_WAITING_FOR_ACK:case e.STATUS_CONFIRMED:if(f("terminating session"),k=a.reason_phrase||g.REASON_PHRASE[h]||"",h&&(200>h||h>=700))throw new TypeError("Invalid status_code: "+h);h&&l.push("Reason: SIP ;cause="+h+'; text="'+k+'"'),this.status===e.STATUS_WAITING_FOR_ACK&&"incoming"===this.direction&&this.request.server_transaction.state!==j.C.STATUS_TERMINATED?(c=this.dialog,this.receiveRequest=function(a){a.method===g.ACK&&(this.sendRequest(g.BYE,{extraHeaders:l,body:m}),c.terminate())},this.request.server_transaction.on("stateChanged",function(a){a.sender.state===j.C.STATUS_TERMINATED&&(n.sendRequest(g.BYE,{extraHeaders:l,body:m}),c.terminate())}),this.ended("local",null,d),this.dialog=c,this.ua.dialogs[c.id.toString()]=c):(this.sendRequest(g.BYE,{extraHeaders:l,body:m}),this.ended("local",null,d))}this.close()},d.prototype.answer=function(a){a=a||{};var b,c,d,f,h=!1,j=!1,l=this,m=this.request,n=a.extraHeaders&&a.extraHeaders.slice()||[],o=a.mediaConstraints||{},p=a.RTCAnswerConstraints||{},q=a.mediaStream||null,r=function(a){l.rtcMediaHandler.addStream(a,t,u)},s=function(){m.reply(480),l.failed("local",null,g.causes.USER_DENIED_MEDIA_ACCESS)},t=function(){l.connecting(m),l.status!==e.STATUS_TERMINATED&&(l.late_sdp?l.rtcMediaHandler.createOffer(v,w,p):l.rtcMediaHandler.createAnswer(v,w,p))},u=function(){l.status!==e.STATUS_TERMINATED&&l.failed("system",null,g.causes.WEBRTC_ERROR)},v=function(a){var b=function(){l.status=e.STATUS_WAITING_FOR_ACK,l.setInvite2xxTimer(m,a),l.setACKTimer(),l.accepted("local")},c=function(){l.failed("system",null,g.causes.CONNECTION_ERROR)};m.reply(200,null,n,a,b,c)},w=function(){l.status!==e.STATUS_TERMINATED&&l.failed("system",null,g.causes.WEBRTC_ERROR)};if(this.data=a.data||{},"incoming"!==this.direction)throw new i.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this.status!==e.STATUS_WAITING_FOR_ANSWER)throw new i.InvalidStateError(this.status);if(this.status=e.STATUS_ANSWERED,!this.createDialog(m,"UAS"))return void m.reply(500,"Missing Contact header field");for(clearTimeout(this.timers.userNoAnswerTimer),n.unshift("Contact: "+l.contact),f=this.rtcMediaHandler.peerConnection.remoteDescription||{},d=k.parseSDP(f.sdp||""),d.media instanceof Array||(d.media=[d.media||[]]),b=d.media.length;b--;)"audio"!==d.media[b].type||"sendrecv"!==d.media[b].direction&&"recvonly"!==d.media[b].direction||(h=!0),"video"!==d.media[b].type||"sendrecv"!==d.media[b].direction&&"recvonly"!==d.media[b].direction||(j=!0);if(q&&o.audio===!1)for(c=q.getAudioTracks().length,b=0;c>b;b++)q.removeTrack(q.getAudioTracks()[b]);if(q&&o.video===!1)for(c=q.getVideoTracks().length,b=0;c>b;b++)q.removeTrack(q.getVideoTracks()[b]);void 0===o.audio&&(o.audio=h),void 0===o.video&&(o.video=j),q?r(q):this.rtcMediaHandler.getUserMedia(this.ua,r,s,o)},d.prototype.sendDTMF=function(a,b){var c,d,g=0,h=this;if(b=b||{},c=b.duration||null,d=b.interToneGap||null,void 0===a)throw new TypeError("Not enough arguments");if(this.status!==e.STATUS_CONFIRMED&&this.status!==e.STATUS_WAITING_FOR_ACK)throw new i.InvalidStateError(this.status);if("number"==typeof a&&(a=a.toString()),!a||"string"!=typeof a||!a.match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+a);if(c&&!l.isDecimal(c))throw new TypeError("Invalid tone duration: "+c);if(c?c<u.C.MIN_DURATION?(f('"duration" value is lower than the minimum allowed, setting it to '+u.C.MIN_DURATION+" milliseconds"),c=u.C.MIN_DURATION):c>u.C.MAX_DURATION?(f('"duration" value is greater than the maximum allowed, setting it to '+u.C.MAX_DURATION+" milliseconds"),c=u.C.MAX_DURATION):c=Math.abs(c):c=u.C.DEFAULT_DURATION,b.duration=c,d&&!l.isDecimal(d))throw new TypeError("Invalid interToneGap: "+d);if(d?d<u.C.MIN_INTER_TONE_GAP?(f('"interToneGap" value is lower than the minimum allowed, setting it to '+u.C.MIN_INTER_TONE_GAP+" milliseconds"),d=u.C.MIN_INTER_TONE_GAP):d=Math.abs(d):d=u.C.DEFAULT_INTER_TONE_GAP,this.tones)return void(this.tones+=a);this.tones=a;var j=function(){var a,f,i=h.tones;if(h.status===e.STATUS_TERMINATED||!i||g>=i.length)return void(h.tones=null);if(a=i[g],g+=1,","===a)f=2e3;else{var k=new u(h);k.on("failed",function(){h.tones=null}),k.send(a,b),f=c+d}setTimeout(j,f)};j()},d.prototype.sendRequest=function(a,b){var c=new t(this);c.send(a,b)},d.prototype.isReadyToReinvite=function(){return this.rtcMediaHandler.isReady()?this.dialog.uac_pending_reply===!0||this.dialog.uas_pending_reply===!0?!1:!0:void 0},d.prototype.mute=function(a){a=a||{audio:!0,video:!1};var b=!1,c=!1;this.audioMuted===!1&&a.audio&&(b=!0,this.audioMuted=!0,this.toogleMuteAudio(!0)),this.videoMuted===!1&&a.video&&(c=!0,this.videoMuted=!0,this.toogleMuteVideo(!0)),(b===!0||c===!0)&&this.onmute({audio:b,video:c})},d.prototype.unmute=function(a){a=a||{audio:!0,video:!0};var b=!1,c=!1;this.audioMuted===!0&&a.audio&&(b=!0,this.audioMuted=!1,this.local_hold===!1&&this.toogleMuteAudio(!1)),this.videoMuted===!0&&a.video&&(c=!0,this.videoMuted=!1,this.local_hold===!1&&this.toogleMuteVideo(!1)),(b===!0||c===!0)&&this.onunmute({audio:b,video:c})},d.prototype.isMuted=function(){return{audio:this.audioMuted,video:this.videoMuted}},d.prototype.hold=function(){if(this.status!==e.STATUS_WAITING_FOR_ACK&&this.status!==e.STATUS_CONFIRMED)throw new i.InvalidStateError(this.status);return this.toogleMuteAudio(!0),this.toogleMuteVideo(!0),this.isReadyToReinvite()?void(this.local_hold!==!0&&(this.onhold("local"),this.sendReinvite({mangle:function(a){var b,c;for(a=k.parseSDP(a),c=a.media.length,b=0;c>b;b++)void 0===a.media[b].direction?a.media[b].direction="sendonly":"sendrecv"===a.media[b].direction?a.media[b].direction="sendonly":"sendonly"===a.media[b].direction&&(a.media[b].direction="inactive");return k.writeSDP(a)}}))):this.pending_actions.isPending("unhold")?void this.pending_actions.pop("unhold"):this.pending_actions.isPending("hold")?void 0:void this.pending_actions.push("hold")},d.prototype.unhold=function(){if(this.status!==e.STATUS_WAITING_FOR_ACK&&this.status!==e.STATUS_CONFIRMED)throw new i.InvalidStateError(this.status);return this.audioMuted||this.toogleMuteAudio(!1),this.videoMuted||this.toogleMuteVideo(!1),this.isReadyToReinvite()?void(this.local_hold!==!1&&(this.onunhold("local"),this.sendReinvite())):this.pending_actions.isPending("hold")?void this.pending_actions.pop("hold"):this.pending_actions.isPending("unhold")?void 0:void this.pending_actions.push("unhold")},d.prototype.isOnHold=function(){return{local:this.local_hold,remote:this.remote_hold}},d.prototype.setInvite2xxTimer=function(a,b){var c=this,d=m.T1;this.timers.invite2xxTimer=setTimeout(function f(){c.status===e.STATUS_WAITING_FOR_ACK&&(a.reply(200,null,["Contact: "+c.contact],b),d<m.T2&&(d=2*d,d>m.T2&&(d=m.T2)),c.timers.invite2xxTimer=setTimeout(f,d))},d)},d.prototype.setACKTimer=function(){var a=this;this.timers.ackTimer=setTimeout(function(){a.status===e.STATUS_WAITING_FOR_ACK&&(f("no ACK received, terminating the session"),clearTimeout(a.timers.invite2xxTimer),a.sendRequest(g.BYE),a.ended("remote",null,g.causes.NO_ACK))},m.TIMER_H)},d.prototype.getLocalStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getLocalStreams()||[]},d.prototype.getRemoteStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]},d.prototype.init_incoming=function(a){var b,c=this,d=a.getHeader("Content-Type"),h=function(){c.status=e.STATUS_WAITING_FOR_ANSWER,c.timers.userNoAnswerTimer=setTimeout(function(){a.reply(408),c.failed("local",null,g.causes.NO_ANSWER)},c.ua.configuration.no_answer_timeout),b&&(c.timers.expiresTimer=setTimeout(function(){c.status===e.STATUS_WAITING_FOR_ANSWER&&(a.reply(487),c.failed("system",null,g.causes.EXPIRES))},b)),c.newRTCSession("remote",a),a.reply(180,null,["Contact: "+c.contact]),c.progress("local",null)};return a.body&&"application/sdp"!==d?void a.reply(415):(this.status=e.STATUS_INVITE_RECEIVED,this.from_tag=a.from_tag,this.id=a.call_id+this.from_tag,this.request=a,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,a.hasHeader("expires")&&(b=1e3*a.getHeader("expires")),a.to_tag=l.newTag(),this.createDialog(a,"UAS",!0)?(this.rtcMediaHandler=new s(this,{constraints:{optional:[{DtlsSrtpKeyAgreement:"true"}]}}),void(a.body?this.rtcMediaHandler.onMessage("offer",a.body,h,function(b){f("invalid SDP: "+b),a.reply(488)}):(this.late_sdp=!0,h()))):void a.reply(500,"Missing Contact header field"))},d.prototype.connect=function(a,b){b=b||{};var c,d,f,h=a,j=b.eventHandlers||{},k=b.extraHeaders&&b.extraHeaders.slice()||[],m=b.mediaConstraints||{audio:!0,video:!0},q=b.mediaStream||null,r=b.RTCConstraints||{},t=b.RTCOfferConstraints||{},u=b.stun_servers||null,v=b.turn_servers||null;
if(this.data=b.data||{},u){if(f=n.configuration_check.optional.stun_servers(u),!f)throw new TypeError("Invalid stun_servers: "+u);u=f}if(v){if(f=n.configuration_check.optional.turn_servers(v),!f)throw new TypeError("Invalid turn_servers: "+v);v=f}if(void 0===a)throw new TypeError("Not enough arguments");if(!o.isSupported)throw new i.NotSupportedError("WebRTC not supported");if(a=this.ua.normalizeTarget(a),!a)throw new TypeError("Invalid target: "+h);if(this.status!==e.STATUS_NULL)throw new i.InvalidStateError(this.status);for(c in j)this.on(c,j[c]);this.from_tag=l.newTag(),this.anonymous=b.anonymous||!1,this.isCanceled=!1,d={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(d.from_display_name="Anonymous",d.from_uri="sip:anonymous@anonymous.invalid",k.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),k.push("Privacy: id")),k.push("Contact: "+this.contact),k.push("Content-Type: application/sdp"),this.request=new p.OutgoingRequest(g.INVITE,a,this.ua,d,k),this.id=this.request.call_id+this.from_tag,this.rtcMediaHandler=new s(this,{constraints:r,stun_servers:u,turn_servers:v}),this.ua.sessions[this.id]=this,this.newRTCSession("local",this.request),this.sendInitialRequest(m,t,q)},d.prototype.close=function(){var a;if(this.status!==e.STATUS_TERMINATED){f("closing INVITE session "+this.id),this.rtcMediaHandler&&this.rtcMediaHandler.close();for(a in this.timers)clearTimeout(this.timers[a]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(a in this.earlyDialogs)this.earlyDialogs[a].terminate(),delete this.earlyDialogs[a];this.status=e.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},d.prototype.createDialog=function(a,b,c){var d,e,h="UAS"===b?a.to_tag:a.from_tag,i="UAS"===b?a.from_tag:a.to_tag,j=a.call_id+h+i;return e=this.earlyDialogs[j],c?e?!0:(e=new q(this,a,b,q.C.STATUS_EARLY),e.error?(f(d.error),this.failed("remote",a,g.causes.INTERNAL_ERROR),!1):(this.earlyDialogs[j]=e,!0)):e?(e.update(a,b),this.dialog=e,delete this.earlyDialogs[j],!0):(d=new q(this,a,b),d.error?(f(d.error),this.failed("remote",a,g.causes.INTERNAL_ERROR),!1):(this.to_tag=a.to_tag,this.dialog=d,!0))},d.prototype.receiveReinvite=function(a){var b,c,d,g=this,h=a.getHeader("Content-Type"),i=!1,j=function(a,b){g.late_sdp?g.rtcMediaHandler.createOffer(a,b):g.rtcMediaHandler.createAnswer(a,b)},l=function(){j(function(b){a.reply(200,null,["Contact: "+g.contact],b,function(){g.status=e.STATUS_WAITING_FOR_ACK,g.setInvite2xxTimer(a,b),g.setACKTimer(),g.remote_hold===!0&&i===!1?g.onunhold("remote"):g.remote_hold===!1&&i===!0&&g.onhold("remote")})},function(){a.reply(500)})};if(a.body){if("application/sdp"!==h)return f("invalid Content-Type"),void a.reply(415);for(b=k.parseSDP(a.body),c=0;c<b.media.length;c++)d=b.direction||b.media[c].direction||"sendrecv",("sendonly"===d||"inactive"===d)&&(i=!0);this.rtcMediaHandler.onMessage("offer",a.body,l,function(b){f(b),a.reply(488)})}else this.late_sdp=!0,l()},d.prototype.receiveUpdate=function(a){var b,c,d,e=this,g=a.getHeader("Content-Type"),h=!0;if(!a.body)return void a.reply(200);if("application/sdp"!==g)return f("invalid Content-Type"),void a.reply(415);for(b=k.parseSDP(a.body),c=0;c<b.media.length;c++)d=b.direction||b.media[c].direction||"sendrecv","sendonly"!==d&&"inactive"!==d&&(h=!1);this.rtcMediaHandler.onMessage("offer",a.body,function(){e.rtcMediaHandler.createAnswer(function(b){a.reply(200,null,["Contact: "+e.contact],b,function(){e.remote_hold===!0&&h===!1?e.onunhold("remote"):e.remote_hold===!1&&h===!0&&e.onhold("remote")})},function(){a.reply(500)})},function(b){f(b),a.reply(488)})},d.prototype.receiveRequest=function(a){var b,c=this;if(a.method===g.CANCEL)(this.status===e.STATUS_WAITING_FOR_ANSWER||this.status===e.STATUS_ANSWERED)&&(this.status=e.STATUS_CANCELED,this.request.reply(487),this.failed("remote",a,g.causes.CANCELED));else switch(a.method){case g.ACK:if(this.status===e.STATUS_WAITING_FOR_ACK){if(clearTimeout(this.timers.ackTimer),clearTimeout(this.timers.invite2xxTimer),this.late_sdp){if(!a.body){c.ended("remote",a,g.causes.MISSING_SDP);break}this.rtcMediaHandler.onMessage("answer",a.body,function(){c.late_sdp=!1,c.status=e.STATUS_CONFIRMED},function(b){f(b),c.ended("remote",a,g.causes.BAD_MEDIA_DESCRIPTION)})}else this.status=e.STATUS_CONFIRMED;this.status!==e.STATUS_CONFIRMED||this.is_confirmed||this.confirmed("remote",a)}break;case g.BYE:this.status===e.STATUS_CONFIRMED?(a.reply(200),this.ended("remote",a,g.causes.BYE)):this.status===e.STATUS_INVITE_RECEIVED?(a.reply(200),this.request.reply(487,"BYE Received"),this.ended("remote",a,g.causes.BYE)):a.reply(403,"Wrong Status");break;case g.INVITE:this.status===e.STATUS_CONFIRMED?(f("re-INVITE received"),this.receiveReinvite(a)):a.reply(403,"Wrong Status");break;case g.INFO:this.status===e.STATUS_CONFIRMED||this.status===e.STATUS_WAITING_FOR_ACK||this.status===e.STATUS_INVITE_RECEIVED?(b=a.getHeader("content-type"),b&&b.match(/^application\/dtmf-relay/i)?new u(this).init_incoming(a):a.reply(415)):a.reply(403,"Wrong Status");break;case g.UPDATE:this.status===e.STATUS_CONFIRMED?(f("UPDATE received"),this.receiveUpdate(a)):a.reply(403,"Wrong Status");break;default:a.reply(501)}},d.prototype.sendInitialRequest=function(a,b,c){var d=this,f=new r(d,this.ua),h=function(a){d.rtcMediaHandler.addStream(a,j,k)},i=function(){d.status!==e.STATUS_TERMINATED&&d.failed("local",null,g.causes.USER_DENIED_MEDIA_ACCESS)},j=function(){d.connecting(d.request),d.status!==e.STATUS_TERMINATED&&d.rtcMediaHandler.createOffer(l,m,b)},k=function(){d.status!==e.STATUS_TERMINATED&&d.failed("system",null,g.causes.WEBRTC_ERROR)},l=function(a){d.isCanceled||d.status===e.STATUS_TERMINATED||(d.request.body=a,d.status=e.STATUS_INVITE_SENT,f.send())},m=function(){d.status!==e.STATUS_TERMINATED&&d.failed("system",null,g.causes.WEBRTC_ERROR)};this.receiveResponse=this.receiveInviteResponse,c?h(c):this.rtcMediaHandler.getUserMedia(this.ua,h,i,a)},d.prototype.sendReinvite=function(a){a=a||{};var b=this,c=a.extraHeaders||[],d=a.eventHandlers||{},e=a.mangle||null;d.succeeded?this.reinviteSucceeded=d.succeeded:this.reinviteSucceeded=function(){},d.failed?this.reinviteFailed=d.failed:this.reinviteFailed=function(){},c.push("Contact: "+this.contact),c.push("Content-Type: application/sdp"),this.receiveResponse=this.receiveReinviteResponse,this.rtcMediaHandler.createOffer(function(a){e&&(a=e(a)),b.dialog.sendRequest(b,g.INVITE,{extraHeaders:c,body:a})},function(){b.isReadyToReinvite()&&b.onReadyToReinvite(),b.reinviteFailed()})},d.prototype.receiveInviteResponse=function(a){var b,c,d=this;if(this.dialog&&a.status_code>=200&&a.status_code<=299)return this.dialog.id.call_id===a.call_id&&this.dialog.id.local_tag===a.from_tag&&this.dialog.id.remote_tag===a.to_tag?void this.sendRequest(g.ACK):(c=new q(this,a,"UAC"),void 0!==c.error?void f(c.error):(c.sendRequest({owner:{status:e.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},g.ACK),void c.sendRequest({owner:{status:e.STATUS_TERMINATED},onRequestTimeout:function(){},onTransportError:function(){},onDialogError:function(){},receiveResponse:function(){}},g.BYE)));if(this.isCanceled)return this.isCanceled=!1,void(a.status_code>=100&&a.status_code<200?this.request.cancel(this.cancelReason):a.status_code>=200&&a.status_code<299&&this.acceptAndTerminate(a));if(this.status===e.STATUS_INVITE_SENT||this.status===e.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(a.status_code):break;case/^1[0-9]{2}$/.test(a.status_code):if(this.status!==e.STATUS_INVITE_SENT&&this.status!==e.STATUS_1XX_RECEIVED)break;if(!a.to_tag){f("1xx response received without to tag");break}if(a.hasHeader("contact")&&!this.createDialog(a,"UAC",!0))break;if(this.status=e.STATUS_1XX_RECEIVED,this.progress("remote",a),!a.body)break;this.rtcMediaHandler.onMessage("pranswer",a.body,function(){},function(b){f(b),d.earlyDialogs[a.call_id+a.from_tag+a.to_tag].terminate()});break;case/^2[0-9]{2}$/.test(a.status_code):if(this.status=e.STATUS_CONFIRMED,!a.body){this.acceptAndTerminate(a,400,g.causes.MISSING_SDP),this.failed("remote",a,g.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(a,"UAC"))break;this.rtcMediaHandler.onMessage("answer",a.body,function(){d.accepted("remote",a),d.sendRequest(g.ACK),d.confirmed("local",null)},function(b){f(b),d.acceptAndTerminate(a,488,"Not Acceptable Here"),d.failed("remote",a,g.causes.BAD_MEDIA_DESCRIPTION)});break;default:b=l.sipErrorCause(a.status_code),this.failed("remote",a,b)}},d.prototype.receiveReinviteResponse=function(a){var b=this,c=a.getHeader("Content-Type");if(this.status!==e.STATUS_TERMINATED)switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):if(this.status=e.STATUS_CONFIRMED,this.sendRequest(g.ACK),!a.body){this.reinviteFailed();break}if("application/sdp"!==c){this.reinviteFailed();break}this.rtcMediaHandler.onMessage("answer",a.body,function(){b.reinviteSucceeded()},function(){b.reinviteFailed()});break;default:this.reinviteFailed()}},d.prototype.acceptAndTerminate=function(a,b,c){var d=[];b&&(c=c||g.REASON_PHRASE[b]||"",d.push("Reason: SIP ;cause="+b+'; text="'+c+'"')),(this.dialog||this.createDialog(a,"UAC"))&&(this.sendRequest(g.ACK),this.sendRequest(g.BYE,{extraHeaders:d})),this.status=e.STATUS_TERMINATED},d.prototype.toogleMuteAudio=function(a){var b,c,d,e=this.getLocalStreams();for(b in e){d=e[b].getAudioTracks();for(c in d)d[c].enabled=!a}},d.prototype.toogleMuteVideo=function(a){var b,c,d,e=this.getLocalStreams();for(b in e){d=e[b].getVideoTracks();for(c in d)d[c].enabled=!a}},d.prototype.onTransportError=function(){this.status!==e.STATUS_TERMINATED&&(this.status===e.STATUS_CONFIRMED?this.ended("system",null,g.causes.CONNECTION_ERROR):this.failed("system",null,g.causes.CONNECTION_ERROR))},d.prototype.onRequestTimeout=function(){this.status!==e.STATUS_TERMINATED&&(this.status===e.STATUS_CONFIRMED?this.ended("system",null,g.causes.REQUEST_TIMEOUT):this.failed("system",null,g.causes.REQUEST_TIMEOUT))},d.prototype.onDialogError=function(a){this.status!==e.STATUS_TERMINATED&&(this.status===e.STATUS_CONFIRMED?this.ended("remote",a,g.causes.DIALOG_ERROR):this.failed("remote",a,g.causes.DIALOG_ERROR))},d.prototype.newRTCSession=function(a,b){var c=this,d="newRTCSession";"remote"===a?(c.direction="incoming",c.local_identity=b.to,c.remote_identity=b.from):"local"===a&&(c.direction="outgoing",c.local_identity=b.from,c.remote_identity=b.to),c.ua.emit(d,c.ua,{originator:a,session:c,request:b})},d.prototype.connecting=function(a){var b=this,c="connecting";b.emit(c,b,{request:a})},d.prototype.progress=function(a,b){var c=this,d="progress";c.emit(d,c,{originator:a,response:b||null})},d.prototype.accepted=function(a,b){var c=this,d="accepted";c.start_time=new Date,c.emit(d,c,{originator:a,response:b||null})},d.prototype.confirmed=function(a,b){var c=this,d="confirmed";this.is_confirmed=!0,c.emit(d,c,{originator:a,ack:b||null})},d.prototype.ended=function(a,b,c){var d=this,e="ended";d.end_time=new Date,d.close(),d.emit(e,d,{originator:a,message:b||null,cause:c})},d.prototype.failed=function(a,b,c){var d=this,e="failed";d.close(),d.emit(e,d,{originator:a,message:b||null,cause:c})},d.prototype.onhold=function(a){"local"===a?this.local_hold=!0:this.remote_hold=!0,this.emit("hold",this,{originator:a})},d.prototype.onunhold=function(a){"local"===a?this.local_hold=!1:this.remote_hold=!1,this.emit("unhold",this,{originator:a})},d.prototype.onmute=function(a){this.emit("muted",this,{audio:a.audio,video:a.video})},d.prototype.onunmute=function(a){this.emit("unmuted",this,{audio:a.audio,video:a.video})},d.prototype.onReadyToReinvite=function(){var a=this.pending_actions.length()>0?this.pending_actions.shift():null;a&&("hold"===a.name?this.hold():"unhold"===a.name&&this.unhold())}},{"./Constants":10,"./Dialog":11,"./EventEmitter":14,"./Exceptions":15,"./Parser":20,"./RTCSession/DTMF":22,"./RTCSession/RTCMediaHandler":23,"./RTCSession/Request":24,"./RequestSender":26,"./SIPMessage":27,"./Timers":28,"./Transactions":29,"./UA":31,"./Utils":33,"./WebRTC":34,debug:1}],22:[function(a,b,c){function d(a){var b=["succeeded","failed"];this.owner=a,this.direction=null,this.tone=null,this.duration=null,this.initEvents(b)}b.exports=d;var e={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};d.C=e;var f=a("debug")("JsSIP:RTCSession:DTMF"),g=a("../Constants"),h=a("../EventEmitter"),i=a("../Exceptions"),j=a("../RTCSession"),k=a("../Utils");d.prototype=new h,d.prototype.send=function(a,b){var c,d,e,f;if(void 0===a)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.owner.status!==j.C.STATUS_CONFIRMED&&this.owner.status!==j.C.STATUS_WAITING_FOR_ACK)throw new i.InvalidStateError(this.owner.status);if(b=b||{},e=b.extraHeaders?b.extraHeaders.slice():[],d=b.eventHandlers||{},"string"==typeof a)a=a.toUpperCase();else{if("number"!=typeof a)throw new TypeError("Invalid tone: "+a);a=a.toString()}if(!a.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+a);this.tone=a,this.duration=b.duration;for(c in d)this.on(c,d[c]);e.push("Content-Type: application/dtmf-relay"),f="Signal= "+this.tone+"\r\n",f+="Duration= "+this.duration,this.owner.emit("newDTMF",this.owner,{originator:"local",dtmf:this,request:this.request}),this.owner.dialog.sendRequest(this,g.INFO,{extraHeaders:e,body:f})},d.prototype.receiveResponse=function(a){var b;switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):this.emit("succeeded",this,{originator:"remote",response:a});break;default:b=k.sipErrorCause(a.status_code),this.emit("failed",this,{originator:"remote",response:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:g.causes.REQUEST_TIMEOUT}),this.owner.onRequestTimeout()},d.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:g.causes.CONNECTION_ERROR}),this.owner.onTransportError()},d.prototype.onDialogError=function(a){this.emit("failed",this,{originator:"remote",response:a,cause:g.causes.DIALOG_ERROR}),this.owner.onDialogError(a)},d.prototype.init_incoming=function(a){var b,c=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,d=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=a,a.reply(200),a.body&&(b=a.body.split("\r\n"),2===b.length&&(c.test(b[0])&&(this.tone=b[0].replace(c,"$2")),d.test(b[1])&&(this.duration=parseInt(b[1].replace(d,"$2"),10)))),this.tone&&this.duration?this.owner.emit("newDTMF",this.owner,{originator:"remote",dtmf:this,request:a}):f("invalid INFO DTMF received, discarded")}},{"../Constants":10,"../EventEmitter":14,"../Exceptions":15,"../RTCSession":21,"../Utils":33,debug:1}],23:[function(a,b,c){function d(a,b){b=b||{},this.session=a,this.localMedia=null,this.peerConnection=null,this.ready=!0,this.init(b)}b.exports=d;var e=a("debug")("JsSIP:RTCSession:RTCMediaHandler"),f=a("../Constants"),g=a("../WebRTC");d.prototype={isReady:function(){return this.ready},createOffer:function(a,b,c){function d(){"complete"===f.peerConnection.iceGatheringState?(f.ready=!0,a(f.peerConnection.localDescription.sdp)):f.onIceCompleted=function(){f.onIceCompleted=void 0,f.ready=!0,a(f.peerConnection.localDescription.sdp)}}var f=this;this.ready=!1,this.peerConnection.createOffer(function(a){f.setLocalDescription(a,d,function(a){f.ready=!0,b(a)})},function(a){f.ready=!0,e("unable to create offer"),e(a),b(a)},c)},createAnswer:function(a,b,c){function d(){"complete"===f.peerConnection.iceGatheringState?(f.ready=!0,a(f.peerConnection.localDescription.sdp)):f.onIceCompleted=function(){f.onIceCompleted=void 0,f.ready=!0,a(f.peerConnection.localDescription.sdp)}}var f=this;this.ready=!1,this.peerConnection.createAnswer(function(a){f.setLocalDescription(a,d,function(a){f.ready=!0,b(a)})},function(a){f.ready=!0,e("unable to create answer"),e(a),b(a)},c)},setLocalDescription:function(a,b,c){this.peerConnection.setLocalDescription(a,b,function(a){e("unable to set local description"),e(a),c(a)})},addStream:function(a,b,c,d){try{this.peerConnection.addStream(a,d)}catch(f){return e("error adding stream"),e(f),void c()}b()},init:function(a){a=a||{};var b,c,d,h=this,i=[],j=a.constraints||{},k=a.stun_servers||null,l=a.turn_servers||null,m=this.session.ua.configuration;for(k||(k=m.stun_servers),l||(l=m.turn_servers),k.length>0&&i.push({url:k}),c=l.length,b=0;c>b;b++)d=l[b],i.push({url:d.urls,username:d.username,credential:d.credential});this.peerConnection=new g.RTCPeerConnection({iceServers:i},j),this.peerConnection.onaddstream=function(a){e("stream added: "+a.stream.id)},this.peerConnection.onremovestream=function(a){e("stream removed: "+a.stream.id)},this.peerConnection.onicecandidate=function(){"function"==typeof h.onIceCompleted&&h.onIceCompleted()},this.peerConnection.oniceconnectionstatechange=function(){e('ICE connection state changed to "'+this.iceConnectionState+'"'),"failed"===this.iceConnectionState&&h.session.terminate({cause:f.causes.RTP_TIMEOUT,status_code:200,reason_phrase:f.causes.RTP_TIMEOUT})},this.peerConnection.onstatechange=function(){e('PeerConnection state changed to "'+this.readyState+'"')}},close:function(){e("closing PeerConnection"),this.peerConnection&&this.peerConnection.close()},getUserMedia:function(a,b,c,d){var f=this;e("requesting access to local media");var h=function(c){e("got local media stream"),f.localMedia=c,a.emit("mediaPermissionsAccept",a),b(c)},i=function(b){e("unable to get user media"),e(b),a.emit("mediaPermissionsRefuse",a),c()},j=window.oktellVoice&&"function"==typeof window.oktellVoice.getUserMediaStream?window.oktellVoice.getUserMediaStream():void 0;j?h(j):window.oktellVoice&&"function"==typeof window.oktellVoice.getUserMediaStream?(a.emit("mediaPermissionsRequest",a),window.oktellVoice.getUserMediaStream(h,i,!1)):g.getUserMedia(d,h,i)},onMessage:function(a,b,c,d){this.peerConnection.setRemoteDescription(new g.RTCSessionDescription({type:a,sdp:b}),c,d)}}},{"../Constants":10,"../WebRTC":34,debug:1}],24:[function(a,b,c){function d(a){var b=["progress","succeeded","failed"];this.owner=a,this.initEvents(b)}b.exports=d;var e=a("../Constants"),f=a("../EventEmitter"),g=a("../Exceptions"),h=a("../RTCSession"),i=a("../Utils");d.prototype=new f,d.prototype.send=function(a,b){b=b||{};var c,d=b.extraHeaders&&b.extraHeaders.slice()||[],f=b.eventHandlers||{},i=b.body||null;if(void 0===a)throw new TypeError("Not enough arguments");if(this.owner.status!==h.C.STATUS_1XX_RECEIVED&&this.owner.status!==h.C.STATUS_WAITING_FOR_ANSWER&&this.owner.status!==h.C.STATUS_WAITING_FOR_ACK&&this.owner.status!==h.C.STATUS_CONFIRMED&&this.owner.status!==h.C.STATUS_TERMINATED)throw new g.InvalidStateError(this.owner.status);if(this.owner.status===h.C.STATUS_TERMINATED&&a!==e.BYE)throw new g.InvalidStateError(this.owner.status);for(c in f)this.on(c,f[c]);this.owner.dialog.sendRequest(this,a,{extraHeaders:d,body:i})},d.prototype.receiveResponse=function(a){var b;switch(!0){case/^1[0-9]{2}$/.test(a.status_code):this.emit("progress",this,{originator:"remote",response:a});break;case/^2[0-9]{2}$/.test(a.status_code):this.emit("succeeded",this,{originator:"remote",response:a});break;default:b=i.sipErrorCause(a.status_code),this.emit("failed",this,{originator:"remote",response:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:e.causes.REQUEST_TIMEOUT}),this.owner.onRequestTimeout()},d.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:e.causes.CONNECTION_ERROR}),this.owner.onTransportError()},d.prototype.onDialogError=function(a){this.emit("failed",this,{originator:"remote",response:a,cause:e.causes.DIALOG_ERROR}),this.owner.onDialogError(a)}},{"../Constants":10,"../EventEmitter":14,"../Exceptions":15,"../RTCSession":21,"../Utils":33}],25:[function(a,b,c){function d(a,b){var c=1;this.ua=a,this.transport=b,this.registrar=a.configuration.registrar_server,this.expires=a.configuration.register_expires,this.call_id=f.createRandomToken(22),this.cseq=0,this.to_uri=a.configuration.uri,this.registrationTimer=null,this.registered=!1,this.contact=this.ua.contact.toString(),this.contact+=";+sip.ice",this.extraHeaders=[],this.extraContactParams="",c&&(this.contact+=";reg-id="+c,this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"')}b.exports=d;var e=a("debug")("JsSIP:Registrator"),f=a("./Utils"),g=a("./Constants"),h=a("./SIPMessage"),i=a("./RequestSender");d.prototype={setExtraHeaders:function(a){!a instanceof Array&&(a=[]),this.extraHeaders=a.slice()},setExtraContactParams:function(a){!a instanceof Object&&(a={}),this.extraContactParams="";for(var b in a){var c=a[b];this.extraContactParams+=";"+b,c&&(this.extraContactParams+="="+c)}},register:function(){var a,b,c,d=this;c=this.extraHeaders.slice(),c.push("Contact: "+this.contact+";expires="+this.expires+this.extraContactParams),c.push("Expires: "+this.expires),this.request=new h.OutgoingRequest(g.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},c),a=new i(this,this.ua),this.receiveResponse=function(a){var c,h,i=a.getHeaders("contact").length;if(a.cseq===this.cseq)switch(null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):if(a.hasHeader("expires")&&(h=a.getHeader("expires")),!i){e("no Contact header in response to REGISTER, response ignored");break}for(;i--;){if(c=a.parseHeader("contact",i),c.uri.user===this.ua.contact.uri.user){h=c.getParam("expires");break}c=null}if(!c){e("no Contact header pointing to us, response ignored");break}h||(h=this.expires),this.registrationTimer=setTimeout(function(){d.registrationTimer=null,d.register()},1e3*h-3e3),c.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=c.getParam("temp-gruu").replace(/"/g,"")),c.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=c.getParam("pub-gruu").replace(/"/g,"")),this.registered||(this.registered=!0,this.ua.emit("registered",this.ua,{response:a}));break;case/^423$/.test(a.status_code):a.hasHeader("min-expires")?(this.expires=a.getHeader("min-expires"),this.register()):(e("423 response received for REGISTER without Min-Expires"),this.registrationFailure(a,g.causes.SIP_FAILURE_CODE));break;default:b=f.sipErrorCause(a.status_code),this.registrationFailure(a,b)}},this.onRequestTimeout=function(){this.registrationFailure(null,g.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,g.causes.CONNECTION_ERROR)},a.send()},unregister:function(a){var b;if(!this.registered)return void e("already unregistered");a=a||{},this.registered=!1,null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),b=this.extraHeaders.slice(),a.all?(b.push("Contact: *"+this.extraContactParams),b.push("Expires: 0"),this.request=new h.OutgoingRequest(g.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},b)):(b.push("Contact: "+this.contact+";expires=0"+this.extraContactParams),b.push("Expires: 0"),this.request=new h.OutgoingRequest(g.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},b));var c=new i(this,this.ua);this.receiveResponse=function(a){var b;switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):this.unregistered(a);break;default:b=f.sipErrorCause(a.status_code),this.unregistered(a,b)}},this.onRequestTimeout=function(){this.unregistered(null,g.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,g.causes.CONNECTION_ERROR)},c.send()},registrationFailure:function(a,b){this.ua.emit("registrationFailed",this.ua,{response:a||null,cause:b}),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua,{response:a||null,cause:b}))},unregistered:function(a,b){this.registered=!1,this.ua.emit("unregistered",this.ua,{response:a||null,cause:b||null})},onTransportClosed:function(){null!==this.registrationTimer&&(clearTimeout(this.registrationTimer),this.registrationTimer=null),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua))},close:function(){this.registered&&this.unregister()}}},{"./Constants":10,"./RequestSender":26,"./SIPMessage":27,"./Utils":33,debug:1}],26:[function(a,b,c){function d(a,b){this.ua=b,this.applicant=a,this.method=a.request.method,this.request=a.request,this.credentials=null,this.challenged=!1,this.staled=!1,b.status!==g.C.STATUS_USER_CLOSED||this.method===f.BYE&&this.method===f.ACK||this.onTransportError()}b.exports=d;var e=a("debug")("JsSIP:RequestSender"),f=a("./Constants"),g=a("./UA"),h=a("./DigestAuthentication"),i=a("./Transactions");d.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new i.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new i.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new i.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(a){var b,c,d,g=a.status_code;if(401!==g&&407!==g||null===this.ua.configuration.password)this.applicant.receiveResponse(a);else{if(401===a.status_code?(c=a.parseHeader("www-authenticate"),d="authorization"):(c=a.parseHeader("proxy-authenticate"),d="proxy-authorization"),!c)return e(a.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(a);if(!this.challenged||!this.staled&&c.stale===!0){if(this.credentials||(this.credentials=new h(this.ua)),!this.credentials.authenticate(this.request,c))return void this.applicant.receiveResponse(a);this.challenged=!0,c.stale&&(this.staled=!0),a.method===f.REGISTER?b=this.applicant.cseq+=1:this.request.dialog?b=this.request.dialog.local_seqnum+=1:(b=this.request.cseq+1,this.request.cseq=b),this.request.setHeader("cseq",b+" "+this.method),this.request.setHeader(d,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(a)}}}},{"./Constants":10,"./DigestAuthentication":13,"./Transactions":29,"./UA":31,debug:1}],27:[function(a,b,c){function d(a,b,c,d,e,f){var g,h,l,m;return d=d||{},a&&b&&c?(this.ua=c,this.headers={},this.method=a,this.ruri=b,this.body=f,this.extraHeaders=e&&e.slice()||[],d.route_set?this.setHeader("route",d.route_set):c.configuration.use_preloaded_route&&this.setHeader("route",c.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",i.MAX_FORWARDS),g=d.to_display_name||0===d.to_display_name?'"'+d.to_display_name+'" ':"",g+="<"+(d.to_uri||b)+">",g+=d.to_tag?";tag="+d.to_tag:"",this.to=new k.parse(g),this.setHeader("to",g),h=d.from_display_name||0===d.from_display_name?'"'+d.from_display_name+'" ':c.configuration.display_name?'"'+c.configuration.display_name+'" ':"",h+="<"+(d.from_uri||c.configuration.uri)+">;tag=",h+=d.from_tag||j.newTag(),this.from=new k.parse(h),this.setHeader("from",h),l=d.call_id||c.configuration.jssip_id+j.createRandomToken(15),this.call_id=l,this.setHeader("call-id",l),m=d.cseq||Math.floor(1e4*Math.random()),this.cseq=m,void this.setHeader("cseq",m+" "+a)):null}function e(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null}function f(a){this.ua=a,this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}function g(){this.headers={},this.status_code=null,this.reason_phrase=null}b.exports={OutgoingRequest:d,IncomingRequest:f,IncomingResponse:g};var h=a("debug")("JsSIP:SIPMessage"),i=a("./Constants"),j=a("./Utils"),k=a("./NameAddrHeader"),l=a("./Grammar");d.prototype={setHeader:function(a,b){this.headers[j.headerize(a)]=b instanceof Array?b:[b]},getHeader:function(a){var b,c,d=this.extraHeaders.length,e=this.headers[j.headerize(a)];if(e){if(e[0])return e[0]}else for(b=new RegExp("^\\s*"+a+"\\s*:","i"),c=0;d>c;c++)if(e=this.extraHeaders[c],b.test(e))return e.substring(e.indexOf(":")+1).trim()},getHeaders:function(a){var b,c,d,e=this.headers[j.headerize(a)],f=[];if(e){for(c=e.length,b=0;c>b;b++)f.push(e[b]);return f}for(c=this.extraHeaders.length,d=new RegExp("^\\s*"+a+"\\s*:","i"),b=0;c>b;b++)e=this.extraHeaders[b],d.test(e)&&f.push(e.substring(e.indexOf(":")+1).trim());return f},hasHeader:function(a){var b,c,d=this.extraHeaders.length;if(this.headers[j.headerize(a)])return!0;for(b=new RegExp("^\\s*"+a+"\\s*:","i"),c=0;d>c;c++)if(b.test(this.extraHeaders[c]))return!0;return!1},toString:function(){var a,b,c,d="",e=[];d+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(a in this.headers)for(b=this.headers[a].length,c=0;b>c;c++)d+=a+": "+this.headers[a][c]+"\r\n";for(b=this.extraHeaders.length,c=0;b>c;c++)d+=this.extraHeaders[c].trim()+"\r\n";switch(this.method){case i.REGISTER:e.push("path","gruu");break;case i.INVITE:(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&e.push("gruu")}return e.push("outbound"),d+="Allow: "+i.ALLOWED_METHODS+"\r\n",d+="Supported: "+e+"\r\n",d+="User-Agent: "+i.USER_AGENT+"\r\n",this.body?(b=j.str_utf8_length(this.body),d+="Content-Length: "+b+"\r\n\r\n",d+=this.body):d+="Content-Length: 0\r\n\r\n",d}},e.prototype={addHeader:function(a,b){var c={raw:b};a=j.headerize(a),this.headers[a]?this.headers[a].push(c):this.headers[a]=[c]},getHeader:function(a){var b=this.headers[j.headerize(a)];if(b)return b[0]?b[0].raw:void 0},getHeaders:function(a){var b,c,d=this.headers[j.headerize(a)],e=[];if(!d)return[];for(c=d.length,b=0;c>b;b++)e.push(d[b].raw);return e},hasHeader:function(a){return this.headers[j.headerize(a)]?!0:!1},parseHeader:function(a,b){var c,d,e;return a=j.headerize(a),b=b||0,this.headers[a]?b>=this.headers[a].length?void h('not so many "'+a+'" headers present'):(c=this.headers[a][b],d=c.raw,c.parsed?c.parsed:(e=l.parse(d,a.replace(/-/g,"_")),-1===e?(this.headers[a].splice(b,1),void h('error parsing "'+a+'" header field with value "'+d+'"')):(c.parsed=e,e))):void h('header "'+a+'" not present')},s:function(a,b){return this.parseHeader(a,b)},setHeader:function(a,b){var c={raw:b};this.headers[j.headerize(a)]=[c]},toString:function(){return this.data}},f.prototype=new e,f.prototype.reply=function(a,b,c,d,e,f){var g,h,k,l,m,n=[],o=this.getHeader("To"),p=0,q=0;if(a=a||null,b=b||null,!a||100>a||a>699)throw new TypeError("Invalid status_code: "+a);if(b&&"string"!=typeof b&&!(b instanceof String))throw new TypeError("Invalid reason_phrase: "+b);if(b=b||i.REASON_PHRASE[a]||"",c=c&&c.slice()||[],m="SIP/2.0 "+a+" "+b+"\r\n",this.method===i.INVITE&&a>100&&200>=a)for(g=this.getHeaders("record-route"),k=g.length,p;k>p;p++)m+="Record-Route: "+g[p]+"\r\n";for(h=this.getHeaders("via"),k=h.length,q;k>q;q++)m+="Via: "+h[q]+"\r\n";for(!this.to_tag&&a>100?o+=";tag="+j.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(o+=";tag="+this.to_tag),m+="To: "+o+"\r\n",m+="From: "+this.getHeader("From")+"\r\n",m+="Call-ID: "+this.call_id+"\r\n",m+="CSeq: "+this.cseq+" "+this.method+"\r\n",k=c.length,l=0;k>l;l++)m+=c[l].trim()+"\r\n";switch(this.method){case i.INVITE:(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&n.push("gruu")}n.push("outbound"),this.method===i.OPTIONS?(m+="Allow: "+i.ALLOWED_METHODS+"\r\n",m+="Accept: "+i.ACCEPTED_BODY_TYPES+"\r\n"):405===a?m+="Allow: "+i.ALLOWED_METHODS+"\r\n":415===a&&(m+="Accept: "+i.ACCEPTED_BODY_TYPES+"\r\n"),m+="Supported: "+n+"\r\n",d?(k=j.str_utf8_length(d),m+="Content-Type: application/sdp\r\n",m+="Content-Length: "+k+"\r\n\r\n",m+=d):m+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(a,m,e,f)},f.prototype.reply_sl=function(a,b){var c,d,e=0,f=this.getHeaders("via"),g=f.length;
if(a=a||null,b=b||null,!a||100>a||a>699)throw new TypeError("Invalid status_code: "+a);if(b&&"string"!=typeof b&&!(b instanceof String))throw new TypeError("Invalid reason_phrase: "+b);for(b=b||i.REASON_PHRASE[a]||"",d="SIP/2.0 "+a+" "+b+"\r\n",e;g>e;e++)d+="Via: "+f[e]+"\r\n";c=this.getHeader("To"),!this.to_tag&&a>100?c+=";tag="+j.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(c+=";tag="+this.to_tag),d+="To: "+c+"\r\n",d+="From: "+this.getHeader("From")+"\r\n",d+="Call-ID: "+this.call_id+"\r\n",d+="CSeq: "+this.cseq+" "+this.method+"\r\n",d+="Content-Length: 0\r\n\r\n",this.transport.send(d)},g.prototype=new e},{"./Constants":10,"./Grammar":16,"./NameAddrHeader":19,"./Utils":33,debug:1}],28:[function(a,b,c){var d=500,e=4e3,f=5e3,g={T1:d,T2:e,T4:f,TIMER_B:64*d,TIMER_D:0*d,TIMER_F:64*d,TIMER_H:64*d,TIMER_I:0*d,TIMER_J:0*d,TIMER_K:0*f,TIMER_L:64*d,TIMER_M:64*d,PROVISIONAL_RESPONSE_INTERVAL:6e4};b.exports=g},{}],29:[function(a,b,c){function d(a,b,c){var d,e,f=["stateChanged"];this.type=j.NON_INVITE_CLIENT,this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,e=a.ua.configuration.hack_via_tcp?"TCP":a.ua.configuration.hack_via_ws?"WS":c.server.scheme,d="SIP/2.0/"+e,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d),this.request_sender.ua.newTransaction(this),this.initEvents(f)}function e(a,b,c){var d,e,f=this,g=["stateChanged"];this.type=j.INVITE_CLIENT,this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,e=a.ua.configuration.hack_via_tcp?"TCP":a.ua.configuration.hack_via_ws?"WS":c.server.scheme,d="SIP/2.0/"+e,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d),this.request_sender.ua.newTransaction(this),this.request.cancel=function(a){f.cancel_request(f,a)},this.initEvents(g)}function f(a,b,c){var d,e;this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,e=a.ua.configuration.hack_via_tcp?"TCP":a.ua.configuration.hack_via_ws?"WS":c.server.scheme,d="SIP/2.0/"+e,d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d)}function g(a,b){var c=["stateChanged"];this.type=j.NON_INVITE_SERVER,this.id=a.via_branch,this.request=a,this.transport=a.transport,this.ua=b,this.last_response="",a.server_transaction=this,this.state=j.STATUS_TRYING,b.newTransaction(this),this.initEvents(c)}function h(a,b){var c=["stateChanged"];this.type=j.INVITE_SERVER,this.id=a.via_branch,this.request=a,this.transport=a.transport,this.ua=b,this.last_response="",a.server_transaction=this,this.state=j.STATUS_PROCEEDING,b.newTransaction(this),this.resendProvisionalTimer=null,a.reply(100),this.initEvents(c)}function i(a,b){var c;switch(b.method){case p.INVITE:if(c=a.transactions.ist[b.via_branch]){switch(c.state){case j.STATUS_PROCEEDING:c.transport.send(c.last_response);break;case j.STATUS_ACCEPTED:}return!0}break;case p.ACK:if(c=a.transactions.ist[b.via_branch],!c)return!1;if(c.state===j.STATUS_ACCEPTED)return!1;if(c.state===j.STATUS_COMPLETED)return c.state=j.STATUS_CONFIRMED,c.I=setTimeout(function(){c.timer_I()},r.TIMER_I),!0;break;case p.CANCEL:return c=a.transactions.ist[b.via_branch],c?(b.reply_sl(200),c.state===j.STATUS_PROCEEDING?!1:!0):(b.reply_sl(481),!0);default:if(c=a.transactions.nist[b.via_branch]){switch(c.state){case j.STATUS_TRYING:break;case j.STATUS_PROCEEDING:case j.STATUS_COMPLETED:c.transport.send(c.last_response)}return!0}}}b.exports={C:null,NonInviteClientTransaction:d,InviteClientTransaction:e,AckClientTransaction:f,NonInviteServerTransaction:g,InviteServerTransaction:h,checkTransaction:i};var j={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"};b.exports.C=j;var k=a("debug")("JsSIP:NonInviteClientTransaction"),l=a("debug")("JsSIP:InviteClientTransaction"),m=a("debug")("JsSIP:AckClientTransaction"),n=a("debug")("JsSIP:NonInviteServerTransaction"),o=a("debug")("JsSIP:InviteServerTransaction"),p=a("./Constants"),q=a("./EventEmitter"),r=a("./Timers");d.prototype=new q,d.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged",this)},d.prototype.send=function(){var a=this;this.stateChanged(j.STATUS_TRYING),this.F=setTimeout(function(){a.timer_F()},r.TIMER_F),this.transport.send(this.request)||this.onTransportError()},d.prototype.onTransportError=function(){k("transport error occurred, deleting transaction "+this.id),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onTransportError()},d.prototype.timer_F=function(){k("Timer F expired for transaction "+this.id),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout()},d.prototype.timer_K=function(){this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},d.prototype.receiveResponse=function(a){var b=this,c=a.status_code;if(200>c)switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_PROCEEDING),this.request_sender.receiveResponse(a)}else switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),clearTimeout(this.F),408===c?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(a),this.K=setTimeout(function(){b.timer_K()},r.TIMER_K);break;case j.STATUS_COMPLETED:}},e.prototype=new q,e.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged",this)},e.prototype.send=function(){var a=this;this.stateChanged(j.STATUS_CALLING),this.B=setTimeout(function(){a.timer_B()},r.TIMER_B),this.transport.send(this.request)||this.onTransportError()},e.prototype.onTransportError=function(){l("transport error occurred, deleting transaction "+this.id),clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.state!==j.STATUS_ACCEPTED&&this.request_sender.onTransportError()},e.prototype.timer_M=function(){l("Timer M expired for transaction "+this.id),this.state===j.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this))},e.prototype.timer_B=function(){l("Timer B expired for transaction "+this.id),this.state===j.STATUS_CALLING&&(this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this),this.request_sender.onRequestTimeout())},e.prototype.timer_D=function(){l("Timer D expired for transaction "+this.id),clearTimeout(this.B),this.stateChanged(j.STATUS_TERMINATED),this.request_sender.ua.destroyTransaction(this)},e.prototype.sendACK=function(a){var b=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+a.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n",this.ack+="Content-Length: 0\r\n\r\n",this.D=setTimeout(function(){b.timer_D()},r.TIMER_D),this.transport.send(this.ack)},e.prototype.cancel_request=function(a,b){var c=a.request;this.cancel=p.CANCEL+" "+c.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+c.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+c.headers.Route.toString()+"\r\n"),this.cancel+="To: "+c.headers.To.toString()+"\r\n",this.cancel+="From: "+c.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+c.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+c.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",b&&(this.cancel+="Reason: "+b+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===j.STATUS_PROCEEDING&&this.transport.send(this.cancel)},e.prototype.receiveResponse=function(a){var b=this,c=a.status_code;if(c>=100&&199>=c)switch(this.state){case j.STATUS_CALLING:this.stateChanged(j.STATUS_PROCEEDING),this.request_sender.receiveResponse(a);break;case j.STATUS_PROCEEDING:this.request_sender.receiveResponse(a)}else if(c>=200&&299>=c)switch(this.state){case j.STATUS_CALLING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_ACCEPTED),this.M=setTimeout(function(){b.timer_M()},r.TIMER_M),this.request_sender.receiveResponse(a);break;case j.STATUS_ACCEPTED:this.request_sender.receiveResponse(a)}else if(c>=300&&699>=c)switch(this.state){case j.STATUS_CALLING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),this.sendACK(a),this.request_sender.receiveResponse(a);break;case j.STATUS_COMPLETED:this.sendACK(a)}},f.prototype=new q,f.prototype.send=function(){this.transport.send(this.request)||this.onTransportError()},f.prototype.onTransportError=function(){m("transport error occurred for transaction "+this.id),this.request_sender.onTransportError()},g.prototype=new q,g.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged",this)},g.prototype.timer_J=function(){n("Timer J expired for transaction "+this.id),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this)},g.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,n("transport error occurred, deleting transaction "+this.id),clearTimeout(this.J),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},g.prototype.receiveResponse=function(a,b,c,d){var e=this;if(100===a)switch(this.state){case j.STATUS_TRYING:this.stateChanged(j.STATUS_PROCEEDING),this.transport.send(b)||this.onTransportError();break;case j.STATUS_PROCEEDING:this.last_response=b,this.transport.send(b)?c&&c():(this.onTransportError(),d&&d())}else if(a>=200&&699>=a)switch(this.state){case j.STATUS_TRYING:case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_COMPLETED),this.last_response=b,this.J=setTimeout(function(){e.timer_J()},r.TIMER_J),this.transport.send(b)?c&&c():(this.onTransportError(),d&&d());break;case j.STATUS_COMPLETED:}},h.prototype=new q,h.prototype.stateChanged=function(a){this.state=a,this.emit("stateChanged",this)},h.prototype.timer_H=function(){o("Timer H expired for transaction "+this.id),this.state===j.STATUS_COMPLETED&&o("ACK not received, dialog will be terminated"),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this)},h.prototype.timer_I=function(){this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this)},h.prototype.timer_L=function(){o("Timer L expired for transaction "+this.id),this.state===j.STATUS_ACCEPTED&&(this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},h.prototype.onTransportError=function(){this.transportError||(this.transportError=!0,o("transport error occurred, deleting transaction "+this.id),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(j.STATUS_TERMINATED),this.ua.destroyTransaction(this))},h.prototype.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},h.prototype.receiveResponse=function(a,b,c,d){var e=this;if(a>=100&&199>=a)switch(this.state){case j.STATUS_PROCEEDING:this.transport.send(b)||this.onTransportError(),this.last_response=b}if(a>100&&199>=a&&this.state===j.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){e.resend_provisional()},r.PROVISIONAL_RESPONSE_INTERVAL));else if(a>=200&&299>=a)switch(this.state){case j.STATUS_PROCEEDING:this.stateChanged(j.STATUS_ACCEPTED),this.last_response=b,this.L=setTimeout(function(){e.timer_L()},r.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case j.STATUS_ACCEPTED:this.transport.send(b)?c&&c():(this.onTransportError(),d&&d())}else if(a>=300&&699>=a)switch(this.state){case j.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(b)?(this.stateChanged(j.STATUS_COMPLETED),this.H=setTimeout(function(){e.timer_H()},r.TIMER_H),c&&c()):(this.onTransportError(),d&&d())}}},{"./Constants":10,"./EventEmitter":14,"./Timers":28,debug:1}],30:[function(a,b,c){function d(a,b){this.ua=a,this.ws=null,this.server=b,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.node_ws_options=this.ua.configuration.node_ws_options,this.node_ws_options.headers={"User-Agent":g.USER_AGENT}}b.exports=d;var e={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};d.C=e;var f=a("debug")("JsSIP:Transport"),g=a("./Constants"),h=a("./Parser"),i=a("./UA"),j=a("./SIPMessage"),k=a("./sanityCheck"),l=a("ws");d.prototype={connect:function(){var a=this;if(this.ws&&(this.ws.readyState===this.ws.OPEN||this.ws.readyState===this.ws.CONNECTING))return f("WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close(),f("connecting to WebSocket "+this.server.ws_uri),this.ua.onTransportConnecting(this,0===this.reconnection_attempts?1:this.reconnection_attempts);try{this.ws=new l(this.server.ws_uri,"sip",this.node_ws_options),this.ws.binaryType="arraybuffer",this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(b){a.onClose(b)},this.ws.onmessage=function(b){a.onMessage(b)},this.ws.onerror=function(b){a.onError(b)}}catch(b){f("error connecting to WebSocket "+this.server.ws_uri+": "+b),this.lastTransportError.code=null,this.lastTransportError.reason=b.message,this.ua.onTransportError(this)}},disconnect:function(){this.ws&&(clearTimeout(this.reconnectTimer),this.closed=!0,f("closing WebSocket "+this.server.ws_uri),this.ws.close()),null!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},send:function(a){var b=a.toString();return this.ws&&this.ws.readyState===this.ws.OPEN?(f("sending WebSocket message:\n\n"+b+"\n"),this.ws.send(b),!0):(f("unable to send message, WebSocket is not open"),!1)},onOpen:function(){this.connected=!0,f("WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this)},onClose:function(a){var b=this.connected;this.connected=!1,this.lastTransportError.code=a.code,this.lastTransportError.reason=a.reason,f("WebSocket disconnected (code: "+a.code+(a.reason?"| reason: "+a.reason:"")+")"),a.wasClean===!1&&f("WebSocket abrupt disconnection"),b===!0?(this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):this.reConnect()):this.ua.onTransportError(this)},onMessage:function(a){var b,c,d=a.data;if("\r\n"===d)return void f("received WebSocket message with CRLF Keep Alive response");if("string"!=typeof d){try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(e){return void f("received WebSocket binary message failed to be converted into string, message discarded")}f("received WebSocket binary message:\n\n"+d+"\n")}else f("received WebSocket text message:\n\n"+d+"\n");if(b=h.parseMessage(d,this.ua),b&&!(this.ua.status===i.C.STATUS_USER_CLOSED&&b instanceof j.IncomingRequest)&&k(b,this.ua,this))if(b instanceof j.IncomingRequest)b.transport=this,this.ua.receiveRequest(b);else if(b instanceof j.IncomingResponse)switch(b.method){case g.INVITE:c=this.ua.transactions.ict[b.via_branch],c&&c.receiveResponse(b);break;case g.ACK:break;default:c=this.ua.transactions.nict[b.via_branch],c&&c.receiveResponse(b)}},onError:function(a){f("WebSocket connection error: "+a)},reConnect:function(){var a=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(f("maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(f("trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=setTimeout(function(){a.connect(),a.reconnectTimer=null},1e3*this.ua.configuration.ws_server_reconnection_timeout))}}},{"./Constants":10,"./Parser":20,"./SIPMessage":27,"./UA":31,"./sanityCheck":35,debug:1,ws:8}],31:[function(a,b,c){function d(a){var b=["connecting","connected","disconnected","newTransaction","transactionDestroyed","registered","unregistered","registrationFailed","newRTCSession","newMessage","mediaPermissionsRequest","mediaPermissionsAccept","mediaPermissionsRefuse"];if(this.cache={credentials:{}},this.configuration={},this.dynConfiguration={},this.dialogs={},this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=e.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.data={},this.transportRecoverAttempts=0,this.transportRecoveryTimer=null,Object.defineProperties(this,{transactionsCount:{get:function(){var a,b=["nist","nict","ist","ict"],c=0;for(a in b)c+=Object.keys(this.transactions[b[a]]).length;return c}},nictTransactionsCount:{get:function(){return Object.keys(this.transactions.nict).length}},nistTransactionsCount:{get:function(){return Object.keys(this.transactions.nist).length}},ictTransactionsCount:{get:function(){return Object.keys(this.transactions.ict).length}},istTransactionsCount:{get:function(){return Object.keys(this.transactions.ist).length}}}),void 0===a)throw new TypeError("Not enough arguments");try{this.loadConfig(a),this.initEvents(b)}catch(c){throw this.status=e.STATUS_NOT_READY,this.error=e.CONFIGURATION_ERROR,c}this._registrator=new i(this)}b.exports=d;var e={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};d.C=e;var f=a("debug")("JsSIP:UA"),g=a("./Constants"),h=a("./EventEmitter"),i=a("./Registrator"),j=a("./RTCSession"),k=a("./Message"),l=a("./Transport"),m=a("./Transactions"),m=a("./Transactions"),n=a("./Utils"),o=a("./WebRTC"),p=a("./Exceptions"),q=a("./URI"),r=a("./Grammar");d.prototype=new h,d.prototype.start=function(){var a;f("user requested startup"),this.status===e.STATUS_INIT?(a=this.getNextWsServer(),this.transport=new l(this,a),this.transport.connect()):this.status===e.STATUS_USER_CLOSED?(f("restarting UA"),this.status=e.STATUS_READY,this.transport.connect()):f(this.status===e.STATUS_READY?"UA is in READY status, not restarted":"ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this.dynConfiguration.register=this.configuration.register},d.prototype.register=function(){this.dynConfiguration.register=!0,this._registrator.register()},d.prototype.unregister=function(a){this.dynConfiguration.register=!1,this._registrator.unregister(a)},d.prototype.registrator=function(){return this._registrator},d.prototype.isRegistered=function(){return this._registrator.registered?!0:!1},d.prototype.isConnected=function(){return this.transport?this.transport.connected:!1},d.prototype.call=function(a,b){var c;c=new j(this),c.connect(a,b)},d.prototype.sendMessage=function(a,b,c){var d;d=new k(this),d.send(a,b,c)},d.prototype.stop=function(){var a,b,c,d=this;if(f("user requested closure"),this.dynConfiguration={},this.status===e.STATUS_USER_CLOSED)return void f("UA already closed");clearTimeout(this.transportRecoveryTimer),this._registrator.close(),c=Object.keys(this.sessions).length;for(a in this.sessions)f("closing session "+a),this.sessions[a].terminate();for(b in this.applicants)this.applicants[b].close();this.status=e.STATUS_USER_CLOSED,0===this.nistTransactionsCount&&0===this.nictTransactionsCount&&0===c?d.transport.disconnect():setTimeout(function(){d.transport.disconnect()},2e3)},d.prototype.normalizeTarget=function(a){return n.normalizeTarget(a,this.configuration.hostport_params)},d.prototype.saveCredentials=function(a){this.cache.credentials[a.realm]=this.cache.credentials[a.realm]||{},this.cache.credentials[a.realm][a.uri]=a},d.prototype.getCredentials=function(a){var b,c;return b=a.ruri.host,this.cache.credentials[b]&&this.cache.credentials[b][a.ruri]&&(c=this.cache.credentials[b][a.ruri],c.method=a.method),c},d.prototype.onTransportClosed=function(a){var b,c,d,e=["nict","ict","nist","ist"];for(a.server.status=l.C.STATUS_DISCONNECTED,f("connection state set to "+l.C.STATUS_DISCONNECTED),d=e.length,b=0;d>b;b++)for(c in this.transactions[e[b]])this.transactions[e[b]][c].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()},d.prototype.onTransportError=function(a){var b;f("transport "+a.server.ws_uri+" failed | connection state set to "+l.C.STATUS_ERROR),a.server.status=l.C.STATUS_ERROR,this.emit("disconnected",this,{transport:a,code:a.lastTransportError.code,reason:a.lastTransportError.reason}),this.status!==e.STATUS_USER_CLOSED&&(b=this.getNextWsServer(),b?(this.transport=new l(this,b),this.transport.connect()):(this.closeSessionsOnTransportError(),this.error&&this.error===e.NETWORK_ERROR||(this.status=e.STATUS_NOT_READY,this.error=e.NETWORK_ERROR),this.recoverTransport()))},d.prototype.onTransportConnected=function(a){this.transport=a,this.transportRecoverAttempts=0,a.server.status=l.C.STATUS_READY,f("connection state set to "+l.C.STATUS_READY),this.status!==e.STATUS_USER_CLOSED&&(this.status=e.STATUS_READY,this.error=null,this.emit("connected",this,{transport:a}),this.dynConfiguration.register&&this._registrator.register())},d.prototype.onTransportConnecting=function(a,b){this.emit("connecting",this,{transport:a,attempts:b})},d.prototype.newTransaction=function(a){this.transactions[a.type][a.id]=a,this.emit("newTransaction",this,{transaction:a})},d.prototype.destroyTransaction=function(a){delete this.transactions[a.type][a.id],this.emit("transactionDestroyed",this,{transaction:a})},d.prototype.receiveRequest=function(a){var b,c,d,e=a.method;if(a.ruri.user!==this.configuration.uri.user&&a.ruri.user!==this.contact.uri.user)return f("Request-URI does not point to us"),void(a.method!==g.ACK&&a.reply_sl(404));if(a.ruri.scheme===g.SIPS)return void a.reply_sl(416);if(!m.checkTransaction(this,a)){if(e===g.INVITE?new m.InviteServerTransaction(a,this):e!==g.ACK&&e!==g.CANCEL&&new m.NonInviteServerTransaction(a,this),e===g.OPTIONS)a.reply(200);else if(e===g.MESSAGE){if(!this.checkEvent("newMessage")||0===this.listeners("newMessage").length)return void a.reply(405);d=new k(this),d.init_incoming(a)}else if(e===g.INVITE&&(!this.checkEvent("newRTCSession")||0===this.listeners("newRTCSession").length))return void a.reply(405);if(a.to_tag)b=this.findDialog(a),b?b.receiveRequest(a):e===g.NOTIFY?(c=this.findSession(a),c?c.receiveRequest(a):(f("received NOTIFY request for a non existent subscription"),a.reply(481,"Subscription does not exist"))):e!==g.ACK&&a.reply(481);else switch(e){case g.INVITE:o.isSupported?(c=new j(this),c.init_incoming(a)):(f("INVITE received but WebRTC is not supported"),a.reply(488));break;case g.BYE:a.reply(481);break;case g.CANCEL:c=this.findSession(a),c?c.receiveRequest(a):f("received CANCEL request for a non existent session");break;case g.ACK:break;default:a.reply(405)}}},d.prototype.findSession=function(a){var b=a.call_id+a.from_tag,c=this.sessions[b],d=a.call_id+a.to_tag,e=this.sessions[d];return c?c:e?e:null},d.prototype.findDialog=function(a){var b=a.call_id+a.from_tag+a.to_tag,c=this.dialogs[b];return c?c:(b=a.call_id+a.to_tag+a.from_tag,c=this.dialogs[b],c?c:null)},d.prototype.getNextWsServer=function(){var a,b,c,d=[];for(b=this.configuration.ws_servers.length,a=0;b>a;a++)c=this.configuration.ws_servers[a],c.status!==l.C.STATUS_ERROR&&(0===d.length?d.push(c):c.weight>d[0].weight?d=[c]:c.weight===d[0].weight&&d.push(c));return a=Math.floor(Math.random()*d.length),d[a]},d.prototype.closeSessionsOnTransportError=function(){var a;for(a in this.sessions)this.sessions[a].onTransportError();this._registrator.onTransportClosed()},d.prototype.recoverTransport=function(a){var b,c,d,e,g,h;for(a=a||this,g=a.transportRecoverAttempts,c=a.configuration.ws_servers.length,b=0;c>b;b++)a.configuration.ws_servers[b].status=0;h=a.getNextWsServer(),d=Math.floor(Math.random()*Math.pow(2,g)+1),e=d*a.configuration.connection_recovery_min_interval,e>a.configuration.connection_recovery_max_interval&&(f("time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),e=a.configuration.connection_recovery_min_interval,g=0),f("next connection attempt in "+e+" seconds"),this.transportRecoveryTimer=setTimeout(function(){a.transportRecoverAttempts=g+1,a.transport=new l(a,h),a.transport.connect()},1e3*e)},d.prototype.loadConfig=function(a){var b,c,e,g,h,i={via_host:n.createRandomToken(12)+".invalid",password:null,register_expires:600,register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:!1,no_answer_timeout:60,stun_servers:["stun:stun.l.google.com:19302"],turn_servers:[],hack_via_tcp:!1,hack_via_ws:!1,hack_ip_in_contact:!1,node_ws_options:{}};for(b in d.configuration_check.mandatory){if(!a.hasOwnProperty(b))throw new p.ConfigurationError(b);if(c=a[b],e=d.configuration_check.mandatory[b].call(this,c),void 0===e)throw new p.ConfigurationError(b,c);i[b]=e}for(b in d.configuration_check.optional)if(a.hasOwnProperty(b)){if(c=a[b],n.isEmpty(c))continue;if(e=d.configuration_check.optional[b].call(this,c),void 0===e)throw new p.ConfigurationError(b,c);i[b]=e}if(i.connection_recovery_max_interval<i.connection_recovery_min_interval)throw new p.ConfigurationError("connection_recovery_max_interval",i.connection_recovery_max_interval);0===i.display_name&&(i.display_name="0"),i.instance_id||(i.instance_id=n.newUUID()),i.jssip_id=n.createRandomToken(5),g=i.uri.clone(),g.user=null,i.hostport_params=g.toString().replace(/^sip:/i,""),i.authorization_user||(i.authorization_user=i.uri.user),i.registrar_server||(h=i.uri.clone(),h.user=null,i.registrar_server=h),i.no_answer_timeout=1e3*i.no_answer_timeout,i.hack_ip_in_contact&&(i.via_host=n.getRandomTestNetIP()),c=a.stun_servers,c instanceof Array&&0===c.length&&(i.stun_servers=[]),this.contact={pub_gruu:null,temp_gruu:null,uri:new q("sip",i.uri.user,i.via_host,null,{transport:"ws"}),toString:function(a){a=a||{};var b=a.anonymous||null,c=a.outbound||null,d="<";return d+=b?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!c||(b?this.temp_gruu:this.pub_gruu)||(d+=";ob"),d+=">"}};for(b in i)d.configuration_skeleton[b].value=i[b];Object.defineProperties(this.configuration,d.configuration_skeleton);for(b in i)d.configuration_skeleton[b].value="";f("configuration parameters after validation:");for(b in i)switch(b){case"uri":case"registrar_server":f("- "+b+": "+i[b]);break;case"password":f("- "+b+": NOT SHOWN");break;default:f("- "+b+": "+JSON.stringify(i[b]))}},d.configuration_skeleton=function(){var a,b,c={},d=["jssip_id","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","ws_servers","authorization_user","connection_recovery_max_interval","connection_recovery_min_interval","display_name","hack_via_tcp","hack_via_ws","hack_ip_in_contact","instance_id","no_answer_timeout","node_ws_options","password","register_expires","registrar_server","stun_servers","turn_servers","use_preloaded_route","via_core_value","via_host"];for(a in d)b=d[a],c[b]={value:"",writable:!1,configurable:!1};return c.register={value:"",writable:!0,configurable:!1},c}(),d.configuration_check={mandatory:{uri:function(a){var b;return/^sip:/i.test(a)||(a=g.SIP+":"+a),b=q.parse(a),b&&b.user?b:void 0},ws_servers:function(a){var b,c,d;if("string"==typeof a)a=[{ws_uri:a}];else{if(!(a instanceof Array))return;for(c=a.length,b=0;c>b;b++)"string"==typeof a[b]&&(a[b]={ws_uri:a[b]})}if(0===a.length)return!1;for(c=a.length,b=0;c>b;b++){if(!a[b].ws_uri)return void f('ERROR: missing "ws_uri" attribute in ws_servers parameter');if(a[b].weight&&!Number(a[b].weight))return void f('ERROR: "weight" attribute in ws_servers parameter must be a Number');if(d=r.parse(a[b].ws_uri,"absoluteURI"),-1===d)return void f('ERROR: invalid "ws_uri" attribute in ws_servers parameter: '+a[b].ws_uri);if("wss"!==d.scheme&&"ws"!==d.scheme)return void f("ERROR: invalid URI scheme in ws_servers parameter: "+d.scheme);a[b].sip_uri="<sip:"+d.host+(d.port?":"+d.port:"")+";transport=ws;lr>",a[b].weight||(a[b].weight=0),a[b].status=0,a[b].scheme=d.scheme.toUpperCase()}return a}},optional:{authorization_user:function(a){return-1===r.parse('"'+a+'"',"quoted_string")?void 0:a},connection_recovery_max_interval:function(a){var b;return n.isDecimal(a)&&(b=Number(a),b>0)?b:void 0},connection_recovery_min_interval:function(a){var b;return n.isDecimal(a)&&(b=Number(a),b>0)?b:void 0},display_name:function(a){return-1===r.parse('"'+a+'"',"display_name")?void 0:a},hack_via_tcp:function(a){return"boolean"==typeof a?a:void 0},hack_via_ws:function(a){return"boolean"==typeof a?a:void 0},hack_ip_in_contact:function(a){return"boolean"==typeof a?a:void 0},instance_id:function(a){return/^uuid:/i.test(a)&&(a=a.substr(5)),-1===r.parse(a,"uuid")?void 0:a},no_answer_timeout:function(a){var b;return n.isDecimal(a)&&(b=Number(a),b>0)?b:void 0},node_ws_options:function(a){return"object"==typeof a?a:{}},password:function(a){return String(a)},register:function(a){return"boolean"==typeof a?a:void 0},register_expires:function(a){var b;return n.isDecimal(a)&&(b=Number(a),b>0)?b:void 0},registrar_server:function(a){var b;return/^sip:/i.test(a)||(a=g.SIP+":"+a),b=q.parse(a),b?b.user?void 0:b:void 0},stun_servers:function(a){var b,c,d;if("string"==typeof a)a=[a];else if(!(a instanceof Array))return;for(c=a.length,b=0;c>b;b++){if(d=a[b],/^stuns?:/.test(d)||(d="stun:"+d),-1===r.parse(d,"stun_URI"))return;a[b]=d}return a},turn_servers:function(a){var b,c,d,e,f,g;for(!a instanceof Array&&(a=[a]),d=a.length,b=0;d>b;b++){if(f=a[b],f.server&&(f.urls=[f.server]),f.password&&(f.credential=[f.password]),!f.urls||!f.username||!f.credential)return;for(f.urls instanceof Array||(f.urls=[f.urls]),e=f.urls.length,c=0;e>c;c++)if(g=f.urls[c],/^turns?:/.test(g)||(g="turn:"+g),-1===r.parse(g,"turn_URI"))return}return a},use_preloaded_route:function(a){return"boolean"==typeof a?a:void 0}}}},{"./Constants":10,"./EventEmitter":14,"./Exceptions":15,"./Grammar":16,"./Message":18,"./RTCSession":21,"./Registrator":25,"./Transactions":29,"./Transport":30,"./URI":32,"./Utils":33,"./WebRTC":34,debug:1}],32:[function(a,b,c){function d(a,b,c,d,f,g){var h,i;if(!c)throw new TypeError('missing or invalid "host" parameter');a=a||e.SIP,this.parameters={},this.headers={};for(h in f)this.setParam(h,f[h]);for(i in g)this.setHeader(i,g[i]);Object.defineProperties(this,{scheme:{get:function(){return a},set:function(b){a=b.toLowerCase()}},user:{get:function(){return b},set:function(a){b=a}},host:{get:function(){return c},set:function(a){c=a.toLowerCase()}},port:{get:function(){return d},set:function(a){d=0===a?a:parseInt(a,10)||null}}})}b.exports=d;var e=a("./Constants"),f=a("./Utils"),g=a("./Grammar");d.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]="undefined"==typeof b||null===b?null:b.toString().toLowerCase())},getParam:function(a){return a?this.parameters[a.toLowerCase()]:void 0},hasParam:function(a){return a?this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1:void 0},deleteParam:function(a){var b;return a=a.toLowerCase(),this.parameters.hasOwnProperty(a)?(b=this.parameters[a],delete this.parameters[a],b):void 0},clearParams:function(){this.parameters={};
},setHeader:function(a,b){this.headers[f.headerize(a)]=b instanceof Array?b:[b]},getHeader:function(a){return a?this.headers[f.headerize(a)]:void 0},hasHeader:function(a){return a?this.headers.hasOwnProperty(f.headerize(a))&&!0||!1:void 0},deleteHeader:function(a){var b;return a=f.headerize(a),this.headers.hasOwnProperty(a)?(b=this.headers[a],delete this.headers[a],b):void 0},clearHeaders:function(){this.headers={}},clone:function(){return new d(this.scheme,this.user,this.host,this.port,JSON.parse(JSON.stringify(this.parameters)),JSON.parse(JSON.stringify(this.headers)))},toString:function(){var a,b,c,d,e=[];d=this.scheme+":",this.user&&(d+=f.escapeUser(this.user)+"@"),d+=this.host,(this.port||0===this.port)&&(d+=":"+this.port);for(b in this.parameters)d+=";"+b,null!==this.parameters[b]&&(d+="="+this.parameters[b]);for(a in this.headers)for(c in this.headers[a])e.push(a+"="+this.headers[a][c]);return e.length>0&&(d+="?"+e.join("&")),d},toAor:function(a){var b;return b=this.scheme+":",this.user&&(b+=f.escapeUser(this.user)+"@"),b+=this.host,a&&(this.port||0===this.port)&&(b+=":"+this.port),b}},d.parse=function(a){return a=g.parse(a,"SIP_URI"),-1!==a?a:void 0}},{"./Constants":10,"./Grammar":16,"./Utils":33}],33:[function(a,b,c){var d={};b.exports=d;var e=a("./Constants"),f=a("./URI"),g=a("./Grammar");d.str_utf8_length=function(a){return unescape(encodeURIComponent(a)).length},d.isFunction=function(a){return void 0!==a&&"[object Function]"===Object.prototype.toString.call(a)?!0:!1},d.isDecimal=function(a){return!isNaN(a)&&parseFloat(a)===parseInt(a,10)},d.isEmpty=function(a){return null===a||""===a||void 0===a||a instanceof Array&&0===a.length||"number"==typeof a&&isNaN(a)?!0:void 0},d.createRandomToken=function(a,b){var c,d,e="";for(b=b||32,c=0;a>c;c++)d=Math.random()*b|0,e+=d.toString(b);return e},d.newTag=function(){return d.createRandomToken(10)},d.newUUID=function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)});return a},d.hostType=function(a){return a?(a=g.parse(a,"host"),-1!==a?a.host_type:void 0):void 0},d.normalizeTarget=function(a,b){var c,g,h,i;if(a){if(a instanceof f)return a;if("string"==typeof a){switch(g=a.split("@"),g.length){case 1:if(!b)return;h=a,i=b;break;case 2:h=g[0],i=g[1];break;default:h=g.slice(0,g.length-1).join("@"),i=g[g.length-1]}return h=h.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(h)&&(h=h.replace(/[\-\.\(\)]/g,"")),a=e.SIP+":"+d.escapeUser(h)+"@"+i,(c=f.parse(a))?c:void 0}}else;},d.escapeUser=function(a){return encodeURIComponent(decodeURIComponent(a)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},d.headerize=function(a){var b,c={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},d=a.toLowerCase().replace(/_/g,"-").split("-"),e="",f=d.length;for(b=0;f>b;b++)0!==b&&(e+="-"),e+=d[b].charAt(0).toUpperCase()+d[b].substring(1);return c[e]&&(e=c[e]),e},d.sipErrorCause=function(a){var b;for(b in e.SIP_ERROR_CAUSES)if(-1!==e.SIP_ERROR_CAUSES[b].indexOf(a))return e.causes[b];return e.causes.SIP_FAILURE_CODE},d.getRandomTestNetIP=function(){function a(a,b){return Math.floor(Math.random()*(b-a+1)+a)}return"192.0.2."+a(1,254)},d.calculateMD5=function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){for(var b,c=a.length,d=c+8,e=(d-d%64)/64,f=16*(e+1),g=new Array(f-1),h=0,i=0;c>i;)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b,c,d="",e="";for(c=0;3>=c;c++)b=a>>>8*c&255,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d}function n(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var o,p,q,r,s,t,u,v,w,x=[],y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;for(a=n(a),x=l(a),t=1732584193,u=4023233417,v=2562383102,w=271733878,o=0;o<x.length;o+=16)p=t,q=u,r=v,s=w,t=h(t,u,v,w,x[o+0],y,3614090360),w=h(w,t,u,v,x[o+1],z,3905402710),v=h(v,w,t,u,x[o+2],A,606105819),u=h(u,v,w,t,x[o+3],B,3250441966),t=h(t,u,v,w,x[o+4],y,4118548399),w=h(w,t,u,v,x[o+5],z,1200080426),v=h(v,w,t,u,x[o+6],A,2821735955),u=h(u,v,w,t,x[o+7],B,4249261313),t=h(t,u,v,w,x[o+8],y,1770035416),w=h(w,t,u,v,x[o+9],z,2336552879),v=h(v,w,t,u,x[o+10],A,4294925233),u=h(u,v,w,t,x[o+11],B,2304563134),t=h(t,u,v,w,x[o+12],y,1804603682),w=h(w,t,u,v,x[o+13],z,4254626195),v=h(v,w,t,u,x[o+14],A,2792965006),u=h(u,v,w,t,x[o+15],B,1236535329),t=i(t,u,v,w,x[o+1],C,4129170786),w=i(w,t,u,v,x[o+6],D,3225465664),v=i(v,w,t,u,x[o+11],E,643717713),u=i(u,v,w,t,x[o+0],F,3921069994),t=i(t,u,v,w,x[o+5],C,3593408605),w=i(w,t,u,v,x[o+10],D,38016083),v=i(v,w,t,u,x[o+15],E,3634488961),u=i(u,v,w,t,x[o+4],F,3889429448),t=i(t,u,v,w,x[o+9],C,568446438),w=i(w,t,u,v,x[o+14],D,3275163606),v=i(v,w,t,u,x[o+3],E,4107603335),u=i(u,v,w,t,x[o+8],F,1163531501),t=i(t,u,v,w,x[o+13],C,2850285829),w=i(w,t,u,v,x[o+2],D,4243563512),v=i(v,w,t,u,x[o+7],E,1735328473),u=i(u,v,w,t,x[o+12],F,2368359562),t=j(t,u,v,w,x[o+5],G,4294588738),w=j(w,t,u,v,x[o+8],H,2272392833),v=j(v,w,t,u,x[o+11],I,1839030562),u=j(u,v,w,t,x[o+14],J,4259657740),t=j(t,u,v,w,x[o+1],G,2763975236),w=j(w,t,u,v,x[o+4],H,1272893353),v=j(v,w,t,u,x[o+7],I,4139469664),u=j(u,v,w,t,x[o+10],J,3200236656),t=j(t,u,v,w,x[o+13],G,681279174),w=j(w,t,u,v,x[o+0],H,3936430074),v=j(v,w,t,u,x[o+3],I,3572445317),u=j(u,v,w,t,x[o+6],J,76029189),t=j(t,u,v,w,x[o+9],G,3654602809),w=j(w,t,u,v,x[o+12],H,3873151461),v=j(v,w,t,u,x[o+15],I,530742520),u=j(u,v,w,t,x[o+2],J,3299628645),t=k(t,u,v,w,x[o+0],K,4096336452),w=k(w,t,u,v,x[o+7],L,1126891415),v=k(v,w,t,u,x[o+14],M,2878612391),u=k(u,v,w,t,x[o+5],N,4237533241),t=k(t,u,v,w,x[o+12],K,1700485571),w=k(w,t,u,v,x[o+3],L,2399980690),v=k(v,w,t,u,x[o+10],M,4293915773),u=k(u,v,w,t,x[o+1],N,2240044497),t=k(t,u,v,w,x[o+8],K,1873313359),w=k(w,t,u,v,x[o+15],L,4264355552),v=k(v,w,t,u,x[o+6],M,2734768916),u=k(u,v,w,t,x[o+13],N,1309151649),t=k(t,u,v,w,x[o+4],K,4149444226),w=k(w,t,u,v,x[o+11],L,3174756917),v=k(v,w,t,u,x[o+2],M,718787259),u=k(u,v,w,t,x[o+9],N,3951481745),t=c(t,p),u=c(u,q),v=c(v,r),w=c(w,s);var O=m(t)+m(u)+m(v)+m(w);return O.toLowerCase()}},{"./Constants":10,"./Grammar":16,"./URI":32}],34:[function(a,b,c){var d={};b.exports=d,"undefined"!=typeof navigator&&navigator.webkitGetUserMedia?d.getUserMedia=navigator.webkitGetUserMedia.bind(navigator):"undefined"!=typeof navigator&&navigator.mozGetUserMedia?d.getUserMedia=navigator.mozGetUserMedia.bind(navigator):"undefined"!=typeof navigator&&navigator.getUserMedia&&(d.getUserMedia=navigator.getUserMedia.bind(navigator)),"undefined"!=typeof webkitRTCPeerConnection?d.RTCPeerConnection=webkitRTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?d.RTCPeerConnection=mozRTCPeerConnection:"undefined"!=typeof RTCPeerConnection&&(d.RTCPeerConnection=RTCPeerConnection),"undefined"!=typeof webkitRTCSessionDescription?d.RTCSessionDescription=webkitRTCSessionDescription:"undefined"!=typeof mozRTCSessionDescription?d.RTCSessionDescription=mozRTCSessionDescription:"undefined"!=typeof RTCSessionDescription&&(d.RTCSessionDescription=RTCSessionDescription),d.RTCPeerConnection&&d.RTCPeerConnection.prototype&&(d.RTCPeerConnection.prototype.getLocalStreams||(d.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},d.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})),d.getUserMedia&&d.RTCPeerConnection&&d.RTCSessionDescription?d.isSupported=!0:d.isSupported=!1},{}],35:[function(a,b,c){function d(a,b,c){var d,e;for(m=a,n=b,o=c,d=v.length;d--;)if(e=v[d](m),e===!1)return!1;if(m instanceof r.IncomingRequest){for(d=t.length;d--;)if(e=t[d](m),e===!1)return!1}else if(m instanceof r.IncomingResponse)for(d=u.length;d--;)if(e=u[d](m),e===!1)return!1;return!0}function e(){return"sip"!==m.s("to").uri.scheme?(l(416),!1):void 0}function f(){return m.to_tag||m.call_id.substr(0,5)!==n.configuration.jssip_id?void 0:(l(482),!1)}function g(){var a=s.str_utf8_length(m.body),b=m.getHeader("content-length");return b>a?(l(400),!1):void 0}function h(){var a,b,c=m.from_tag,d=m.call_id,e=m.cseq;if(!m.to_tag)if(m.method===q.INVITE){if(n.transactions.ist[m.via_branch])return!1;for(b in n.transactions.ist)if(a=n.transactions.ist[b],a.request.from_tag===c&&a.request.call_id===d&&a.request.cseq===e)return l(482),!1}else{if(n.transactions.nist[m.via_branch])return!1;for(b in n.transactions.nist)if(a=n.transactions.nist[b],a.request.from_tag===c&&a.request.call_id===d&&a.request.cseq===e)return l(482),!1}}function i(){return m.getHeaders("via").length>1?(p("more than one Via header field present in the response, dropping the response"),!1):void 0}function j(){var a=s.str_utf8_length(m.body),b=m.getHeader("content-length");return b>a?(p("message body length is lower than the value in Content-Length header field, dropping the response"),!1):void 0}function k(){for(var a=["from","to","call_id","cseq","via"],b=a.length;b--;)if(!m.hasHeader(a[b]))return p("missing mandatory header field : "+a[b]+", dropping the response"),!1}function l(a){var b,c="SIP/2.0 "+a+" "+q.REASON_PHRASE[a]+"\r\n",d=m.getHeaders("via"),e=d.length,f=0;for(f;e>f;f++)c+="Via: "+d[f]+"\r\n";b=m.getHeader("To"),m.to_tag||(b+=";tag="+s.newTag()),c+="To: "+b+"\r\n",c+="From: "+m.getHeader("From")+"\r\n",c+="Call-ID: "+m.call_id+"\r\n",c+="CSeq: "+m.cseq+" "+m.method+"\r\n",c+="\r\n",o.send(c)}b.exports=d;var m,n,o,p=a("debug")("JsSIP:sanityCheck"),q=a("./Constants"),r=a("./SIPMessage"),s=a("./Utils"),t=[],u=[],v=[];t.push(e),t.push(f),t.push(g),t.push(h),u.push(i),u.push(j),v.push(k)},{"./Constants":10,"./SIPMessage":27,"./Utils":33,debug:1}]},{},[17])(17)});var __slice=[].slice,__hasProp={}.hasOwnProperty;window.oktellVoice=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(b=!1,g=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],b?(a.unshift("Oktell-Voice.js |"),console.log.apply(console,a)):void 0},c=/\s+/,d={on:function(a,b,d){var e,f,g,h,i;if(!a||"function"!=typeof b)return!1;for(a=a.split(c),e=this.__eventCallbacks||(this.__eventCallbacks={}),h=0,i=a.length;i>h;h++)f=a[h],g=e[f]||(e[f]=[]),g.push({fn:b,context:d});return!0},off:function(a,b){var d,e,f,g,h,i,j,k,l,m,n;if(null==a)this.__eventCallbacks={};else if(d=this.__eventCallbacks||(this.__eventCallbacks={}),a=a.split(c),null==b)for(i=0,l=a.length;l>i;i++)e=a[i],delete d[e];else for(j=0,m=a.length;m>j;j++)for(e=a[j],g=d[e]||(d[e]=[]),h=k=0,n=g.length;n>k;h=++k)f=g[h],f.fn===b&&(g[h]=!1);return!0},trigger:function(){var a,b,d,e,f,g,h,i,j,k,l;if(g=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],!g)return!1;for(g=g.split(c),b=this.__eventCallbacks||(this.__eventCallbacks={}),l=[],h=0,j=g.length;j>h;h++){for(d=g[h],e=b[d]||(b[d]=[]),i=0,k=e.length;k>i;i++)f=e[i],null!=f.fn&&f.fn.apply(f.context||window,a);a.unshift(d),l.push(function(){var c,d,e,g;for(e=b.all||[],g=[],c=0,d=e.length;d>c;c++)f=e[c],null!=f.fn?g.push(f.fn.apply(f.context||window,a)):g.push(void 0);return g}())}return l}},e=function(){var a,b,c,d,e,f,g,h;for(d=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],b=f=g=a.length-1;0>=g?0>=f:f>=0;b=0>=g?++f:--f)if("object"==typeof a[b]){h=a[b];for(c in h)__hasProp.call(h,c)&&(e=h[c],d[c]=e)}return d},j=!1,i={isOktellVoice:!0,getUserMediaStream:function(){return j},isSupported:function(){var a,b,c,d,e,f;return a=Boolean(navigator.userAgent.match(/Chrome\/[0-9\.]+? Safari\/[0-9\.]+$/)),d=parseInt(null!=(e=navigator.userAgent.match(/Chrome\/[0-9\.]+? YaBrowser\/([0-9]+)/))?e[1]:void 0)>=14,c=parseInt(null!=(f=navigator.userAgent.match(/Chrome\/[0-9\.]+? Safari\/[0-9\.]+ OPR\/([0-9]+)/))?f[1]:void 0)>=20,b=Boolean(navigator.userAgent.match(/Firefox\/[0-9\.]+/)),a||d||c||b}},e(i,d),a=function(){function a(a,b,c,d){var e=this;this.id="",this.connected=!1,this.login=a,this.pass=b||"",this.server=null!=c?c.split(":")[0]:void 0,this.port=(null!=c?c.split(":")[1]:void 0)||"5060",this.useWSS=d,this.name="JsSIP account",this.currentSession=!1,this.connectedFired=!1,this.sip&&this.login&&this.server&&this.port&&(this.constructed=!0),this.on("all",function(){var a,b;return b=arguments[0],a=2<=arguments.length?__slice.call(arguments,1):[],g("EVENT "+b+" on "+e.getName(),a)})}return a.prototype.sip=window.JsSIP,a.prototype.getName=function(){return this.name+" #"+this.id},a.prototype.isConnected=function(){return this.connected},a.prototype.createFantomAbonent=function(a){var b,c;return c="string"==typeof a||"number"==typeof a?a:a.getRemoteFriendlyName(),b=[{phone:c.toString(),name:c.toString()}]},a.prototype.createAudioElements=function(){return this.elLocal=document.createElement("audio"),this.elRemote=document.createElement("audio"),this.elLocalId="oktellVoice_jssip_local_"+Date.now(),this.elRemoteId="oktellVoice_jssip_remote_"+Date.now(),this.elLocal.setAttribute("id",this.elLocalId),this.elRemote.setAttribute("id",this.elRemoteId),document.body.appendChild(this.elLocal),document.body.appendChild(this.elRemote)},a.prototype.connect=function(){var a,c=this;return this.constructed?(g(this.getName()+" connect",arguments),this.elLocal||this.createAudioElements(),a={ws_servers:(this.useWSS?"wss":"ws")+"://"+this.server+":"+this.port,uri:"sip:"+this.login+"@"+this.server,password:this.pass,via_host:this.server},b?JsSIP.debug.enable("JsSIP:*"):JsSIP.debug.disable("JsSIP:*"),this.UA=new this.sip.UA(a),b&&(window.sipua=this.UA),this.UA.on("connected",function(a){return g("connected",a),c.connected=!0,c.connectedFired?void 0:(c.connectedFired=!0,c.trigger("connect"))}),this.UA.on("disconnected",function(a){return c.connectedFired=!1,g("disconnected",a)}),this.UA.on("registered",function(a){return g("registered",a),c.connected=!0,c.connectedFired?void 0:(c.connectedFired=!0,c.trigger("connect"))}),this.UA.on("unregistered",function(a){return g("unregistered",a),c.connected=!1,c.UA.stop(),c.trigger("disconnect")}),this.UA.on("registrationFailed",function(a){return g("registration failed",a),c.connected=!1,c.UA.stop(),c.trigger("disconnect")}),this.UA.on("mediaPermissionsRequest",function(a){return g("media permissions request",a),c.trigger("mediaPermissionsRequest")}),this.UA.on("mediaPermissionsAccept",function(a){return g("media permissions accept",a),c.trigger("mediaPermissionsAccept")}),this.UA.on("mediaPermissionsRefuse",function(a){return g("media permissions refuse",a),c.trigger("mediaPermissionsRefuse")}),this.UA.on("newRTCSession",function(a){var b;return g("new RTC session",a),c.currentSession=a.data.session,b=function(a){var b,d,e,f,h,i;return g("currentSession started",a),c.trigger("RTCSessionStarted",null!=(b=c.currentSession.remote_identity)?b.display_name:void 0),"incoming"===(null!=(d=c.currentSession)?d.direction:void 0)&&c.trigger("ringStart",null!=(e=c.currentSession)&&null!=(f=e.remote_identity)?f.display_name:void 0,null!=(h=c.currentSession)&&null!=(i=h.remote_identity)&&"function"==typeof i.toString?i.toString():void 0),c.currentSession.getLocalStreams().length>0?(g("currentSession local stream > 0",c.currentSession.getRemoteStreams()[0].getAudioTracks()),c.elLocal.src=window.URL.createObjectURL(c.currentSession.getLocalStreams()[0])):g("currentSession local stream == 0"),c.currentSession.getRemoteStreams().length>0?(g("currentSession remote stream > 0",c.currentSession.getRemoteStreams()[0].getAudioTracks()),c.elRemote.src=window.URL.createObjectURL(c.currentSession.getRemoteStreams()[0]),c.elRemote.play()):g("currentSession remote stream == 0")},"incoming"===c.currentSession.direction?b():c.currentSession.on("confirmed",b),c.currentSession.on("progress",function(a){return g("currentSession progress",a)}),c.currentSession.on("failed",function(a){var b;return g("currentSession failed",a),c.trigger("RTCSessionFailed",null!=(b=c.currentSession.remote_identity)?b.display_name:void 0)}),c.currentSession.on("ended",function(a){var b;return g("currentSession ended"),c.trigger("RTCSessionEnded",null!=(b=c.currentSession.remote_identity)?b.display_name:void 0)}),c.currentSession.on("hold",function(a){return c.holdedSession=c.currentSession})}),this.UA.start()):(g.error("error while construct "+this.getName()),!1)},a.prototype.call=function(a){var b;return a&&this.connected?(g(this.getName()+" call",arguments),a=a.toString(),b={mediaConstraints:{audio:!0,video:!1}},this.UA.call(a,b)):!1},a.prototype.answer=function(){var a;return null!=(a=this.currentSession)&&"function"==typeof a.answer?a.answer({audio:!0,video:!1}):void 0},a.prototype.hangup=function(){var a;return null!=(a=this.currentSession)&&"function"==typeof a.terminate?a.terminate():void 0},a.prototype.reject=function(){var a;return null!=(a=this.currentSession)&&"function"==typeof a.terminate?a.terminate():void 0},a.prototype.hold=function(){var a;return null!=(a=this.currentSession)&&"function"==typeof a.hold?a.hold():void 0},a.prototype.isOnHold=function(){var a;return null!=(a=this.holdedSession)&&"function"==typeof a.isOnHold?a.isOnHold():void 0},a.prototype.resume=function(){var a;return null!=(a=this.holdedSession)&&"function"==typeof a.unhold?a.unhold():void 0},a.prototype.dtmf=function(a){var b;return null!=(b=this.currentSession)&&"function"==typeof b.sendDTMF?b.sendDTMF(a):void 0},a.prototype.transfer=function(a){var b;return a?null!=(b=this.currentSession)&&"function"==typeof b.transfer?b.transfer(a.toString()):void 0:!1},a.prototype.disconnect=function(){return this.UA.stop()},a}(),e(a.prototype,d),i.createUserMedia=function(a,b,c,d){var f,g,h,k;return null==d&&(d={}),j?"function"==typeof a?a(j):void 0:(h=!1,k=function(a){return h=!0,i.trigger("mediaPermissionsRefuse"),"function"==typeof b?b(a):void 0},g=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,f={mandatory:{googAutoGainControl:!1},optional:[]},i.isSupported()&&"function"==typeof g?(setTimeout(function(){return h?void 0:i.trigger("mediaPermissionsRequest")},500),g.call(navigator,{audio:e({},f,d),video:c},function(b){return h=!0,j=b,i.trigger("mediaPermissionsAccept"),"function"==typeof a?a(j):void 0},function(a){return k(a)})):(k(),!1))},h={accCount:0,currentAcc:null,defaultOptions:{debugMode:!1},exportFnNames:["call","answer","hangup","transfer","hold","isOnHold","resume","dtmf","reject","isConnected"],createExportAccount:function(a){var b,c,f,g,h;if(null==a)return!1;for(b={},h=this.exportFnNames,f=0,g=h.length;g>f;f++)c=h[f],null!=a[c]&&!function(){var d;return d=a[c],b[c]=function(){return d.apply(a,arguments)}}();return e(b,d),a.on("all",function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],b.trigger.apply(b,a)}),b},createAccount:function(c){var d;return c=e({},c||{},this.defaultOptions),b=Boolean(c.debugMode),d=new a(c.login,c.password,c.server,c.useWSS),d.id=++this.accCount,d.connect(),d},disposeCurrentAcc:function(){var a;return null!=(a=this.currentAcc)&&"function"==typeof a.disconnect&&a.disconnect(),this.currentAcc=null}},m=h.exportFnNames,k=0,l=m.length;l>k;k++)f=m[k],i[f]=function(){return!1};return i.disconnect=function(){return h.disposeCurrentAcc()},i.connect=function(a){var b;return h.disposeCurrentAcc(),h.currentAcc=h.createAccount(a),b=h.createExportAccount(h.currentAcc),e(i,b),b.on("all",function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],i.trigger.apply(i,a)}),b.disconnect=function(){return i.disconnect()},b},i.version="0.2.4",i}();